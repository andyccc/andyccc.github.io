

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="andyccc">
  <meta name="keywords" content="">
  
  <title>深入理解 RunLoop - Hello</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="深入理解 RunLoop">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2016-01-22 23:11" pubdate>
        2016年1月22日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      89
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">深入理解 RunLoop</h1>
            
            <div class="markdown-body">
              <p>RunLoop 是 iOS 和 OSX 开发中非常基础的一个概念，这篇文章将从 CFRunLoop 的源码入手，介绍 RunLoop 的概念以及底层实现原理。之后会介绍一下在 iOS 中，苹果是如何利用 RunLoop 实现自动释放池、延迟回调、触摸事件、屏幕刷新等功能的。</p>
<p>模块：<br>RunLoop 的概念<br>RunLoop 与线程的关系<br>RunLoop 对外的接口<br>RunLoop 的 Mode<br>RunLoop 的内部逻辑<br>RunLoop 的底层实现<br>苹果用 RunLoop 实现的功能<br>　　AutoreleasePool<br>　　事件响应<br>　　手势识别<br>　　界面更新<br>　　定时器<br>　　PerformSelecter<br>　　关于 GCD<br>　　关于网络请求<br>RunLoop 的实际应用举例<br>　　AFNetworking<br>      AsyncDisplayKit</p>
<h2 id="RunLoop-的概念"><a href="#RunLoop-的概念" class="headerlink" title="RunLoop 的概念"></a>RunLoop 的概念</h2><p>一般来讲，一个线程一次只能执行一个任务，执行完成后线程就会退出。如果我们需要一个机制，让线程能随时处理事件但并不退出，通常的代码逻辑是这样的：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> loop<span class="hljs-literal">()</span> &#123;<br>    initialize<span class="hljs-literal">()</span>;<br>    <span class="hljs-keyword">do</span> &#123;<br>        var message = get<span class="hljs-constructor">_next_message()</span>;<br>        process<span class="hljs-constructor">_message(<span class="hljs-params">message</span>)</span>;<br>    &#125; <span class="hljs-keyword">while</span> (message != quit);<br>&#125;<br></code></pre></td></tr></table></figure>


<p>这种模型通常被称作 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Event_loop">Event Loop</a>。 Event Loop 在很多系统和框架里都有实现，比如 Node.js 的事件处理，比如 Windows 程序的消息循环，再比如 OSX/iOS 里的 RunLoop。实现这种模型的关键点在于：如何管理事件 / 消息，如何让线程在没有处理消息时休眠以避免资源占用、在有消息到来时立刻被唤醒。</p>
<p>所以，RunLoop 实际上就是一个对象，这个对象管理了其需要处理的事件和消息，并提供了一个入口函数来执行上面 Event Loop 的逻辑。线程执行了这个函数后，就会一直处于这个函数内部 “接受消息 -&gt; 等待 -&gt; 处理” 的循环中，直到这个循环结束（比如传入 quit 的消息），函数返回。</p>
<p>OSX/iOS 系统中，提供了两个这样的对象：NSRunLoop 和 CFRunLoopRef。<br>CFRunLoopRef 是在 CoreFoundation 框架内的，它提供了纯 C 函数的 API，所有这些 API 都是线程安全的。<br>NSRunLoop 是基于 CFRunLoopRef 的封装，提供了面向对象的 API，但是这些 API 不是线程安全的。</p>
<p>CFRunLoopRef 的代码是<a target="_blank" rel="noopener" href="http://opensource.apple.com/source/CF/CF-855.17/CFRunLoop.c">开源</a>的，你可以在这里 <a target="_blank" rel="noopener" href="http://opensource.apple.com/tarballs/CF/CF-855.17.tar.gz">http://opensource.apple.com/tarballs/CF/CF-855.17.tar.gz</a> 下载到整个 CoreFoundation 的源码。为了方便跟踪和查看，你可以新建一个 Xcode 工程，把这堆源码拖进去看。</p>
<h2 id="RunLoop-与线程的关系"><a href="#RunLoop-与线程的关系" class="headerlink" title="RunLoop 与线程的关系"></a>RunLoop 与线程的关系</h2><p>首先，iOS 开发中能遇到两个线程对象: pthread_t 和 NSThread。过去苹果有份<a target="_blank" rel="noopener" href="http://www.fenestrated.net/%7Emacman/mirrors/Apple%20Technotes%20%28As%20of%202002%29/tn/tn2028.html">文档</a>标 明了 NSThread 只是 pthread_t 的封装，但那份文档已经失效了，现在它们也有可能都是直接包装自最底层的 mach thread。苹果并没有提供这两个对象相互转换的接口，但不管怎么样，可以肯定的是 pthread_t 和 NSThread 是一一对应的。比如，你可以通过 pthread_main_thread_np() 或 [NSThread mainThread] 来获取主线程；也可以通过 pthread_self() 或 [NSThread currentThread] 来获取当前线程。CFRunLoop 是基于 pthread 来管理的。</p>
<p>苹果不允许直接创建 RunLoop，它只提供了两个自动获取的函数：CFRunLoopGetMain() 和 CFRunLoopGetCurrent()。 这两个函数内部的逻辑大概是下面这样:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">/// 全局的Dictionary，key 是 pthread_t， value 是 CFRunLoopRef</span><br>static CFMutableDictionaryRef loopsDic;<br><span class="hljs-comment">/// 访问 loopsDic 时的锁</span><br>static CFSpinLock_t loopsLock;<br> <br><span class="hljs-comment">/// 获取一个 pthread 对应的 RunLoop。</span><br>CFRunLoopRef <span class="hljs-constructor">_CFRunLoopGet(<span class="hljs-params">pthread_t</span> <span class="hljs-params">thread</span>)</span> &#123;<br>    <span class="hljs-constructor">OSSpinLockLock(&amp;<span class="hljs-params">loopsLock</span>)</span>;<br>    <br>    <span class="hljs-keyword">if</span> (!loopsDic) &#123;<br>        <span class="hljs-comment">// 第一次进入时，初始化全局Dic，并先为主线程创建一个 RunLoop。</span><br>        loopsDic = <span class="hljs-constructor">CFDictionaryCreateMutable()</span>;<br>        CFRunLoopRef mainLoop = <span class="hljs-constructor">_CFRunLoopCreate()</span>;<br>        <span class="hljs-constructor">CFDictionarySetValue(<span class="hljs-params">loopsDic</span>, <span class="hljs-params">pthread_main_thread_np</span>()</span>, mainLoop);<br>    &#125;<br>    <br>    <span class="hljs-comment">/// 直接从 Dictionary 里获取。</span><br>    CFRunLoopRef loop = <span class="hljs-constructor">CFDictionaryGetValue(<span class="hljs-params">loopsDic</span>, <span class="hljs-params">thread</span>)</span>);<br>    <br>    <span class="hljs-keyword">if</span> (!loop) &#123;<br>        <span class="hljs-comment">/// 取不到时，创建一个</span><br>        loop = <span class="hljs-constructor">_CFRunLoopCreate()</span>;<br>        <span class="hljs-constructor">CFDictionarySetValue(<span class="hljs-params">loopsDic</span>, <span class="hljs-params">thread</span>, <span class="hljs-params">loop</span>)</span>;<br>        <span class="hljs-comment">/// 注册一个回调，当线程销毁时，顺便也销毁其对应的 RunLoop。</span><br>        <span class="hljs-constructor">_CFSetTSD(<span class="hljs-operator">...</span>, <span class="hljs-params">thread</span>, <span class="hljs-params">loop</span>, <span class="hljs-params">__CFFinalizeRunLoop</span>)</span>;<br>    &#125;<br>    <br>    <span class="hljs-constructor">OSSpinLockUnLock(&amp;<span class="hljs-params">loopsLock</span>)</span>;<br>    return loop;<br>&#125;<br> <br>CFRunLoopRef <span class="hljs-constructor">CFRunLoopGetMain()</span> &#123;<br>    return <span class="hljs-constructor">_CFRunLoopGet(<span class="hljs-params">pthread_main_thread_np</span>()</span>);<br>&#125;<br> <br>CFRunLoopRef <span class="hljs-constructor">CFRunLoopGetCurrent()</span> &#123;<br>    return <span class="hljs-constructor">_CFRunLoopGet(<span class="hljs-params">pthread_self</span>()</span>);<br>&#125;<br></code></pre></td></tr></table></figure>


<p>从上面的代码可以看出，线程和 RunLoop 之间是一一对应的，其关系是保存在一个全局的 Dictionary 里。线程刚创建时并没有 RunLoop，如果你不主动获取，那它一直都不会有。RunLoop 的创建是发生在第一次获取时，RunLoop 的销毁是发生在线程结束时。你只能在一个线程的内部获取其 RunLoop（主线程除外）。</p>
<h2 id="RunLoop-对外的接口"><a href="#RunLoop-对外的接口" class="headerlink" title="RunLoop 对外的接口"></a>RunLoop 对外的接口</h2><p>在 CoreFoundation 里面关于 RunLoop 有 5 个类:</p>
<p>CFRunLoopRef<br>CFRunLoopModeRef<br>CFRunLoopSourceRef<br>CFRunLoopTimerRef<br>CFRunLoopObserverRef</p>
<p>其中 CFRunLoopModeRef 类并没有对外暴露，只是通过 CFRunLoopRef 的接口进行了封装。他们的关系如下:<br>[<img src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+DQo8IS0tW2lmIElFIDZdPg0KPGh0bWwgaWQ9ImllNiIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDddPg0KPGh0bWwgaWQ9ImllNyIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDhdPg0KPGh0bWwgaWQ9ImllOCIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmICEoSUUgNikgfCAhKElFIDcpIHwgIShJRSA4KSAgXT48IS0tPg0KPGh0bWwgbGFuZz0iemgtQ04iPg0KPCEtLTwhW2VuZGlmXS0tPg0KPGhlYWQ+DQoJPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+DQoJPHRpdGxlPjQwNCDmnKrmib7liLAgfCBHYXJhbiBubyBkb3U8L3RpdGxlPg0KCQkJDQoJDQoJPGxpbmsgcmVsPSJwaW5nYmFjayIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3htbHJwYy5waHAiIC8+DQoNCgkJPCEtLVtpZiBsdCBJRSA5XT4NCgk8c2NyaXB0IHNyYz0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvaHRtbDUuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQoJPCFbZW5kaWZdLS0+DQoNCgk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUgPSAnanMnOw0KCTwvc2NyaXB0Pg0KDQoJPGxpbmsgcmVsPSdkbnMtcHJlZmV0Y2gnIGhyZWY9Jy8vZm9udHMuZ29vZ2xlYXBpcy5jb20nIC8+CjxsaW5rIHJlbD0nZG5zLXByZWZldGNoJyBocmVmPScvL3Mudy5vcmcnIC8+CjxsaW5rIHJlbD0iYWx0ZXJuYXRlIiB0eXBlPSJhcHBsaWNhdGlvbi9yc3MreG1sIiB0aXRsZT0iR2FyYW4gbm8gZG91ICZyYXF1bzsgRmVlZCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2ZlZWQvIiAvPgo8bGluayByZWw9ImFsdGVybmF0ZSIgdHlwZT0iYXBwbGljYXRpb24vcnNzK3htbCIgdGl0bGU9IkdhcmFuIG5vIGRvdSAmcmFxdW87IOivhOiuukZlZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jb21tZW50cy9mZWVkLyIgLz4KPG1ldGEgY29udGVudD0iRGl2aSB2LjIuNS4zIiBuYW1lPSJnZW5lcmF0b3IiLz48bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdzY2FwLmZsYXNoYmxvY2stY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvZmxhc2hibG9jay5jc3M/dmVyPTUuNC42JyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nc2NhcC5wbGF5ZXItY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvcGxheWVyLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdjcmF5b24tY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jcmF5b24tc3ludGF4LWhpZ2hsaWdodGVyL2Nzcy9taW4vY3JheW9uLm1pbi5jc3M/dmVyPV8yLjcuMl9iZXRhJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nd3AtZWFzeWFyY2hpdmVzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3BsdWdpbnMvd3AtZWFzeWFyY2hpdmVzL2Nzcy93cC1lYXN5YXJjaGl2ZXMuY3NzP3Zlcj0zLjEuMicgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdzY3JlZW4nIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J3dwLWJsb2NrLWxpYnJhcnktY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2Nzcy9kaXN0L2Jsb2NrLWxpYnJhcnkvc3R5bGUubWluLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdtYXRoLWNhcHRjaGEtZnJvbnRlbmQtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy93cC1tYXRoLWNhcHRjaGEvY3NzL2Zyb250ZW5kLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSd3cC1wYWdlbmF2aS1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3dwLXBhZ2VuYXZpL3BhZ2VuYXZpLWNzcy5jc3M/dmVyPTIuNzAnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdkaXZpLWZvbnRzLWNzcycgIGhyZWY9J2h0dHBzOi8vZm9udHMubG9saS5uZXQvY3NzP2ZhbWlseT1PcGVuK1NhbnM6MzAwaXRhbGljLDQwMGl0YWxpYyw2MDBpdGFsaWMsNzAwaXRhbGljLDgwMGl0YWxpYyw0MDAsMzAwLDYwMCw3MDAsODAwJiMwMzg7c3Vic2V0PWxhdGluLGxhdGluLWV4dCcgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LWdmLWNoaW5lc2UtY3NzJyAgaHJlZj0nLy9mb250cy5sb2xpLm5ldC9lYXJseWFjY2Vzcy9jd3RleGZhbmdzb25nLmNzcycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2Rpdmktc3R5bGUtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0Rpdmkvc3R5bGUuY3NzP3Zlcj0yLjUuMycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LXNob3J0Y29kZXMtY3NzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2VwYW5lbC9zaG9ydGNvZGVzL2Nzcy9zaG9ydGNvZGVzLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nZXQtc2hvcnRjb2Rlcy1yZXNwb25zaXZlLWNzcy1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9lcGFuZWwvc2hvcnRjb2Rlcy9jc3Mvc2hvcnRjb2Rlc19yZXNwb25zaXZlLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9qcy9zb3VuZG1hbmFnZXIyLW5vZGVidWctanNtaW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2pzL2pxdWVyeS9qcXVlcnkuanM/dmVyPTEuMTIuNC13cCc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy9qcXVlcnkvanF1ZXJ5LW1pZ3JhdGUubWluLmpzP3Zlcj0xLjQuMSc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBDcmF5b25TeW50YXhTZXR0aW5ncyA9IHsidmVyc2lvbiI6Il8yLjcuMl9iZXRhIiwiaXNfYWRtaW4iOiIwIiwiYWpheHVybCI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1hZG1pblwvYWRtaW4tYWpheC5waHAiLCJwcmVmaXgiOiJjcmF5b24tIiwic2V0dGluZyI6ImNyYXlvbi1zZXR0aW5nIiwic2VsZWN0ZWQiOiJjcmF5b24tc2V0dGluZy1zZWxlY3RlZCIsImNoYW5nZWQiOiJjcmF5b24tc2V0dGluZy1jaGFuZ2VkIiwic3BlY2lhbCI6ImNyYXlvbi1zZXR0aW5nLXNwZWNpYWwiLCJvcmlnX3ZhbHVlIjoiZGF0YS1vcmlnLXZhbHVlIiwiZGVidWciOiIifTsKdmFyIENyYXlvblN5bnRheFN0cmluZ3MgPSB7ImNvcHkiOiJQcmVzcyAlcyB0byBDb3B5LCAlcyB0byBQYXN0ZSIsIm1pbmltaXplIjoiQ2xpY2sgVG8gRXhwYW5kIENvZGUifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL2NyYXlvbi1zeW50YXgtaGlnaGxpZ2h0ZXIvanMvbWluL2NyYXlvbi5taW4uanM/dmVyPV8yLjcuMl9iZXRhJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9zaW1wbGVzbWlsZXlzaG93L2pxdWVyeS5pbnNlcnRhdGNhcmV0LmpzJz48L3NjcmlwdD4KPGxpbmsgcmVsPSdodHRwczovL2FwaS53Lm9yZy8nIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1qc29uLycgLz4KPGxpbmsgcmVsPSJFZGl0VVJJIiB0eXBlPSJhcHBsaWNhdGlvbi9yc2QreG1sIiB0aXRsZT0iUlNEIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20veG1scnBjLnBocD9yc2QiIC8+CjxsaW5rIHJlbD0id2x3bWFuaWZlc3QiIHR5cGU9ImFwcGxpY2F0aW9uL3dsd21hbmlmZXN0K3htbCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL3dsd21hbmlmZXN0LnhtbCIgLz4gCjxtZXRhIG5hbWU9ImdlbmVyYXRvciIgY29udGVudD0iV29yZFByZXNzIDUuNC42IiAvPgoKPCEtLSBHZW5lcmF0ZWQgQnkgU2hvdy1Vc2VyQWdlbnQgMS4wLjggLSBodHRwOi8vemx6LmltL3Nob3ctdXNlcmFnZW50LyAtLT4KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3Nob3ctdXNlcmFnZW50L3Nob3ctdXNlcmFnZW50LmNzcyIgdHlwZT0idGV4dC9jc3MiIG1lZGlhPSJzY3JlZW4iIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT0wIiAvPgkJPHN0eWxlIGlkPSJ0aGVtZS1jdXN0b21pemVyLWNzcyI+DQoJCQkJCQkJCQkJCQkJLndvb2NvbW1lcmNlICNyZXNwb25kIGlucHV0I3N1Ym1pdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LCAud29vY29tbWVyY2UgI2NvbnRlbnQgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSAjY29udGVudCBpbnB1dC5idXR0b24sIC53b29jb21tZXJjZS1tZXNzYWdlLCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1pbmZvIHsgYmFja2dyb3VuZDogI2E5ZDMwMCAhaW1wb3J0YW50OyB9DQoJCQkjZXRfc2VhcmNoX2ljb246aG92ZXIsIC5tb2JpbGVfbWVudV9iYXI6YmVmb3JlLCAuZXQtc29jaWFsLWljb24gYTpob3ZlciwgLmV0X3BiX3N1bSwgLmV0X3BiX3ByaWNpbmcgbGkgYSwgLmV0X3BiX3ByaWNpbmdfdGFibGVfYnV0dG9uLCAuZXRfb3ZlcmxheTpiZWZvcmUsIC5lbnRyeS1zdW1tYXJ5IHAucHJpY2UgaW5zLCAud29vY29tbWVyY2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UtcGFnZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLmV0X3BiX21lbWJlcl9zb2NpYWxfbGlua3MgYTpob3ZlciwgLndvb2NvbW1lcmNlIC5zdGFyLXJhdGluZyBzcGFuOmJlZm9yZSwgLndvb2NvbW1lcmNlLXBhZ2UgLnN0YXItcmF0aW5nIHNwYW46YmVmb3JlLCAuZXRfcGJfd2lkZ2V0IGxpIGE6aG92ZXIsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydGZvbGlvX2ZpbHRlcnMgbGkgYS5hY3RpdmUsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydG9mb2xpb19wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAuZXRfcGJfZ2FsbGVyeSAuZXRfcGJfZ2FsbGVyeV9wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAud3AtcGFnZW5hdmkgc3Bhbi5jdXJyZW50LCAud3AtcGFnZW5hdmkgYTpob3ZlciwgLm5hdi1zaW5nbGUgYSwgLnBvc3RlZF9pbiBhIHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCS5ldF9wYl9jb250YWN0X3N1Ym1pdCwgLmV0X3Bhc3N3b3JkX3Byb3RlY3RlZF9mb3JtIC5ldF9zdWJtaXRfYnV0dG9uLCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9uZXdzbGV0dGVyX2J1dHRvbiwgLmNvbW1lbnQtcmVwbHktbGluaywgLmZvcm0tc3VibWl0IGlucHV0LCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9wcm9tb19idXR0b24sIC5ldF9wYl9iZ19sYXlvdXRfbGlnaHQgLmV0X3BiX21vcmVfYnV0dG9uLCAud29vY29tbWVyY2UgYS5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBhLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgYnV0dG9uLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBhLmJ1dHRvbiwgLndvb2NvbW1lcmNlLXBhZ2UgYS5idXR0b24sIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24geyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmZvb3Rlci13aWRnZXQgaDQgeyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmV0LXNlYXJjaC1mb3JtLCAubmF2IGxpIHVsLCAuZXRfbW9iaWxlX21lbnUsIC5mb290ZXItd2lkZ2V0IGxpOmJlZm9yZSwgLmV0X3BiX3ByaWNpbmcgbGk6YmVmb3JlLCBibG9ja3F1b3RlIHsgYm9yZGVyLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkuZXRfcGJfY291bnRlcl9hbW91bnQsIC5ldF9wYl9mZWF0dXJlZF90YWJsZSAuZXRfcGJfcHJpY2luZ19oZWFkaW5nLCAuZXRfcXVvdGVfY29udGVudCwgLmV0X2xpbmtfY29udGVudCwgLmV0X2F1ZGlvX2NvbnRlbnQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkJCQkJLmNvbnRhaW5lciwgLmV0X3BiX3JvdywgLmV0X3BiX3NsaWRlciAuZXRfcGJfY29udGFpbmVyLCAuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24gLmV0X3BiX3RpdGxlX2NvbnRhaW5lciwgLmV0X3BiX2Z1bGx3aWR0aF9zZWN0aW9uIC5ldF9wYl90aXRsZV9mZWF0dXJlZF9jb250YWluZXIsIC5ldF9wYl9mdWxsd2lkdGhfaGVhZGVyOm5vdCguZXRfcGJfZnVsbHNjcmVlbikgLmV0X3BiX2Z1bGx3aWR0aF9oZWFkZXJfY29udGFpbmVyIHsgbWF4LXdpZHRoOiA5NjBweDsgfQ0KCQkJLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIsIC5ldF9maXhlZF9uYXYuZXRfYm94ZWRfbGF5b3V0ICNwYWdlLWNvbnRhaW5lciAjdG9wLWhlYWRlciwgLmV0X2ZpeGVkX25hdi5ldF9ib3hlZF9sYXlvdXQgI3BhZ2UtY29udGFpbmVyICNtYWluLWhlYWRlciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmNvbnRhaW5lciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmV0X3BiX3JvdyB7IG1heC13aWR0aDogMTEyMHB4OyB9DQoJCQkJCQkJYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI3RvcC1oZWFkZXIsICNldC1zZWNvbmRhcnktbmF2IGxpIHVsIHsgYmFja2dyb3VuZC1jb2xvcjogI2E5ZDMwMDsgfQ0KCQkJCQkJCQkjdG9wLWhlYWRlciwgI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQkJCQkJCQkJCQ0KCQkNCgkJCQkJI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX3JlZCAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9yZWQgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfcGluayAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9waW5rICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX29yYW5nZSAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9vcmFuZ2UgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsIC5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI21haW4tZm9vdGVyIC5mb290ZXItd2lkZ2V0IGg0IHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkuZm9vdGVyLXdpZGdldCBsaTpiZWZvcmUgeyBib3JkZXItY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkNCgkJDQoJCQ0KCQlAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWluLXdpZHRoOiA5ODFweCApIHsNCgkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIsIC5ldC1maXhlZC1oZWFkZXIjdG9wLWhlYWRlciAjZXQtc2Vjb25kYXJ5LW5hdiBsaSB1bCB7IGJhY2tncm91bmQtY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtYW5jZXN0b3IgPiBhLA0KCQkJCS5ldC1maXhlZC1oZWFkZXIgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjICFpbXBvcnRhbnQ7IH0NCgkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQ0KCQkJCQl9DQoJCUBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKCBtaW4td2lkdGg6IDEyMDBweCkgew0KCQkJLmV0X3BiX3JvdyB7IHBhZGRpbmc6IDI0cHggMDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24geyBwYWRkaW5nOiA0OHB4IDA7IH0NCgkJCS5zaW5nbGUuZXRfcGJfcGFnZWJ1aWxkZXJfbGF5b3V0LmV0X2Z1bGxfd2lkdGhfcGFnZSAuZXRfcG9zdF9tZXRhX3dyYXBwZXIgeyBwYWRkaW5nLXRvcDogNzJweDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24uZXRfcGJfc2VjdGlvbl9maXJzdCB7IHBhZGRpbmctdG9wOiBpbmhlcml0OyB9DQoJCQkuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24geyBwYWRkaW5nOiAwOyB9DQoJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogOTgwcHggKSB7DQoJCQkJCQkJCQkJCQkJCQkJCQkJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogNzY3cHggKSB7DQoJCQkJCQkJCQkJCQkJCX0NCgk8L3N0eWxlPg0KDQoJPHN0eWxlIGNsYXNzPSJldF9vbmVfZm9udF9sYW5ndWFnZXMiPmgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGJvZHksIGlucHV0LCB0ZXh0YXJlYSwgc2VsZWN0IHsgZm9udC1mYW1pbHk6ICdjd1RlWEZhbmdTb25nJywgc2VyaWY7IH08L3N0eWxlPg0KCQ0KCTxzdHlsZSBpZD0ibW9kdWxlLWN1c3RvbWl6ZXItY3NzIj4NCgkJCTwvc3R5bGU+DQoNCgk8IS0tIEFsbCBpbiBvbmUgRmF2aWNvbiA0LjcgLS0+PGxpbmsgcmVsPSJpY29uIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTMvMDgvZmF2aWNvbi5wbmciIHR5cGU9ImltYWdlL3BuZyIvPgo8bGluayByZWw9ImFwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxMy8wOC9mYXZpY29uMi5wbmciIC8+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyIgaWQ9ImV0LWN1c3RvbS1jc3MiPgpoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBib2R5LCBpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCB7DQpmb250LWZhbWlseTogJ1BpbmdGYW5nIFNDJywgJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgVmVyZGFuYSwgJ0hpcmFnaW5vIFNhbnMgR0InLCAnTm90byBTYW5zIENKSyBTQycsICdTb3VyY2UgSGFuIFNhbnMgQ04nLCBTVEhlaXRpLCAnTWljcm9zb2Z0IFlhSGVpJywgJ1dlblF1YW5ZaSBNaWNybyBIZWknLCBTaW1TdW4sIHNhbnMtc2VyaWY7DQpmb250LXdlaWdodDogNDAwOw0KfQ0KDQojbWFpbi1oZWFkZXIgew0KICAgIGJhY2tncm91bmQ6IGhzbGEoMCwgMCUsIDEwMCUsIC44NSk7DQogICAgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTJweCk7DQogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEycHgpOw0KfQ0KDQpib2R5IHsgDQoJZm9udC1zaXplOiAxNnB4Ow0KCWNvbG9yOiAjMWQxZDFkOw0KCXdvcmQtd3JhcDpicmVhay13b3JkOw0KCXdvcmQtYnJlYWs6IG5vcm1hbDsNCn0NCg0KcCB7DQoJbWFyZ2luOiAwLjllbSAwIDAuNWVtOw0KCXBhZGRpbmctYm90dG9tOiAwLjZlbTsNCglmb250LXNpemU6IDEwMCU7DQoJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOw0KfQ0KDQouZXRfcGJfcG9zdCBoMiB7DQoJZm9udC13ZWlnaHQ6IGJvbGQ7DQp9DQoNCi5ldF9wYl9wb3N0IC5wb3N0LW1ldGEgew0KCTE0cHggIkNsYXNzaWMgR3JvdGVzcXVlIFcwMSIsIEFyaWFsLCBzYW5zLXNlcmlmOw0KfQ0KDQouZXRfcGJfcG9zdCB7DQoJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlMmUyZTI7DQoJcGFkZGluZy1ib3R0b206IDIwcHg7DQp9DQoNCi5ldF9wYl9wb3N0Omxhc3Qtb2YtdHlwZSB7DQoJYm9yZGVyLWJvdHRvbTogMHB4IHNvbGlkICNlMmUyZTI7DQp9DQoNCiNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB7DQoJcGFkZGluZy10b3A6IDMwcHg7DQp9DQoNCi5ldF9yaWdodF9zaWRlYmFyICNzaWRlYmFyIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmhvbWUgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMHB4Ow0KfQ0KDQouc2luZ2xlLXBvc3QgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmV0X3BiX3Bvc3Qgew0KICBtYXJnaW4tYm90dG9tOiA0MHB4Ow0KfQ0KDQouZXRfcGJfcG9zdCAuZW50cnktY29udGVudCwgDQoucHJvamVjdCAuZW50cnktY29udGVudCB7DQogIHBhZGRpbmctdG9wOiAxMHB4Ow0KfQ0KDQoud2lkZ2V0X2Fib3V0bWV3aWRnZXQgLmNsZWFyZml4LA0KLmV0X3BiX3dpZGdldCBsaSB7DQoJZm9udC1zaXplOiA5MyU7DQp9DQoNCi53aWRnZXR0aXRsZSB7DQoJZm9udC1zaXplOiAxMjAlOw0KfQ0KDQouZXRfcGJfc2Nyb2xsX3RvcCB7DQogICAgYm90dG9tOiAxNXB4Ow0KfQ0KDQojdG9wLW1lbnUgbGkgPiBhLCANCi5mdWxsd2lkdGgtbWVudSBsaSA+IGEgew0KCWZvbnQtc2l6ZTogMTRweDsNCglmb250LXdlaWdodDogNDAwOw0KfQ0KDQojZm9vdGVyLWJvdHRvbSB7DQoJcGFkZGluZzogNXB4IDAgN3B4Ow0KfQ0KDQppbWcud3Atc21pbGV5IHsNCgltYXgtaGVpZ2h0OiAxLjJlbSAhaW1wb3J0YW50Ow0KCWhlaWdodDogMS4yZW0gIWltcG9ydGFudDsNCgl3aWR0aDogMS4yZW0gIWltcG9ydGFudDsNCn0NCg0KLndwLXNtaWxleWxpbmsgew0KCW1heC13aWR0aDogMjJweCAhaW1wb3J0YW50Ow0KfQ0KDQojbGVmdC1hcmVhIGE6aG92ZXIgew0KCXRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQojY29tbWVudGZvcm0gdGV4dGFyZWEsIA0KI2NvbW1lbnRmb3JtIGlucHV0W3R5cGU9InRleHQiXSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KfQ0KDQpAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWF4LXdpZHRoOiA3NjdweCApIHsNCgkuZXRfcGJfcm93LCAuY29udGFpbmVyLCAuZXRfcGJfY29udGFpbmVyIHsgd2lkdGg6IDg1JTsgfQ0KCS5ldF9wYl9wb3N0IGgyLCAuZXRfcGJfcG9ydGZvbGlvX2l0ZW0gaDIgeyBmb250LXNpemU6IDI0cHg7IH0NCgkuY29tbWVudC1ib2R5IHsgcGFkZGluZzogMCAwIDI1cHggMTAwcHg7IH0NCn0NCg0KI2R5bmFtaWMtdG8tdG9wIHsNCglkaXNwbGF5Om5vbmU7DQoJb3ZlcmZsb3c6aGlkZGVuOw0KCXdpZHRoOmF1dG87DQoJei1pbmRleDo5MDsNCglwb3NpdGlvbjpmaXhlZDsNCgl0b3A6YXV0bzsNCglsZWZ0OmF1dG87DQoJZm9udC1mYW1pbHk6c2Fucy1zZXJpZjsNCglmb250LXNpemU6MWVtOw0KCWNvbG9yOiNmZmY7DQoJdGV4dC1kZWNvcmF0aW9uOm5vbmU7DQoJdGV4dC1zaGFkb3c6MCAxcHggMCAjMzMzOw0KCWZvbnQtd2VpZ2h0OmJvbGQ7DQoJcGFkZGluZzoxN3B4IDE2cHg7DQoJYm9yZGVyOjBweCBzb2xpZCAjMDAwOw0KCWJhY2tncm91bmQ6IzExMTsNCgktd2Via2l0LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktbW96LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktaWNhYi1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJLWtodG1sLWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktby1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJYmFja2dyb3VuZC1vcmlnaW46Ym9yZGVyOw0KCS13ZWJraXQtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1tb3otYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1pY2FiLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgkta2h0bWwtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1vLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgliYWNrZ3JvdW5kLWNsaXA6cGFkZGluZy1ib3g7DQoJLXdlYmtpdC1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktbXMtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLW1vei1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktby1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgkta2h0bWwtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLWljYWItYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLXdlYmtpdC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLW1vei1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLWljYWItYm9yZGVyLXJhZGl1czoyM3B4Ow0KCS1raHRtbC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJYm9yZGVyLXJhZGl1czoyM3B4DQp9DQojZHluYW1pYy10by10b3A6aG92ZXIgew0KCWJhY2tncm91bmQ6IzRkNGRhYzsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1ncmFkaWVudCggbGluZWFyLCAwJSAwJSwgMCUgMTAwJSwgZnJvbSggcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSApLCB0byggcmdiYSggMCwgMCwgMCwgMCApICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1raHRtbC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tb3otbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzA4ZiAtby1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tcy1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1pY2FiLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAyNTUsIDI1NSwgMjU1LCAuMiApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWN1cnNvcjpwb2ludGVyDQp9DQojZHluYW1pYy10by10b3A6YWN0aXZlIHsNCgliYWNrZ3JvdW5kOiMxMTE7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtZ3JhZGllbnQoIGxpbmVhciwgMCUgMCUsIDAlIDEwMCUsIGZyb20oIHJnYmEoIDAsIDAsIDAsIC4zICkgKSwgdG8oIHJnYmEoIDAsIDAsIDAsIDAgKSApICk7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbW96LWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLWtodG1sLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLW8tbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbXMtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtaWNhYi1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMCwgMCwgMCwgLjEgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMTExIGxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKQ0KfQ0KI2R5bmFtaWMtdG8tdG9wLCNkeW5hbWljLXRvLXRvcDphY3RpdmUsI2R5bmFtaWMtdG8tdG9wOmZvY3VzLCNkeW5hbWljLXRvLXRvcDpob3ZlciB7DQoJb3V0bGluZTpub25lDQp9DQojZHluYW1pYy10by10b3Agc3BhbiB7DQoJZGlzcGxheTpibG9jazsNCglvdmVyZmxvdzpoaWRkZW47DQoJd2lkdGg6MTRweDsNCgloZWlnaHQ6MTJweDsNCgliYWNrZ3JvdW5kOnVybCgvd3AtY29udGVudC9wbHVnaW5zL2R5bmFtaWMtdG8tdG9wL2Nzcy9pbWFnZXMvdXAucG5nICluby1yZXBlYXQgY2VudGVyIGNlbnRlcg0KfQ0KDQouZW50cnktY29udGVudCB0YWJsZSwgYm9keS5ldC1wYi1wcmV2aWV3ICNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB0YWJsZSB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0MxQzFDMTsNCiAgICBsaW5lLWhlaWdodDogMS40ZW07DQoNCiAgICBib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlOw0KfQ0KDQp0aGVhZCB7DQoJYmFja2dyb3VuZC1jb2xvcjogI0YxRjFGMTsNCn0NCg0KcCNjb3B5cmlnaHQgew0KICAgIGNvbG9yOiAjNzE3MTcxOw0KfQo8L3N0eWxlPjwvaGVhZD4NCjxib2R5IGNsYXNzPSJlcnJvcjQwNCBldF9wYl9idXR0b25faGVscGVyX2NsYXNzIGV0X2ZpeGVkX25hdiBldF9zaG93X25hdiBldF9jb3Zlcl9iYWNrZ3JvdW5kIGV0X3BiX2d1dHRlciBvc3ggZXRfcGJfZ3V0dGVyczMgZXRfcHJpbWFyeV9uYXZfZHJvcGRvd25fYW5pbWF0aW9uX2ZhZGUgZXRfc2Vjb25kYXJ5X25hdl9kcm9wZG93bl9hbmltYXRpb25fZmFkZSBldF9wYl9mb290ZXJfY29sdW1uczQgZXRfaGVhZGVyX3N0eWxlX2xlZnQgZXRfcmlnaHRfc2lkZWJhciBjaHJvbWUiPg0KCTxkaXYgaWQ9InBhZ2UtY29udGFpbmVyIj4NCg0KCQ0KCQk8aGVhZGVyIGlkPSJtYWluLWhlYWRlciIgZGF0YS1oZWlnaHQtb25sb2FkPSI2NiI+DQoJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgY2xlYXJmaXggZXRfbWVudV9jb250YWluZXIiPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImxvZ29fY29udGFpbmVyIj4NCgkJCQkJPHNwYW4gY2xhc3M9ImxvZ29faGVscGVyIj48L3NwYW4+DQoJCQkJCTxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQkJPGltZyBzcmM9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxNS8wNS9sb2dvMS5wbmciIGFsdD0iR2FyYW4gbm8gZG91IiBpZD0ibG9nbyIgZGF0YS1oZWlnaHQtcGVyY2VudGFnZT0iNTQiIC8+DQoJCQkJCTwvYT4NCgkJCQk8L2Rpdj4NCgkJCQk8ZGl2IGlkPSJldC10b3AtbmF2aWdhdGlvbiIgZGF0YS1oZWlnaHQ9IjY2IiBkYXRhLWZpeGVkLWhlaWdodD0iNDAiPg0KCQkJCQk8bmF2IGlkPSJ0b3AtbWVudS1uYXYiPg0KCQkJCQkJCQkJCQk8dWwgaWQ9InRvcC1tZW51IiBjbGFzcz0ibmF2Ij4NCgkJCQkJCQkJCQkJCQkJCTxsaSA+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tLyI+6aaW6aG1PC9hPjwvbGk+DQoJCQkJCQkJDQoJCQkJCQkJPGxpIGNsYXNzPSJwYWdlX2l0ZW0gcGFnZS1pdGVtLTM0Ij48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vYWJvdXQvIj5BYm91dDwvYT48L2xpPgo8bGkgY2xhc3M9InBhZ2VfaXRlbSBwYWdlLWl0ZW0tNDE1MDIiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9hcmNoaXZlLyI+QXJjaGl2ZTwvYT48L2xpPgoJCQkJCQkJCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2FjZy8iPkFDRzwvYT4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMSI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L290aGVyLyI+5YW25LuWPC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2NoaXJydXAvIj7lkJDmp708L2E+CjwvbGk+Cgk8bGkgY2xhc3M9ImNhdC1pdGVtIGNhdC1pdGVtLTExIj48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vY2F0ZWdvcnkvdGVjLyI+5oqA5pyvPC9hPgo8dWwgY2xhc3M9J2NoaWxkcmVuJz4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMzAiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jYXRlZ29yeS90ZWMvaW9zLXRlYy8iPmlPUzwvYT4KPC9saT4KPC91bD4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNyI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2RhaWx5LyI+5pel5bi4PC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMiI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2Rlc2lnbi8iPuiuvuiuoTwvYT4KPC9saT4KCQkJCQkJPC91bD4NCgkJCQkJCQkJCQk8L25hdj4NCg0KCQkJCQkNCgkJCQkJDQoJCQkJCTxkaXYgaWQ9ImV0X21vYmlsZV9uYXZfbWVudSI+DQoJCQk8ZGl2IGNsYXNzPSJtb2JpbGVfbmF2IGNsb3NlZCI+DQoJCQkJPHNwYW4gY2xhc3M9InNlbGVjdF9wYWdlIj7pgInmi6npobXpnaI8L3NwYW4+DQoJCQkJPHNwYW4gY2xhc3M9Im1vYmlsZV9tZW51X2JhciI+PC9zcGFuPg0KCQkJPC9kaXY+DQoJCTwvZGl2PgkJCQk8L2Rpdj4gPCEtLSAjZXQtdG9wLW5hdmlnYXRpb24gLS0+DQoJCQk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KCQkJPGRpdiBjbGFzcz0iZXRfc2VhcmNoX291dGVyIj4NCgkJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgZXRfc2VhcmNoX2Zvcm1fY29udGFpbmVyIj4NCgkJCQkJPGZvcm0gcm9sZT0ic2VhcmNoIiBtZXRob2Q9ImdldCIgY2xhc3M9ImV0LXNlYXJjaC1mb3JtIiBhY3Rpb249Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQk8aW5wdXQgdHlwZT0ic2VhcmNoIiBjbGFzcz0iZXQtc2VhcmNoLWZpZWxkIiBwbGFjZWhvbGRlcj0i5pCc57SiICZoZWxsaXA7IiB2YWx1ZT0iIiBuYW1lPSJzIiB0aXRsZT0i5pCc57Si77yaIiAvPgkJCQkJPC9mb3JtPg0KCQkJCQk8c3BhbiBjbGFzcz0iZXRfY2xvc2Vfc2VhcmNoX2ZpZWxkIj48L3NwYW4+DQoJCQkJPC9kaXY+DQoJCQk8L2Rpdj4NCgkJPC9oZWFkZXI+IDwhLS0gI21haW4taGVhZGVyIC0tPg0KDQoJCTxkaXYgaWQ9ImV0LW1haW4tYXJlYSI+DQo8ZGl2IGlkPSJtYWluLWNvbnRlbnQiPg0KCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQoJCTxkaXYgaWQ9ImNvbnRlbnQtYXJlYSIgY2xhc3M9ImNsZWFyZml4Ij4NCgkJCTxkaXYgaWQ9ImxlZnQtYXJlYSI+DQoJCQkJPGFydGljbGUgaWQ9InBvc3QtMCIgY2xhc3M9ImV0X3BiX3Bvc3Qgbm90X2ZvdW5kIj4NCgkJCQkJPGRpdiBjbGFzcz0iZW50cnkiPg0KPCEtLUlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+DQoJPGgxPuacquaJvuWIsOe7k+aenDwvaDE+DQoJPHA+5oKo6K+35rGC55qE6aG16Z2i5peg5rOV5om+5Yiw44CC5bCd6K+V57K+56Gu5oKo55qE5pCc57Si77yM5oiW6ICF5L2/55So5LiK6Z2i55qE5a+86Iiq5a6a5L2N5paH56ug44CCPC9wPg0KPC9kaXY+DQo8IS0tRW5kIGlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+CQkJCTwvYXJ0aWNsZT4gPCEtLSAuZXRfcGJfcG9zdCAtLT4NCgkJCTwvZGl2PiA8IS0tICNsZWZ0LWFyZWEgLS0+DQoNCgkJCQk8ZGl2IGlkPSJzaWRlYmFyIj4NCgkJPGRpdiBpZD0iYWJvdXRtZXdpZGdldC01IiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF9hYm91dG1ld2lkZ2V0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7lhbPkuo48L2g0PgkJPGRpdiBjbGFzcz0iY2xlYXJmaXgiPg0KCQkJPGltZyBzcmM9IiIgaWQ9ImFib3V0LWltYWdlIiBhbHQ9IiIgLz4NCgkJCeS8veiTneS5i+WgguKAlOKAlDxiciAvPuS4gOWPqumtlOazleW4iOeahOW3peWdigkJPC9kaXY+IDwhLS0gZW5kIGFib3V0IG1lIHNlY3Rpb24gLS0+DQoJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+PGRpdiBpZD0idGV4dC0yIiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF90ZXh0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7nm7jlhbPpk77mjqU8L2g0PgkJCTxkaXYgY2xhc3M9InRleHR3aWRnZXQiPjx1bD4KPGxpPjxhIGhyZWY9Imh0dHA6Ly9naXRodWIuY29tL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5HaXRodWI8L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHA6Ly93ZWliby5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+V2VpYm88L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+VHdpdHRlcjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5MaW5rZWRJbjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cDovL2liaXJlbWUuZGV2aWFudGFydC5jb20vIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5EZXZpYW50QVJUPC9hPjwvbGk+CjwvdWw+CjwvZGl2PgoJCTwvZGl2PiA8IS0tIGVuZCAuZXRfcGJfd2lkZ2V0IC0tPjxkaXYgaWQ9Im1ldGEtMiIgY2xhc3M9ImV0X3BiX3dpZGdldCB3aWRnZXRfbWV0YSI+PGg0IGNsYXNzPSJ3aWRnZXR0aXRsZSI+5Yqf6IO9PC9oND4JCQk8dWw+CgkJCQkJCTxsaT48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtbG9naW4ucGhwIj7nmbvlvZU8L2E+PC9saT4KCQkJPGxpPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9mZWVkLyI+5p2h55uuZmVlZDwvYT48L2xpPgoJCQk8bGk+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NvbW1lbnRzL2ZlZWQvIj7or4TorrpmZWVkPC9hPjwvbGk+CgkJCTxsaT48YSBocmVmPSJodHRwczovL2NuLndvcmRwcmVzcy5vcmcvIj5Xb3JkUHJlc3Mub3JnPC9hPjwvbGk+CQkJPC91bD4KCQkJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+CTwvZGl2PiA8IS0tIGVuZCAjc2lkZWJhciAtLT4NCgkJPC9kaXY+IDwhLS0gI2NvbnRlbnQtYXJlYSAtLT4NCgk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KPC9kaXY+IDwhLS0gI21haW4tY29udGVudCAtLT4NCg0KCgkJCTxmb290ZXIgaWQ9Im1haW4tZm9vdGVyIj4KCQkJCQoKCQkKCQkJCTxkaXYgaWQ9ImZvb3Rlci1ib3R0b20iPgoJCQkJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciBjbGVhcmZpeCI+CgkJCQkKCQkJCQkJPHAgaWQ9ImNvcHlyaWdodCI+CgkJCQkJCQlDb3B5cmlnaHQgMjAyMSBpYmlyZW1lCgkJCQkJCTwvcD4KCQkJCQk8L2Rpdj4JPCEtLSAuY29udGFpbmVyIC0tPgoJCQkJPC9kaXY+CgkJCTwvZm9vdGVyPiA8IS0tICNtYWluLWZvb3RlciAtLT4KCQk8L2Rpdj4gPCEtLSAjZXQtbWFpbi1hcmVhIC0tPgoKCgk8L2Rpdj4gPCEtLSAjcGFnZS1jb250YWluZXIgLS0+CgoJPCEtLSBCYWlkdSBBbmFseXRpY3MgLS0+DQo8c2NyaXB0Pg0KdmFyIF9obXQgPSBfaG10IHx8IFtdOw0KKGZ1bmN0aW9uKCkgew0KICB2YXIgaG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgaG0uc3JjID0gImh0dHBzOi8vaG0uYmFpZHUuY29tL2htLmpzPzZmMzAwN2QzZmUxNTI0NDk4MGVmZjU4OWY5ZDc4MDYzIjsNCiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07IA0KICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGhtLCBzKTsNCn0pKCk7DQo8L3NjcmlwdD4NCg0KPCEtLSBHb29nbGUgQW5hbHl0aWNzIC0tPg0KPHNjcmlwdCBhc3luYyBzcmM9Imh0dHBzOi8vd3d3Lmdvb2dsZXRhZ21hbmFnZXIuY29tL2d0YWcvanM/aWQ9VUEtNDMwMTc2NDctMSI+PC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICB3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsNCiAgZnVuY3Rpb24gZ3RhZygpe2RhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7fQ0KICBndGFnKCdqcycsIG5ldyBEYXRlKCkpOw0KICBndGFnKCdjb25maWcnLCAnVUEtNDMwMTc2NDctMScpOw0KPC9zY3JpcHQ+CjwhLS0gV1AgQXVkaW8gcGxheWVyIHBsdWdpbiB2MS45LjYgLSBodHRwczovL3d3dy50aXBzYW5kdHJpY2tzLWhxLmNvbS93b3JkcHJlc3MtYXVkaW8tbXVzaWMtcGxheWVyLXBsdWdpbi00NTU2LyAtLT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICAgICAgc291bmRNYW5hZ2VyLnVzZUZsYXNoQmxvY2sgPSB0cnVlOyAvLyBvcHRpb25hbCAtIGlmIHVzZWQsIHJlcXVpcmVkIGZsYXNoYmxvY2suY3NzDQogICAgICAgIHNvdW5kTWFuYWdlci51cmwgPSAnaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9zd2Yvc291bmRtYW5hZ2VyMi5zd2YnOw0KICAgICAgICBmdW5jdGlvbiBwbGF5X21wMyhmbGcsIGlkcywgbXAzdXJsLCB2b2x1bWUsIGxvb3BzKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL0NoZWNrIHRoZSBmaWxlIFVSTCBwYXJhbWV0ZXIgdmFsdWUNCiAgICAgICAgICAgIHZhciBwaWVjZXMgPSBtcDN1cmwuc3BsaXQoInwiKTsNCiAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMSkgey8vV2UgaGF2ZSBnb3QgYW4gLm9nZyBmaWxlIHRvbw0KICAgICAgICAgICAgICAgIG1wM2ZpbGUgPSBwaWVjZXNbMF07DQogICAgICAgICAgICAgICAgb2dnZmlsZSA9IHBpZWNlc1sxXTsNCiAgICAgICAgICAgICAgICAvL3NldCB0aGUgZmlsZSBVUkwgdG8gYmUgYW4gYXJyYXkgd2l0aCB0aGUgbXAzIGFuZCBvZ2cgZmlsZQ0KICAgICAgICAgICAgICAgIG1wM3VybCA9IG5ldyBBcnJheShtcDNmaWxlLCBvZ2dmaWxlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLmNyZWF0ZVNvdW5kKHsNCiAgICAgICAgICAgICAgICBpZDogJ2J0bnBsYXlfJyArIGlkcywNCiAgICAgICAgICAgICAgICB2b2x1bWU6IHZvbHVtZSwNCiAgICAgICAgICAgICAgICB1cmw6IG1wM3VybA0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGlmIChmbGcgPT0gJ3BsYXknKSB7DQogICAgICAgICAgICAgICAgICAgIHNvdW5kTWFuYWdlci5wbGF5KCdidG5wbGF5XycgKyBpZHMsIHsNCiAgICAgICAgICAgICAgICAgICAgb25maW5pc2g6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvb3BzID09ICd0cnVlJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZCgnYnRucGxheV8nICsgaWRzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuc3RvcF8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChmbGcgPT0gJ3N0b3AnKSB7DQogICAgLy9zb3VuZE1hbmFnZXIuc3RvcCgnYnRucGxheV8nK2lkcyk7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBhdXNlKCdidG5wbGF5XycgKyBpZHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIHNob3dfaGlkZShmbGFnLCBpZHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChmbGFnID09ICdwbGF5Jykgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoZmxhZyA9PSAnc3RvcCcpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRucGxheV8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmdW5jdGlvbiBsb29wU291bmQoc291bmRJRCkNCiAgICAgICAgew0KICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBsYXkoc291bmRJRCwge29uZmluaXNoOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZChzb3VuZElEKTsNCiAgICAgICAgICAgICAgICAgICAgfX0pOw0KICAgICAgICAgICAgfSwgMSk7DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gc3RvcF9hbGxfdHJhY2tzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLnN0b3BBbGwoKTsNCiAgICAgICAgICAgIHZhciBpbnB1dHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5wbGF5XyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsvL1RvZ2dsZSB0aGUgcGxheSBidXR0b24NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5zdG9wXyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Ly9IaWRlIHRoZSBzdG9wIGJ1dHRvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9mcm9udGVuZC1idWlsZGVyLWdsb2JhbC1mdW5jdGlvbnMuanM/dmVyPTIuNS4zJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvY3VzdG9tLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9qcXVlcnkuZml0dmlkcy5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvd2F5cG9pbnRzLm1pbi5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvanF1ZXJ5Lm1hZ25pZmljLXBvcHVwLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBldF9jdXN0b20gPSB7ImFqYXh1cmwiOiJodHRwczpcL1wvYmxvZy5pYmlyZW1lLmNvbVwvd3AtYWRtaW5cL2FkbWluLWFqYXgucGhwIiwiaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2ltYWdlcyIsImJ1aWxkZXJfaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2luY2x1ZGVzXC9idWlsZGVyXC9pbWFnZXMiLCJldF9sb2FkX25vbmNlIjoiZGM4NmFmOTNlMiIsInN1YnNjcmlwdGlvbl9mYWlsZWQiOiJQbGVhc2UsIGNoZWNrIHRoZSBmaWVsZHMgYmVsb3cgdG8gbWFrZSBzdXJlIHlvdSBlbnRlcmVkIHRoZSBjb3JyZWN0IGluZm9ybWF0aW9uLiIsImZpbGwiOiJGaWxsIiwiZmllbGQiOiJmaWVsZCIsImludmFsaWQiOiJJbnZhbGlkIGVtYWlsIiwiY2FwdGNoYSI6IkNhcHRjaGEiLCJwcmV2IjoiUHJldiIsInByZXZpb3VzIjoiXHU0ZTBhXHU0ZTAwXHU5ODc1IiwibmV4dCI6Ilx1NGUwYlx1NGUwMFx1OTg3NSIsImlzX2J1aWxkZXJfcGx1Z2luX3VzZWQiOiIifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvZnJvbnRlbmQtYnVpbGRlci1zY3JpcHRzLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy93cC1lbWJlZC5taW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==" srcset="/img/loading.gif" lazyload></p>
<p>一个 RunLoop 包含若干个 Mode，每个 Mode 又包含若干个 Source/Timer/Observer。每次调用 RunLoop 的主函数时，只能指定其中一个 Mode，这个 Mode 被称作 CurrentMode。如果需要切换 Mode，只能退出 Loop，再重新指定一个 Mode 进入。这样做主要是为了分隔开不同组的 Source/Timer/Observer，让其互不影响。</p>
<p><strong>CFRunLoopSourceRef</strong> 是事件产生的地方。Source 有两个版本：Source0 和 Source1。<br>• Source0 只包含了一个回调（函数指针），它并不能主动触发事件。使用时，你需要先调用 CFRunLoopSourceSignal(source)，将这个 Source 标记为待处理，然后手动调用 CFRunLoopWakeUp(runloop) 来唤醒 RunLoop，让其处理这个事件。<br>• Source1 包含了一个 mach_port 和一个回调（函数指针），被用于通过内核和其他线程相互发送消息。这种 Source 能主动唤醒 RunLoop 的线程，其原理在下面会讲到。</p>
<p><strong>CFRunLoopTimerRef</strong> 是基于时间的触发器，它和 NSTimer 是 toll-free bridged 的，可以混用。其包含一个时间长度和一个回调（函数指针）。当其加入到 RunLoop 时，RunLoop 会注册对应的时间点，当时间点到时，RunLoop 会被唤醒以执行那个回调。</p>
<p><strong>CFRunLoopObserverRef</strong> 是观察者，每个 Observer 都包含了一个回调（函数指针），当 RunLoop 的状态发生变化时，观察者就能通过回调接受到这个变化。可以观测的时间点有以下几个：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123;<br>    kCFRunLoopEntry         = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">0</span>), <span class="hljs-regexp">//</span> 即将进入Loop<br>    kCFRunLoopBeforeTimers  = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">1</span>), <span class="hljs-regexp">//</span> 即将处理 Timer<br>    kCFRunLoopBeforeSources = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">2</span>), <span class="hljs-regexp">//</span> 即将处理 Source<br>    kCFRunLoopBeforeWaiting = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">5</span>), <span class="hljs-regexp">//</span> 即将进入休眠<br>    kCFRunLoopAfterWaiting  = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">6</span>), <span class="hljs-regexp">//</span> 刚从休眠中唤醒<br>    kCFRunLoopExit          = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">7</span>), <span class="hljs-regexp">//</span> 即将退出Loop<br>&#125;;<br></code></pre></td></tr></table></figure>


<p>上面的 Source/Timer/Observer 被统称为 <strong>mode item</strong>，一个 item 可以被同时加入多个 mode。但一个 item 被重复加入同一个 mode 时是不会有效果的。如果一个 mode 中一个 item 都没有，则 RunLoop 会直接退出，不进入循环。</p>
<h2 id="RunLoop-的-Mode"><a href="#RunLoop-的-Mode" class="headerlink" title="RunLoop 的 Mode"></a>RunLoop 的 Mode</h2><p>CFRunLoopMode 和 CFRunLoop 的结构大致如下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk">struct __CFRunLoopMode &#123;<br>    CFStringRef _name;            <span class="hljs-regexp">//</span> Mode Name, 例如 @<span class="hljs-string">&quot;kCFRunLoopDefaultMode&quot;</span><br>    CFMutableSetRef _sources0;    <span class="hljs-regexp">//</span> Set<br>    CFMutableSetRef _sources1;    <span class="hljs-regexp">//</span> Set<br>    CFMutableArrayRef _observers; <span class="hljs-regexp">//</span> Array<br>    CFMutableArrayRef _timers;    <span class="hljs-regexp">//</span> Array<br>    ...<br>&#125;;<br> <br>struct __CFRunLoop &#123;<br>    CFMutableSetRef _commonModes;     <span class="hljs-regexp">//</span> Set<br>    CFMutableSetRef _commonModeItems; <span class="hljs-regexp">//</span> Set&lt;Source<span class="hljs-regexp">/Observer/</span>Timer&gt;<br>    CFRunLoopModeRef _currentMode;    <span class="hljs-regexp">//</span> Current Runloop Mode<br>    CFMutableSetRef _modes;           <span class="hljs-regexp">//</span> Set<br>    ...<br>&#125;;<br></code></pre></td></tr></table></figure>


<p>这里有个概念叫 “CommonModes”：一个 Mode 可以将自己标记为 “Common” 属性（通过将其 ModeName 添加到 RunLoop 的 “commonModes” 中）。每当 RunLoop 的内容发生变化时，RunLoop 都会自动将 _commonModeItems 里的 Source/Observer/Timer 同步到具有 “Common” 标记的所有 Mode 里。</p>
<p>应用场景举例：主线程的 RunLoop 里有两个预置的 Mode：kCFRunLoopDefaultMode 和 UITrackingRunLoopMode。这两个 Mode 都已经被标记为 “Common” 属性。DefaultMode 是 App 平时所处的状态，TrackingRunLoopMode 是追踪 ScrollView 滑动时的状态。当你创建一个 Timer 并加到 DefaultMode 时，Timer 会得到重复回调，但此时滑动一个 TableView 时，RunLoop 会将 mode 切换为 TrackingRunLoopMode，这时 Timer 就不会被回调，并且也不会影响到滑动操作。</p>
<p>有时你需要一个 Timer，在两个 Mode 中都能得到回调，一种办法就是将这个 Timer 分别加入这两个 Mode。还有一种方式，就是将 Timer 加入到顶层的 RunLoop 的 “commonModeItems” 中。”commonModeItems” 被 RunLoop 自动更新到所有具有 “Common” 属性的 Mode 里去。</p>
<p>CFRunLoop 对外暴露的管理 Mode 接口只有下面 2 个:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">CFRunLoopAddCommonMode</span>(<span class="hljs-built_in">CFRunLoopRef</span> runloop, <span class="hljs-built_in">CFStringRef</span> modeName);<br><span class="hljs-built_in">CFRunLoopRunInMode</span>(<span class="hljs-built_in">CFStringRef</span> modeName, ...);<br></code></pre></td></tr></table></figure>

<p>Mode 暴露的管理 mode item 的接口有下面几个：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">CFRunLoopAddSource</span>(<span class="hljs-built_in">CFRunLoopRef</span> rl, <span class="hljs-built_in">CFRunLoopSourceRef</span> source, <span class="hljs-built_in">CFStringRef</span> modeName);<br><span class="hljs-built_in">CFRunLoopAddObserver</span>(<span class="hljs-built_in">CFRunLoopRef</span> rl, <span class="hljs-built_in">CFRunLoopObserverRef</span> observer, <span class="hljs-built_in">CFStringRef</span> modeName);<br><span class="hljs-built_in">CFRunLoopAddTimer</span>(<span class="hljs-built_in">CFRunLoopRef</span> rl, <span class="hljs-built_in">CFRunLoopTimerRef</span> timer, <span class="hljs-built_in">CFStringRef</span> mode);<br><span class="hljs-built_in">CFRunLoopRemoveSource</span>(<span class="hljs-built_in">CFRunLoopRef</span> rl, <span class="hljs-built_in">CFRunLoopSourceRef</span> source, <span class="hljs-built_in">CFStringRef</span> modeName);<br><span class="hljs-built_in">CFRunLoopRemoveObserver</span>(<span class="hljs-built_in">CFRunLoopRef</span> rl, <span class="hljs-built_in">CFRunLoopObserverRef</span> observer, <span class="hljs-built_in">CFStringRef</span> modeName);<br><span class="hljs-built_in">CFRunLoopRemoveTimer</span>(<span class="hljs-built_in">CFRunLoopRef</span> rl, <span class="hljs-built_in">CFRunLoopTimerRef</span> timer, <span class="hljs-built_in">CFStringRef</span> mode);<br></code></pre></td></tr></table></figure>

<p>你只能通过 mode name 来操作内部的 mode，当你传入一个新的 mode name 但 RunLoop 内部没有对应 mode 时，RunLoop 会自动帮你创建对应的 CFRunLoopModeRef。对于一个 RunLoop 来说，其内部的 mode 只能增加不能删除。</p>
<p>苹果公开提供的 Mode 有两个：kCFRunLoopDefaultMode (NSDefaultRunLoopMode) 和 UITrackingRunLoopMode，你可以用这两个 Mode Name 来操作其对应的 Mode。</p>
<p>同时苹果还提供了一个操作 Common 标记的字符串：kCFRunLoopCommonModes (NSRunLoopCommonModes)，你可以用这个字符串来操作 Common Items，或标记一个 Mode 为 “Common”。使用时注意区分这个字符串和其他 mode name。</p>
<h2 id="RunLoop-的内部逻辑"><a href="#RunLoop-的内部逻辑" class="headerlink" title="RunLoop 的内部逻辑"></a>RunLoop 的内部逻辑</h2><p>根据苹果在<a target="_blank" rel="noopener" href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW23">文档</a>里的说明，RunLoop 内部的逻辑大致如下:</p>
<p>[<img src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+DQo8IS0tW2lmIElFIDZdPg0KPGh0bWwgaWQ9ImllNiIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDddPg0KPGh0bWwgaWQ9ImllNyIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDhdPg0KPGh0bWwgaWQ9ImllOCIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmICEoSUUgNikgfCAhKElFIDcpIHwgIShJRSA4KSAgXT48IS0tPg0KPGh0bWwgbGFuZz0iemgtQ04iPg0KPCEtLTwhW2VuZGlmXS0tPg0KPGhlYWQ+DQoJPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+DQoJPHRpdGxlPjQwNCDmnKrmib7liLAgfCBHYXJhbiBubyBkb3U8L3RpdGxlPg0KCQkJDQoJDQoJPGxpbmsgcmVsPSJwaW5nYmFjayIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3htbHJwYy5waHAiIC8+DQoNCgkJPCEtLVtpZiBsdCBJRSA5XT4NCgk8c2NyaXB0IHNyYz0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvaHRtbDUuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQoJPCFbZW5kaWZdLS0+DQoNCgk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUgPSAnanMnOw0KCTwvc2NyaXB0Pg0KDQoJPGxpbmsgcmVsPSdkbnMtcHJlZmV0Y2gnIGhyZWY9Jy8vZm9udHMuZ29vZ2xlYXBpcy5jb20nIC8+CjxsaW5rIHJlbD0nZG5zLXByZWZldGNoJyBocmVmPScvL3Mudy5vcmcnIC8+CjxsaW5rIHJlbD0iYWx0ZXJuYXRlIiB0eXBlPSJhcHBsaWNhdGlvbi9yc3MreG1sIiB0aXRsZT0iR2FyYW4gbm8gZG91ICZyYXF1bzsgRmVlZCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2ZlZWQvIiAvPgo8bGluayByZWw9ImFsdGVybmF0ZSIgdHlwZT0iYXBwbGljYXRpb24vcnNzK3htbCIgdGl0bGU9IkdhcmFuIG5vIGRvdSAmcmFxdW87IOivhOiuukZlZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jb21tZW50cy9mZWVkLyIgLz4KPG1ldGEgY29udGVudD0iRGl2aSB2LjIuNS4zIiBuYW1lPSJnZW5lcmF0b3IiLz48bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdzY2FwLmZsYXNoYmxvY2stY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvZmxhc2hibG9jay5jc3M/dmVyPTUuNC42JyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nc2NhcC5wbGF5ZXItY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvcGxheWVyLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdjcmF5b24tY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jcmF5b24tc3ludGF4LWhpZ2hsaWdodGVyL2Nzcy9taW4vY3JheW9uLm1pbi5jc3M/dmVyPV8yLjcuMl9iZXRhJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nd3AtZWFzeWFyY2hpdmVzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3BsdWdpbnMvd3AtZWFzeWFyY2hpdmVzL2Nzcy93cC1lYXN5YXJjaGl2ZXMuY3NzP3Zlcj0zLjEuMicgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdzY3JlZW4nIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J3dwLWJsb2NrLWxpYnJhcnktY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2Nzcy9kaXN0L2Jsb2NrLWxpYnJhcnkvc3R5bGUubWluLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdtYXRoLWNhcHRjaGEtZnJvbnRlbmQtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy93cC1tYXRoLWNhcHRjaGEvY3NzL2Zyb250ZW5kLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSd3cC1wYWdlbmF2aS1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3dwLXBhZ2VuYXZpL3BhZ2VuYXZpLWNzcy5jc3M/dmVyPTIuNzAnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdkaXZpLWZvbnRzLWNzcycgIGhyZWY9J2h0dHBzOi8vZm9udHMubG9saS5uZXQvY3NzP2ZhbWlseT1PcGVuK1NhbnM6MzAwaXRhbGljLDQwMGl0YWxpYyw2MDBpdGFsaWMsNzAwaXRhbGljLDgwMGl0YWxpYyw0MDAsMzAwLDYwMCw3MDAsODAwJiMwMzg7c3Vic2V0PWxhdGluLGxhdGluLWV4dCcgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LWdmLWNoaW5lc2UtY3NzJyAgaHJlZj0nLy9mb250cy5sb2xpLm5ldC9lYXJseWFjY2Vzcy9jd3RleGZhbmdzb25nLmNzcycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2Rpdmktc3R5bGUtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0Rpdmkvc3R5bGUuY3NzP3Zlcj0yLjUuMycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LXNob3J0Y29kZXMtY3NzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2VwYW5lbC9zaG9ydGNvZGVzL2Nzcy9zaG9ydGNvZGVzLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nZXQtc2hvcnRjb2Rlcy1yZXNwb25zaXZlLWNzcy1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9lcGFuZWwvc2hvcnRjb2Rlcy9jc3Mvc2hvcnRjb2Rlc19yZXNwb25zaXZlLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9qcy9zb3VuZG1hbmFnZXIyLW5vZGVidWctanNtaW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2pzL2pxdWVyeS9qcXVlcnkuanM/dmVyPTEuMTIuNC13cCc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy9qcXVlcnkvanF1ZXJ5LW1pZ3JhdGUubWluLmpzP3Zlcj0xLjQuMSc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBDcmF5b25TeW50YXhTZXR0aW5ncyA9IHsidmVyc2lvbiI6Il8yLjcuMl9iZXRhIiwiaXNfYWRtaW4iOiIwIiwiYWpheHVybCI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1hZG1pblwvYWRtaW4tYWpheC5waHAiLCJwcmVmaXgiOiJjcmF5b24tIiwic2V0dGluZyI6ImNyYXlvbi1zZXR0aW5nIiwic2VsZWN0ZWQiOiJjcmF5b24tc2V0dGluZy1zZWxlY3RlZCIsImNoYW5nZWQiOiJjcmF5b24tc2V0dGluZy1jaGFuZ2VkIiwic3BlY2lhbCI6ImNyYXlvbi1zZXR0aW5nLXNwZWNpYWwiLCJvcmlnX3ZhbHVlIjoiZGF0YS1vcmlnLXZhbHVlIiwiZGVidWciOiIifTsKdmFyIENyYXlvblN5bnRheFN0cmluZ3MgPSB7ImNvcHkiOiJQcmVzcyAlcyB0byBDb3B5LCAlcyB0byBQYXN0ZSIsIm1pbmltaXplIjoiQ2xpY2sgVG8gRXhwYW5kIENvZGUifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL2NyYXlvbi1zeW50YXgtaGlnaGxpZ2h0ZXIvanMvbWluL2NyYXlvbi5taW4uanM/dmVyPV8yLjcuMl9iZXRhJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9zaW1wbGVzbWlsZXlzaG93L2pxdWVyeS5pbnNlcnRhdGNhcmV0LmpzJz48L3NjcmlwdD4KPGxpbmsgcmVsPSdodHRwczovL2FwaS53Lm9yZy8nIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1qc29uLycgLz4KPGxpbmsgcmVsPSJFZGl0VVJJIiB0eXBlPSJhcHBsaWNhdGlvbi9yc2QreG1sIiB0aXRsZT0iUlNEIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20veG1scnBjLnBocD9yc2QiIC8+CjxsaW5rIHJlbD0id2x3bWFuaWZlc3QiIHR5cGU9ImFwcGxpY2F0aW9uL3dsd21hbmlmZXN0K3htbCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL3dsd21hbmlmZXN0LnhtbCIgLz4gCjxtZXRhIG5hbWU9ImdlbmVyYXRvciIgY29udGVudD0iV29yZFByZXNzIDUuNC42IiAvPgoKPCEtLSBHZW5lcmF0ZWQgQnkgU2hvdy1Vc2VyQWdlbnQgMS4wLjggLSBodHRwOi8vemx6LmltL3Nob3ctdXNlcmFnZW50LyAtLT4KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3Nob3ctdXNlcmFnZW50L3Nob3ctdXNlcmFnZW50LmNzcyIgdHlwZT0idGV4dC9jc3MiIG1lZGlhPSJzY3JlZW4iIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT0wIiAvPgkJPHN0eWxlIGlkPSJ0aGVtZS1jdXN0b21pemVyLWNzcyI+DQoJCQkJCQkJCQkJCQkJLndvb2NvbW1lcmNlICNyZXNwb25kIGlucHV0I3N1Ym1pdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LCAud29vY29tbWVyY2UgI2NvbnRlbnQgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSAjY29udGVudCBpbnB1dC5idXR0b24sIC53b29jb21tZXJjZS1tZXNzYWdlLCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1pbmZvIHsgYmFja2dyb3VuZDogI2E5ZDMwMCAhaW1wb3J0YW50OyB9DQoJCQkjZXRfc2VhcmNoX2ljb246aG92ZXIsIC5tb2JpbGVfbWVudV9iYXI6YmVmb3JlLCAuZXQtc29jaWFsLWljb24gYTpob3ZlciwgLmV0X3BiX3N1bSwgLmV0X3BiX3ByaWNpbmcgbGkgYSwgLmV0X3BiX3ByaWNpbmdfdGFibGVfYnV0dG9uLCAuZXRfb3ZlcmxheTpiZWZvcmUsIC5lbnRyeS1zdW1tYXJ5IHAucHJpY2UgaW5zLCAud29vY29tbWVyY2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UtcGFnZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLmV0X3BiX21lbWJlcl9zb2NpYWxfbGlua3MgYTpob3ZlciwgLndvb2NvbW1lcmNlIC5zdGFyLXJhdGluZyBzcGFuOmJlZm9yZSwgLndvb2NvbW1lcmNlLXBhZ2UgLnN0YXItcmF0aW5nIHNwYW46YmVmb3JlLCAuZXRfcGJfd2lkZ2V0IGxpIGE6aG92ZXIsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydGZvbGlvX2ZpbHRlcnMgbGkgYS5hY3RpdmUsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydG9mb2xpb19wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAuZXRfcGJfZ2FsbGVyeSAuZXRfcGJfZ2FsbGVyeV9wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAud3AtcGFnZW5hdmkgc3Bhbi5jdXJyZW50LCAud3AtcGFnZW5hdmkgYTpob3ZlciwgLm5hdi1zaW5nbGUgYSwgLnBvc3RlZF9pbiBhIHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCS5ldF9wYl9jb250YWN0X3N1Ym1pdCwgLmV0X3Bhc3N3b3JkX3Byb3RlY3RlZF9mb3JtIC5ldF9zdWJtaXRfYnV0dG9uLCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9uZXdzbGV0dGVyX2J1dHRvbiwgLmNvbW1lbnQtcmVwbHktbGluaywgLmZvcm0tc3VibWl0IGlucHV0LCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9wcm9tb19idXR0b24sIC5ldF9wYl9iZ19sYXlvdXRfbGlnaHQgLmV0X3BiX21vcmVfYnV0dG9uLCAud29vY29tbWVyY2UgYS5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBhLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgYnV0dG9uLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBhLmJ1dHRvbiwgLndvb2NvbW1lcmNlLXBhZ2UgYS5idXR0b24sIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24geyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmZvb3Rlci13aWRnZXQgaDQgeyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmV0LXNlYXJjaC1mb3JtLCAubmF2IGxpIHVsLCAuZXRfbW9iaWxlX21lbnUsIC5mb290ZXItd2lkZ2V0IGxpOmJlZm9yZSwgLmV0X3BiX3ByaWNpbmcgbGk6YmVmb3JlLCBibG9ja3F1b3RlIHsgYm9yZGVyLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkuZXRfcGJfY291bnRlcl9hbW91bnQsIC5ldF9wYl9mZWF0dXJlZF90YWJsZSAuZXRfcGJfcHJpY2luZ19oZWFkaW5nLCAuZXRfcXVvdGVfY29udGVudCwgLmV0X2xpbmtfY29udGVudCwgLmV0X2F1ZGlvX2NvbnRlbnQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkJCQkJLmNvbnRhaW5lciwgLmV0X3BiX3JvdywgLmV0X3BiX3NsaWRlciAuZXRfcGJfY29udGFpbmVyLCAuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24gLmV0X3BiX3RpdGxlX2NvbnRhaW5lciwgLmV0X3BiX2Z1bGx3aWR0aF9zZWN0aW9uIC5ldF9wYl90aXRsZV9mZWF0dXJlZF9jb250YWluZXIsIC5ldF9wYl9mdWxsd2lkdGhfaGVhZGVyOm5vdCguZXRfcGJfZnVsbHNjcmVlbikgLmV0X3BiX2Z1bGx3aWR0aF9oZWFkZXJfY29udGFpbmVyIHsgbWF4LXdpZHRoOiA5NjBweDsgfQ0KCQkJLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIsIC5ldF9maXhlZF9uYXYuZXRfYm94ZWRfbGF5b3V0ICNwYWdlLWNvbnRhaW5lciAjdG9wLWhlYWRlciwgLmV0X2ZpeGVkX25hdi5ldF9ib3hlZF9sYXlvdXQgI3BhZ2UtY29udGFpbmVyICNtYWluLWhlYWRlciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmNvbnRhaW5lciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmV0X3BiX3JvdyB7IG1heC13aWR0aDogMTEyMHB4OyB9DQoJCQkJCQkJYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI3RvcC1oZWFkZXIsICNldC1zZWNvbmRhcnktbmF2IGxpIHVsIHsgYmFja2dyb3VuZC1jb2xvcjogI2E5ZDMwMDsgfQ0KCQkJCQkJCQkjdG9wLWhlYWRlciwgI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQkJCQkJCQkJCQ0KCQkNCgkJCQkJI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX3JlZCAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9yZWQgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfcGluayAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9waW5rICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX29yYW5nZSAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9vcmFuZ2UgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsIC5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI21haW4tZm9vdGVyIC5mb290ZXItd2lkZ2V0IGg0IHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkuZm9vdGVyLXdpZGdldCBsaTpiZWZvcmUgeyBib3JkZXItY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkNCgkJDQoJCQ0KCQlAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWluLXdpZHRoOiA5ODFweCApIHsNCgkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIsIC5ldC1maXhlZC1oZWFkZXIjdG9wLWhlYWRlciAjZXQtc2Vjb25kYXJ5LW5hdiBsaSB1bCB7IGJhY2tncm91bmQtY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtYW5jZXN0b3IgPiBhLA0KCQkJCS5ldC1maXhlZC1oZWFkZXIgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjICFpbXBvcnRhbnQ7IH0NCgkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQ0KCQkJCQl9DQoJCUBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKCBtaW4td2lkdGg6IDEyMDBweCkgew0KCQkJLmV0X3BiX3JvdyB7IHBhZGRpbmc6IDI0cHggMDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24geyBwYWRkaW5nOiA0OHB4IDA7IH0NCgkJCS5zaW5nbGUuZXRfcGJfcGFnZWJ1aWxkZXJfbGF5b3V0LmV0X2Z1bGxfd2lkdGhfcGFnZSAuZXRfcG9zdF9tZXRhX3dyYXBwZXIgeyBwYWRkaW5nLXRvcDogNzJweDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24uZXRfcGJfc2VjdGlvbl9maXJzdCB7IHBhZGRpbmctdG9wOiBpbmhlcml0OyB9DQoJCQkuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24geyBwYWRkaW5nOiAwOyB9DQoJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogOTgwcHggKSB7DQoJCQkJCQkJCQkJCQkJCQkJCQkJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogNzY3cHggKSB7DQoJCQkJCQkJCQkJCQkJCX0NCgk8L3N0eWxlPg0KDQoJPHN0eWxlIGNsYXNzPSJldF9vbmVfZm9udF9sYW5ndWFnZXMiPmgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGJvZHksIGlucHV0LCB0ZXh0YXJlYSwgc2VsZWN0IHsgZm9udC1mYW1pbHk6ICdjd1RlWEZhbmdTb25nJywgc2VyaWY7IH08L3N0eWxlPg0KCQ0KCTxzdHlsZSBpZD0ibW9kdWxlLWN1c3RvbWl6ZXItY3NzIj4NCgkJCTwvc3R5bGU+DQoNCgk8IS0tIEFsbCBpbiBvbmUgRmF2aWNvbiA0LjcgLS0+PGxpbmsgcmVsPSJpY29uIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTMvMDgvZmF2aWNvbi5wbmciIHR5cGU9ImltYWdlL3BuZyIvPgo8bGluayByZWw9ImFwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxMy8wOC9mYXZpY29uMi5wbmciIC8+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyIgaWQ9ImV0LWN1c3RvbS1jc3MiPgpoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBib2R5LCBpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCB7DQpmb250LWZhbWlseTogJ1BpbmdGYW5nIFNDJywgJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgVmVyZGFuYSwgJ0hpcmFnaW5vIFNhbnMgR0InLCAnTm90byBTYW5zIENKSyBTQycsICdTb3VyY2UgSGFuIFNhbnMgQ04nLCBTVEhlaXRpLCAnTWljcm9zb2Z0IFlhSGVpJywgJ1dlblF1YW5ZaSBNaWNybyBIZWknLCBTaW1TdW4sIHNhbnMtc2VyaWY7DQpmb250LXdlaWdodDogNDAwOw0KfQ0KDQojbWFpbi1oZWFkZXIgew0KICAgIGJhY2tncm91bmQ6IGhzbGEoMCwgMCUsIDEwMCUsIC44NSk7DQogICAgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTJweCk7DQogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEycHgpOw0KfQ0KDQpib2R5IHsgDQoJZm9udC1zaXplOiAxNnB4Ow0KCWNvbG9yOiAjMWQxZDFkOw0KCXdvcmQtd3JhcDpicmVhay13b3JkOw0KCXdvcmQtYnJlYWs6IG5vcm1hbDsNCn0NCg0KcCB7DQoJbWFyZ2luOiAwLjllbSAwIDAuNWVtOw0KCXBhZGRpbmctYm90dG9tOiAwLjZlbTsNCglmb250LXNpemU6IDEwMCU7DQoJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOw0KfQ0KDQouZXRfcGJfcG9zdCBoMiB7DQoJZm9udC13ZWlnaHQ6IGJvbGQ7DQp9DQoNCi5ldF9wYl9wb3N0IC5wb3N0LW1ldGEgew0KCTE0cHggIkNsYXNzaWMgR3JvdGVzcXVlIFcwMSIsIEFyaWFsLCBzYW5zLXNlcmlmOw0KfQ0KDQouZXRfcGJfcG9zdCB7DQoJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlMmUyZTI7DQoJcGFkZGluZy1ib3R0b206IDIwcHg7DQp9DQoNCi5ldF9wYl9wb3N0Omxhc3Qtb2YtdHlwZSB7DQoJYm9yZGVyLWJvdHRvbTogMHB4IHNvbGlkICNlMmUyZTI7DQp9DQoNCiNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB7DQoJcGFkZGluZy10b3A6IDMwcHg7DQp9DQoNCi5ldF9yaWdodF9zaWRlYmFyICNzaWRlYmFyIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmhvbWUgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMHB4Ow0KfQ0KDQouc2luZ2xlLXBvc3QgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmV0X3BiX3Bvc3Qgew0KICBtYXJnaW4tYm90dG9tOiA0MHB4Ow0KfQ0KDQouZXRfcGJfcG9zdCAuZW50cnktY29udGVudCwgDQoucHJvamVjdCAuZW50cnktY29udGVudCB7DQogIHBhZGRpbmctdG9wOiAxMHB4Ow0KfQ0KDQoud2lkZ2V0X2Fib3V0bWV3aWRnZXQgLmNsZWFyZml4LA0KLmV0X3BiX3dpZGdldCBsaSB7DQoJZm9udC1zaXplOiA5MyU7DQp9DQoNCi53aWRnZXR0aXRsZSB7DQoJZm9udC1zaXplOiAxMjAlOw0KfQ0KDQouZXRfcGJfc2Nyb2xsX3RvcCB7DQogICAgYm90dG9tOiAxNXB4Ow0KfQ0KDQojdG9wLW1lbnUgbGkgPiBhLCANCi5mdWxsd2lkdGgtbWVudSBsaSA+IGEgew0KCWZvbnQtc2l6ZTogMTRweDsNCglmb250LXdlaWdodDogNDAwOw0KfQ0KDQojZm9vdGVyLWJvdHRvbSB7DQoJcGFkZGluZzogNXB4IDAgN3B4Ow0KfQ0KDQppbWcud3Atc21pbGV5IHsNCgltYXgtaGVpZ2h0OiAxLjJlbSAhaW1wb3J0YW50Ow0KCWhlaWdodDogMS4yZW0gIWltcG9ydGFudDsNCgl3aWR0aDogMS4yZW0gIWltcG9ydGFudDsNCn0NCg0KLndwLXNtaWxleWxpbmsgew0KCW1heC13aWR0aDogMjJweCAhaW1wb3J0YW50Ow0KfQ0KDQojbGVmdC1hcmVhIGE6aG92ZXIgew0KCXRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQojY29tbWVudGZvcm0gdGV4dGFyZWEsIA0KI2NvbW1lbnRmb3JtIGlucHV0W3R5cGU9InRleHQiXSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KfQ0KDQpAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWF4LXdpZHRoOiA3NjdweCApIHsNCgkuZXRfcGJfcm93LCAuY29udGFpbmVyLCAuZXRfcGJfY29udGFpbmVyIHsgd2lkdGg6IDg1JTsgfQ0KCS5ldF9wYl9wb3N0IGgyLCAuZXRfcGJfcG9ydGZvbGlvX2l0ZW0gaDIgeyBmb250LXNpemU6IDI0cHg7IH0NCgkuY29tbWVudC1ib2R5IHsgcGFkZGluZzogMCAwIDI1cHggMTAwcHg7IH0NCn0NCg0KI2R5bmFtaWMtdG8tdG9wIHsNCglkaXNwbGF5Om5vbmU7DQoJb3ZlcmZsb3c6aGlkZGVuOw0KCXdpZHRoOmF1dG87DQoJei1pbmRleDo5MDsNCglwb3NpdGlvbjpmaXhlZDsNCgl0b3A6YXV0bzsNCglsZWZ0OmF1dG87DQoJZm9udC1mYW1pbHk6c2Fucy1zZXJpZjsNCglmb250LXNpemU6MWVtOw0KCWNvbG9yOiNmZmY7DQoJdGV4dC1kZWNvcmF0aW9uOm5vbmU7DQoJdGV4dC1zaGFkb3c6MCAxcHggMCAjMzMzOw0KCWZvbnQtd2VpZ2h0OmJvbGQ7DQoJcGFkZGluZzoxN3B4IDE2cHg7DQoJYm9yZGVyOjBweCBzb2xpZCAjMDAwOw0KCWJhY2tncm91bmQ6IzExMTsNCgktd2Via2l0LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktbW96LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktaWNhYi1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJLWtodG1sLWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktby1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJYmFja2dyb3VuZC1vcmlnaW46Ym9yZGVyOw0KCS13ZWJraXQtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1tb3otYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1pY2FiLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgkta2h0bWwtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1vLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgliYWNrZ3JvdW5kLWNsaXA6cGFkZGluZy1ib3g7DQoJLXdlYmtpdC1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktbXMtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLW1vei1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktby1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgkta2h0bWwtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLWljYWItYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLXdlYmtpdC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLW1vei1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLWljYWItYm9yZGVyLXJhZGl1czoyM3B4Ow0KCS1raHRtbC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJYm9yZGVyLXJhZGl1czoyM3B4DQp9DQojZHluYW1pYy10by10b3A6aG92ZXIgew0KCWJhY2tncm91bmQ6IzRkNGRhYzsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1ncmFkaWVudCggbGluZWFyLCAwJSAwJSwgMCUgMTAwJSwgZnJvbSggcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSApLCB0byggcmdiYSggMCwgMCwgMCwgMCApICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1raHRtbC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tb3otbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzA4ZiAtby1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tcy1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1pY2FiLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAyNTUsIDI1NSwgMjU1LCAuMiApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWN1cnNvcjpwb2ludGVyDQp9DQojZHluYW1pYy10by10b3A6YWN0aXZlIHsNCgliYWNrZ3JvdW5kOiMxMTE7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtZ3JhZGllbnQoIGxpbmVhciwgMCUgMCUsIDAlIDEwMCUsIGZyb20oIHJnYmEoIDAsIDAsIDAsIC4zICkgKSwgdG8oIHJnYmEoIDAsIDAsIDAsIDAgKSApICk7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbW96LWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLWtodG1sLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLW8tbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbXMtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtaWNhYi1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMCwgMCwgMCwgLjEgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMTExIGxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKQ0KfQ0KI2R5bmFtaWMtdG8tdG9wLCNkeW5hbWljLXRvLXRvcDphY3RpdmUsI2R5bmFtaWMtdG8tdG9wOmZvY3VzLCNkeW5hbWljLXRvLXRvcDpob3ZlciB7DQoJb3V0bGluZTpub25lDQp9DQojZHluYW1pYy10by10b3Agc3BhbiB7DQoJZGlzcGxheTpibG9jazsNCglvdmVyZmxvdzpoaWRkZW47DQoJd2lkdGg6MTRweDsNCgloZWlnaHQ6MTJweDsNCgliYWNrZ3JvdW5kOnVybCgvd3AtY29udGVudC9wbHVnaW5zL2R5bmFtaWMtdG8tdG9wL2Nzcy9pbWFnZXMvdXAucG5nICluby1yZXBlYXQgY2VudGVyIGNlbnRlcg0KfQ0KDQouZW50cnktY29udGVudCB0YWJsZSwgYm9keS5ldC1wYi1wcmV2aWV3ICNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB0YWJsZSB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0MxQzFDMTsNCiAgICBsaW5lLWhlaWdodDogMS40ZW07DQoNCiAgICBib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlOw0KfQ0KDQp0aGVhZCB7DQoJYmFja2dyb3VuZC1jb2xvcjogI0YxRjFGMTsNCn0NCg0KcCNjb3B5cmlnaHQgew0KICAgIGNvbG9yOiAjNzE3MTcxOw0KfQo8L3N0eWxlPjwvaGVhZD4NCjxib2R5IGNsYXNzPSJlcnJvcjQwNCBldF9wYl9idXR0b25faGVscGVyX2NsYXNzIGV0X2ZpeGVkX25hdiBldF9zaG93X25hdiBldF9jb3Zlcl9iYWNrZ3JvdW5kIGV0X3BiX2d1dHRlciBvc3ggZXRfcGJfZ3V0dGVyczMgZXRfcHJpbWFyeV9uYXZfZHJvcGRvd25fYW5pbWF0aW9uX2ZhZGUgZXRfc2Vjb25kYXJ5X25hdl9kcm9wZG93bl9hbmltYXRpb25fZmFkZSBldF9wYl9mb290ZXJfY29sdW1uczQgZXRfaGVhZGVyX3N0eWxlX2xlZnQgZXRfcmlnaHRfc2lkZWJhciBjaHJvbWUiPg0KCTxkaXYgaWQ9InBhZ2UtY29udGFpbmVyIj4NCg0KCQ0KCQk8aGVhZGVyIGlkPSJtYWluLWhlYWRlciIgZGF0YS1oZWlnaHQtb25sb2FkPSI2NiI+DQoJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgY2xlYXJmaXggZXRfbWVudV9jb250YWluZXIiPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImxvZ29fY29udGFpbmVyIj4NCgkJCQkJPHNwYW4gY2xhc3M9ImxvZ29faGVscGVyIj48L3NwYW4+DQoJCQkJCTxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQkJPGltZyBzcmM9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxNS8wNS9sb2dvMS5wbmciIGFsdD0iR2FyYW4gbm8gZG91IiBpZD0ibG9nbyIgZGF0YS1oZWlnaHQtcGVyY2VudGFnZT0iNTQiIC8+DQoJCQkJCTwvYT4NCgkJCQk8L2Rpdj4NCgkJCQk8ZGl2IGlkPSJldC10b3AtbmF2aWdhdGlvbiIgZGF0YS1oZWlnaHQ9IjY2IiBkYXRhLWZpeGVkLWhlaWdodD0iNDAiPg0KCQkJCQk8bmF2IGlkPSJ0b3AtbWVudS1uYXYiPg0KCQkJCQkJCQkJCQk8dWwgaWQ9InRvcC1tZW51IiBjbGFzcz0ibmF2Ij4NCgkJCQkJCQkJCQkJCQkJCTxsaSA+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tLyI+6aaW6aG1PC9hPjwvbGk+DQoJCQkJCQkJDQoJCQkJCQkJPGxpIGNsYXNzPSJwYWdlX2l0ZW0gcGFnZS1pdGVtLTM0Ij48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vYWJvdXQvIj5BYm91dDwvYT48L2xpPgo8bGkgY2xhc3M9InBhZ2VfaXRlbSBwYWdlLWl0ZW0tNDE1MDIiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9hcmNoaXZlLyI+QXJjaGl2ZTwvYT48L2xpPgoJCQkJCQkJCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2FjZy8iPkFDRzwvYT4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMSI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L290aGVyLyI+5YW25LuWPC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2NoaXJydXAvIj7lkJDmp708L2E+CjwvbGk+Cgk8bGkgY2xhc3M9ImNhdC1pdGVtIGNhdC1pdGVtLTExIj48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vY2F0ZWdvcnkvdGVjLyI+5oqA5pyvPC9hPgo8dWwgY2xhc3M9J2NoaWxkcmVuJz4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMzAiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jYXRlZ29yeS90ZWMvaW9zLXRlYy8iPmlPUzwvYT4KPC9saT4KPC91bD4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNyI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2RhaWx5LyI+5pel5bi4PC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMiI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2Rlc2lnbi8iPuiuvuiuoTwvYT4KPC9saT4KCQkJCQkJPC91bD4NCgkJCQkJCQkJCQk8L25hdj4NCg0KCQkJCQkNCgkJCQkJDQoJCQkJCTxkaXYgaWQ9ImV0X21vYmlsZV9uYXZfbWVudSI+DQoJCQk8ZGl2IGNsYXNzPSJtb2JpbGVfbmF2IGNsb3NlZCI+DQoJCQkJPHNwYW4gY2xhc3M9InNlbGVjdF9wYWdlIj7pgInmi6npobXpnaI8L3NwYW4+DQoJCQkJPHNwYW4gY2xhc3M9Im1vYmlsZV9tZW51X2JhciI+PC9zcGFuPg0KCQkJPC9kaXY+DQoJCTwvZGl2PgkJCQk8L2Rpdj4gPCEtLSAjZXQtdG9wLW5hdmlnYXRpb24gLS0+DQoJCQk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KCQkJPGRpdiBjbGFzcz0iZXRfc2VhcmNoX291dGVyIj4NCgkJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgZXRfc2VhcmNoX2Zvcm1fY29udGFpbmVyIj4NCgkJCQkJPGZvcm0gcm9sZT0ic2VhcmNoIiBtZXRob2Q9ImdldCIgY2xhc3M9ImV0LXNlYXJjaC1mb3JtIiBhY3Rpb249Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQk8aW5wdXQgdHlwZT0ic2VhcmNoIiBjbGFzcz0iZXQtc2VhcmNoLWZpZWxkIiBwbGFjZWhvbGRlcj0i5pCc57SiICZoZWxsaXA7IiB2YWx1ZT0iIiBuYW1lPSJzIiB0aXRsZT0i5pCc57Si77yaIiAvPgkJCQkJPC9mb3JtPg0KCQkJCQk8c3BhbiBjbGFzcz0iZXRfY2xvc2Vfc2VhcmNoX2ZpZWxkIj48L3NwYW4+DQoJCQkJPC9kaXY+DQoJCQk8L2Rpdj4NCgkJPC9oZWFkZXI+IDwhLS0gI21haW4taGVhZGVyIC0tPg0KDQoJCTxkaXYgaWQ9ImV0LW1haW4tYXJlYSI+DQo8ZGl2IGlkPSJtYWluLWNvbnRlbnQiPg0KCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQoJCTxkaXYgaWQ9ImNvbnRlbnQtYXJlYSIgY2xhc3M9ImNsZWFyZml4Ij4NCgkJCTxkaXYgaWQ9ImxlZnQtYXJlYSI+DQoJCQkJPGFydGljbGUgaWQ9InBvc3QtMCIgY2xhc3M9ImV0X3BiX3Bvc3Qgbm90X2ZvdW5kIj4NCgkJCQkJPGRpdiBjbGFzcz0iZW50cnkiPg0KPCEtLUlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+DQoJPGgxPuacquaJvuWIsOe7k+aenDwvaDE+DQoJPHA+5oKo6K+35rGC55qE6aG16Z2i5peg5rOV5om+5Yiw44CC5bCd6K+V57K+56Gu5oKo55qE5pCc57Si77yM5oiW6ICF5L2/55So5LiK6Z2i55qE5a+86Iiq5a6a5L2N5paH56ug44CCPC9wPg0KPC9kaXY+DQo8IS0tRW5kIGlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+CQkJCTwvYXJ0aWNsZT4gPCEtLSAuZXRfcGJfcG9zdCAtLT4NCgkJCTwvZGl2PiA8IS0tICNsZWZ0LWFyZWEgLS0+DQoNCgkJCQk8ZGl2IGlkPSJzaWRlYmFyIj4NCgkJPGRpdiBpZD0iYWJvdXRtZXdpZGdldC01IiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF9hYm91dG1ld2lkZ2V0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7lhbPkuo48L2g0PgkJPGRpdiBjbGFzcz0iY2xlYXJmaXgiPg0KCQkJPGltZyBzcmM9IiIgaWQ9ImFib3V0LWltYWdlIiBhbHQ9IiIgLz4NCgkJCeS8veiTneS5i+WgguKAlOKAlDxiciAvPuS4gOWPqumtlOazleW4iOeahOW3peWdigkJPC9kaXY+IDwhLS0gZW5kIGFib3V0IG1lIHNlY3Rpb24gLS0+DQoJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+PGRpdiBpZD0idGV4dC0yIiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF90ZXh0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7nm7jlhbPpk77mjqU8L2g0PgkJCTxkaXYgY2xhc3M9InRleHR3aWRnZXQiPjx1bD4KPGxpPjxhIGhyZWY9Imh0dHA6Ly9naXRodWIuY29tL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5HaXRodWI8L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHA6Ly93ZWliby5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+V2VpYm88L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+VHdpdHRlcjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5MaW5rZWRJbjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cDovL2liaXJlbWUuZGV2aWFudGFydC5jb20vIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5EZXZpYW50QVJUPC9hPjwvbGk+CjwvdWw+CjwvZGl2PgoJCTwvZGl2PiA8IS0tIGVuZCAuZXRfcGJfd2lkZ2V0IC0tPjxkaXYgaWQ9Im1ldGEtMiIgY2xhc3M9ImV0X3BiX3dpZGdldCB3aWRnZXRfbWV0YSI+PGg0IGNsYXNzPSJ3aWRnZXR0aXRsZSI+5Yqf6IO9PC9oND4JCQk8dWw+CgkJCQkJCTxsaT48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtbG9naW4ucGhwIj7nmbvlvZU8L2E+PC9saT4KCQkJPGxpPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9mZWVkLyI+5p2h55uuZmVlZDwvYT48L2xpPgoJCQk8bGk+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NvbW1lbnRzL2ZlZWQvIj7or4TorrpmZWVkPC9hPjwvbGk+CgkJCTxsaT48YSBocmVmPSJodHRwczovL2NuLndvcmRwcmVzcy5vcmcvIj5Xb3JkUHJlc3Mub3JnPC9hPjwvbGk+CQkJPC91bD4KCQkJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+CTwvZGl2PiA8IS0tIGVuZCAjc2lkZWJhciAtLT4NCgkJPC9kaXY+IDwhLS0gI2NvbnRlbnQtYXJlYSAtLT4NCgk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KPC9kaXY+IDwhLS0gI21haW4tY29udGVudCAtLT4NCg0KCgkJCTxmb290ZXIgaWQ9Im1haW4tZm9vdGVyIj4KCQkJCQoKCQkKCQkJCTxkaXYgaWQ9ImZvb3Rlci1ib3R0b20iPgoJCQkJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciBjbGVhcmZpeCI+CgkJCQkKCQkJCQkJPHAgaWQ9ImNvcHlyaWdodCI+CgkJCQkJCQlDb3B5cmlnaHQgMjAyMSBpYmlyZW1lCgkJCQkJCTwvcD4KCQkJCQk8L2Rpdj4JPCEtLSAuY29udGFpbmVyIC0tPgoJCQkJPC9kaXY+CgkJCTwvZm9vdGVyPiA8IS0tICNtYWluLWZvb3RlciAtLT4KCQk8L2Rpdj4gPCEtLSAjZXQtbWFpbi1hcmVhIC0tPgoKCgk8L2Rpdj4gPCEtLSAjcGFnZS1jb250YWluZXIgLS0+CgoJPCEtLSBCYWlkdSBBbmFseXRpY3MgLS0+DQo8c2NyaXB0Pg0KdmFyIF9obXQgPSBfaG10IHx8IFtdOw0KKGZ1bmN0aW9uKCkgew0KICB2YXIgaG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgaG0uc3JjID0gImh0dHBzOi8vaG0uYmFpZHUuY29tL2htLmpzPzZmMzAwN2QzZmUxNTI0NDk4MGVmZjU4OWY5ZDc4MDYzIjsNCiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07IA0KICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGhtLCBzKTsNCn0pKCk7DQo8L3NjcmlwdD4NCg0KPCEtLSBHb29nbGUgQW5hbHl0aWNzIC0tPg0KPHNjcmlwdCBhc3luYyBzcmM9Imh0dHBzOi8vd3d3Lmdvb2dsZXRhZ21hbmFnZXIuY29tL2d0YWcvanM/aWQ9VUEtNDMwMTc2NDctMSI+PC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICB3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsNCiAgZnVuY3Rpb24gZ3RhZygpe2RhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7fQ0KICBndGFnKCdqcycsIG5ldyBEYXRlKCkpOw0KICBndGFnKCdjb25maWcnLCAnVUEtNDMwMTc2NDctMScpOw0KPC9zY3JpcHQ+CjwhLS0gV1AgQXVkaW8gcGxheWVyIHBsdWdpbiB2MS45LjYgLSBodHRwczovL3d3dy50aXBzYW5kdHJpY2tzLWhxLmNvbS93b3JkcHJlc3MtYXVkaW8tbXVzaWMtcGxheWVyLXBsdWdpbi00NTU2LyAtLT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICAgICAgc291bmRNYW5hZ2VyLnVzZUZsYXNoQmxvY2sgPSB0cnVlOyAvLyBvcHRpb25hbCAtIGlmIHVzZWQsIHJlcXVpcmVkIGZsYXNoYmxvY2suY3NzDQogICAgICAgIHNvdW5kTWFuYWdlci51cmwgPSAnaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9zd2Yvc291bmRtYW5hZ2VyMi5zd2YnOw0KICAgICAgICBmdW5jdGlvbiBwbGF5X21wMyhmbGcsIGlkcywgbXAzdXJsLCB2b2x1bWUsIGxvb3BzKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL0NoZWNrIHRoZSBmaWxlIFVSTCBwYXJhbWV0ZXIgdmFsdWUNCiAgICAgICAgICAgIHZhciBwaWVjZXMgPSBtcDN1cmwuc3BsaXQoInwiKTsNCiAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMSkgey8vV2UgaGF2ZSBnb3QgYW4gLm9nZyBmaWxlIHRvbw0KICAgICAgICAgICAgICAgIG1wM2ZpbGUgPSBwaWVjZXNbMF07DQogICAgICAgICAgICAgICAgb2dnZmlsZSA9IHBpZWNlc1sxXTsNCiAgICAgICAgICAgICAgICAvL3NldCB0aGUgZmlsZSBVUkwgdG8gYmUgYW4gYXJyYXkgd2l0aCB0aGUgbXAzIGFuZCBvZ2cgZmlsZQ0KICAgICAgICAgICAgICAgIG1wM3VybCA9IG5ldyBBcnJheShtcDNmaWxlLCBvZ2dmaWxlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLmNyZWF0ZVNvdW5kKHsNCiAgICAgICAgICAgICAgICBpZDogJ2J0bnBsYXlfJyArIGlkcywNCiAgICAgICAgICAgICAgICB2b2x1bWU6IHZvbHVtZSwNCiAgICAgICAgICAgICAgICB1cmw6IG1wM3VybA0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGlmIChmbGcgPT0gJ3BsYXknKSB7DQogICAgICAgICAgICAgICAgICAgIHNvdW5kTWFuYWdlci5wbGF5KCdidG5wbGF5XycgKyBpZHMsIHsNCiAgICAgICAgICAgICAgICAgICAgb25maW5pc2g6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvb3BzID09ICd0cnVlJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZCgnYnRucGxheV8nICsgaWRzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuc3RvcF8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChmbGcgPT0gJ3N0b3AnKSB7DQogICAgLy9zb3VuZE1hbmFnZXIuc3RvcCgnYnRucGxheV8nK2lkcyk7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBhdXNlKCdidG5wbGF5XycgKyBpZHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIHNob3dfaGlkZShmbGFnLCBpZHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChmbGFnID09ICdwbGF5Jykgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoZmxhZyA9PSAnc3RvcCcpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRucGxheV8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmdW5jdGlvbiBsb29wU291bmQoc291bmRJRCkNCiAgICAgICAgew0KICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBsYXkoc291bmRJRCwge29uZmluaXNoOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZChzb3VuZElEKTsNCiAgICAgICAgICAgICAgICAgICAgfX0pOw0KICAgICAgICAgICAgfSwgMSk7DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gc3RvcF9hbGxfdHJhY2tzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLnN0b3BBbGwoKTsNCiAgICAgICAgICAgIHZhciBpbnB1dHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5wbGF5XyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsvL1RvZ2dsZSB0aGUgcGxheSBidXR0b24NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5zdG9wXyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Ly9IaWRlIHRoZSBzdG9wIGJ1dHRvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9mcm9udGVuZC1idWlsZGVyLWdsb2JhbC1mdW5jdGlvbnMuanM/dmVyPTIuNS4zJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvY3VzdG9tLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9qcXVlcnkuZml0dmlkcy5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvd2F5cG9pbnRzLm1pbi5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvanF1ZXJ5Lm1hZ25pZmljLXBvcHVwLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBldF9jdXN0b20gPSB7ImFqYXh1cmwiOiJodHRwczpcL1wvYmxvZy5pYmlyZW1lLmNvbVwvd3AtYWRtaW5cL2FkbWluLWFqYXgucGhwIiwiaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2ltYWdlcyIsImJ1aWxkZXJfaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2luY2x1ZGVzXC9idWlsZGVyXC9pbWFnZXMiLCJldF9sb2FkX25vbmNlIjoiZGM4NmFmOTNlMiIsInN1YnNjcmlwdGlvbl9mYWlsZWQiOiJQbGVhc2UsIGNoZWNrIHRoZSBmaWVsZHMgYmVsb3cgdG8gbWFrZSBzdXJlIHlvdSBlbnRlcmVkIHRoZSBjb3JyZWN0IGluZm9ybWF0aW9uLiIsImZpbGwiOiJGaWxsIiwiZmllbGQiOiJmaWVsZCIsImludmFsaWQiOiJJbnZhbGlkIGVtYWlsIiwiY2FwdGNoYSI6IkNhcHRjaGEiLCJwcmV2IjoiUHJldiIsInByZXZpb3VzIjoiXHU0ZTBhXHU0ZTAwXHU5ODc1IiwibmV4dCI6Ilx1NGUwYlx1NGUwMFx1OTg3NSIsImlzX2J1aWxkZXJfcGx1Z2luX3VzZWQiOiIifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvZnJvbnRlbmQtYnVpbGRlci1zY3JpcHRzLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy93cC1lbWJlZC5taW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==" srcset="/img/loading.gif" lazyload></p>
<p>其内部代码整理如下 （太长了不想看可以直接跳过去，后面会有说明）：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">/// 用DefaultMode启动</span><br>void <span class="hljs-constructor">CFRunLoopRun(<span class="hljs-params">void</span>)</span> &#123;<br>    <span class="hljs-constructor">CFRunLoopRunSpecific(CFRunLoopGetCurrent()</span>, kCFRunLoopDefaultMode, <span class="hljs-number">1.0e10</span>, <span class="hljs-literal">false</span>);<br>&#125;<br> <br><span class="hljs-comment">/// 用指定的Mode启动，允许设置RunLoop超时时间</span><br><span class="hljs-built_in">int</span> <span class="hljs-constructor">CFRunLoopRunInMode(CFStringRef <span class="hljs-params">modeName</span>, CFTimeInterval <span class="hljs-params">seconds</span>, Boolean <span class="hljs-params">stopAfterHandle</span>)</span> &#123;<br>    return <span class="hljs-constructor">CFRunLoopRunSpecific(CFRunLoopGetCurrent()</span>, modeName, seconds, returnAfterSourceHandled);<br>&#125;<br> <br><span class="hljs-comment">/// RunLoop的实现</span><br><span class="hljs-built_in">int</span> <span class="hljs-constructor">CFRunLoopRunSpecific(<span class="hljs-params">runloop</span>, <span class="hljs-params">modeName</span>, <span class="hljs-params">seconds</span>, <span class="hljs-params">stopAfterHandle</span>)</span> &#123;<br>    <br>    <span class="hljs-comment">/// 首先根据modeName找到对应mode</span><br>    CFRunLoopModeRef currentMode = <span class="hljs-constructor">__CFRunLoopFindMode(<span class="hljs-params">runloop</span>, <span class="hljs-params">modeName</span>, <span class="hljs-params">false</span>)</span>;<br>    <span class="hljs-comment">/// 如果mode里没有source/timer/observer, 直接返回。</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-constructor">__CFRunLoopModeIsEmpty(<span class="hljs-params">currentMode</span>)</span>) return;<br>    <br>    <span class="hljs-comment">/// 1. 通知 Observers: RunLoop 即将进入 loop。</span><br>    <span class="hljs-constructor">__CFRunLoopDoObservers(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">kCFRunLoopEntry</span>)</span>;<br>    <br>    <span class="hljs-comment">/// 内部函数，进入loop</span><br>    <span class="hljs-constructor">__CFRunLoopRun(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">seconds</span>, <span class="hljs-params">returnAfterSourceHandled</span>)</span> &#123;<br>        <br>        Boolean sourceHandledThisLoop = NO;<br>        <span class="hljs-built_in">int</span> retVal = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br> <br>            <span class="hljs-comment">/// 2. 通知 Observers: RunLoop 即将触发 Timer 回调。</span><br>            <span class="hljs-constructor">__CFRunLoopDoObservers(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">kCFRunLoopBeforeTimers</span>)</span>;<br>            <span class="hljs-comment">/// 3. 通知 Observers: RunLoop 即将触发 Source0 (非port) 回调。</span><br>            <span class="hljs-constructor">__CFRunLoopDoObservers(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">kCFRunLoopBeforeSources</span>)</span>;<br>            <span class="hljs-comment">/// 执行被加入的block</span><br>            <span class="hljs-constructor">__CFRunLoopDoBlocks(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>)</span>;<br>            <br>            <span class="hljs-comment">/// 4. RunLoop 触发 Source0 (非port) 回调。</span><br>            sourceHandledThisLoop = <span class="hljs-constructor">__CFRunLoopDoSources0(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">stopAfterHandle</span>)</span>;<br>            <span class="hljs-comment">/// 执行被加入的block</span><br>            <span class="hljs-constructor">__CFRunLoopDoBlocks(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>)</span>;<br> <br>            <span class="hljs-comment">/// 5. 如果有 Source1 (基于port) 处于 ready 状态，直接处理这个 Source1 然后跳转去处理消息。</span><br>            <span class="hljs-keyword">if</span> (__Source0DidDispatchPortLastTime) &#123;<br>                Boolean hasMsg = <span class="hljs-constructor">__CFRunLoopServiceMachPort(<span class="hljs-params">dispatchPort</span>, &amp;<span class="hljs-params">msg</span>)</span><br>                <span class="hljs-keyword">if</span> (hasMsg) goto handle_msg;<br>            &#125;<br>            <br>            <span class="hljs-comment">/// 通知 Observers: RunLoop 的线程即将进入休眠(sleep)。</span><br>            <span class="hljs-keyword">if</span> (!sourceHandledThisLoop) &#123;<br>                <span class="hljs-constructor">__CFRunLoopDoObservers(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">kCFRunLoopBeforeWaiting</span>)</span>;<br>            &#125;<br>            <br>            <span class="hljs-comment">/// 7. 调用 mach_msg 等待接受 mach_port 的消息。线程将进入休眠, 直到被下面某一个事件唤醒。</span><br>            <span class="hljs-comment">/// • 一个基于 port 的Source 的事件。</span><br>            <span class="hljs-comment">/// • 一个 Timer 到时间了</span><br>            <span class="hljs-comment">/// • RunLoop 自身的超时时间到了</span><br>            <span class="hljs-comment">/// • 被其他什么调用者手动唤醒</span><br>            <span class="hljs-constructor">__CFRunLoopServiceMachPort(<span class="hljs-params">waitSet</span>, &amp;<span class="hljs-params">msg</span>, <span class="hljs-params">sizeof</span>(<span class="hljs-params">msg_buffer</span>)</span>, &amp;livePort) &#123;<br>                mach<span class="hljs-constructor">_msg(<span class="hljs-params">msg</span>, MACH_RCV_MSG, <span class="hljs-params">port</span>)</span>; <span class="hljs-comment">// thread wait for receive msg</span><br>            &#125;<br> <br>            <span class="hljs-comment">/// 8. 通知 Observers: RunLoop 的线程刚刚被唤醒了。</span><br>            <span class="hljs-constructor">__CFRunLoopDoObservers(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">kCFRunLoopAfterWaiting</span>)</span>;<br>            <br>            <span class="hljs-comment">/// 收到消息，处理消息。</span><br>            handle_msg:<br> <br>            <span class="hljs-comment">/// 9.1 如果一个 Timer 到时间了，触发这个Timer的回调。</span><br>            <span class="hljs-keyword">if</span> (msg_is_timer) &#123;<br>                <span class="hljs-constructor">__CFRunLoopDoTimers(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">mach_absolute_time</span>()</span>)<br>            &#125; <br> <br>            <span class="hljs-comment">/// 9.2 如果有dispatch到main_queue的block，执行block。</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (msg_is_dispatch) &#123;<br>                <span class="hljs-constructor">__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(<span class="hljs-params">msg</span>)</span>;<br>            &#125; <br> <br>            <span class="hljs-comment">/// 9.3 如果一个 Source1 (基于port) 发出事件了，处理这个事件</span><br>            <span class="hljs-keyword">else</span> &#123;<br>                CFRunLoopSourceRef source1 = <span class="hljs-constructor">__CFRunLoopModeFindSourceForMachPort(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">livePort</span>)</span>;<br>                sourceHandledThisLoop = <span class="hljs-constructor">__CFRunLoopDoSource1(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">source1</span>, <span class="hljs-params">msg</span>)</span>;<br>                <span class="hljs-keyword">if</span> (sourceHandledThisLoop) &#123;<br>                    mach<span class="hljs-constructor">_msg(<span class="hljs-params">reply</span>, MACH_SEND_MSG, <span class="hljs-params">reply</span>)</span>;<br>                &#125;<br>            &#125;<br>            <br>            <span class="hljs-comment">/// 执行加入到Loop的block</span><br>            <span class="hljs-constructor">__CFRunLoopDoBlocks(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>)</span>;<br>            <br> <br>            <span class="hljs-keyword">if</span> (sourceHandledThisLoop<span class="hljs-operator"> &amp;&amp; </span>stopAfterHandle) &#123;<br>                <span class="hljs-comment">/// 进入loop时参数说处理完事件就返回。</span><br>                retVal = kCFRunLoopRunHandledSource;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (timeout) &#123;<br>                <span class="hljs-comment">/// 超出传入参数标记的超时时间了</span><br>                retVal = kCFRunLoopRunTimedOut;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-constructor">__CFRunLoopIsStopped(<span class="hljs-params">runloop</span>)</span>) &#123;<br>                <span class="hljs-comment">/// 被外部调用者强制停止了</span><br>                retVal = kCFRunLoopRunStopped;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-constructor">__CFRunLoopModeIsEmpty(<span class="hljs-params">runloop</span>, <span class="hljs-params">currentMode</span>)</span>) &#123;<br>                <span class="hljs-comment">/// source/timer/observer一个都没有了</span><br>                retVal = kCFRunLoopRunFinished;<br>            &#125;<br>            <br>            <span class="hljs-comment">/// 如果没超时，mode里没空，loop也没被停止，那继续loop。</span><br>        &#125; <span class="hljs-keyword">while</span> (retVal<span class="hljs-operator"> == </span><span class="hljs-number">0</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">/// 10. 通知 Observers: RunLoop 即将退出。</span><br>    <span class="hljs-constructor">__CFRunLoopDoObservers(<span class="hljs-params">rl</span>, <span class="hljs-params">currentMode</span>, <span class="hljs-params">kCFRunLoopExit</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>可以看到，实际上 RunLoop 就是这样一个函数，其内部是一个 do-while 循环。当你调用 CFRunLoopRun() 时，线程就会一直停留在这个循环里；直到超时或被手动停止，该函数才会返回。</p>
<h2 id="RunLoop-的底层实现"><a href="#RunLoop-的底层实现" class="headerlink" title="RunLoop 的底层实现"></a>RunLoop 的底层实现</h2><p>从上面代码可以看到，RunLoop 的核心是基于 mach port 的，其进入休眠时调用的函数是 mach_msg()。为了解释这个逻辑，下面稍微介绍一下 OSX/iOS 的系统架构。<br>[<img src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+DQo8IS0tW2lmIElFIDZdPg0KPGh0bWwgaWQ9ImllNiIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDddPg0KPGh0bWwgaWQ9ImllNyIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDhdPg0KPGh0bWwgaWQ9ImllOCIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmICEoSUUgNikgfCAhKElFIDcpIHwgIShJRSA4KSAgXT48IS0tPg0KPGh0bWwgbGFuZz0iemgtQ04iPg0KPCEtLTwhW2VuZGlmXS0tPg0KPGhlYWQ+DQoJPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+DQoJPHRpdGxlPjQwNCDmnKrmib7liLAgfCBHYXJhbiBubyBkb3U8L3RpdGxlPg0KCQkJDQoJDQoJPGxpbmsgcmVsPSJwaW5nYmFjayIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3htbHJwYy5waHAiIC8+DQoNCgkJPCEtLVtpZiBsdCBJRSA5XT4NCgk8c2NyaXB0IHNyYz0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvaHRtbDUuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQoJPCFbZW5kaWZdLS0+DQoNCgk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUgPSAnanMnOw0KCTwvc2NyaXB0Pg0KDQoJPGxpbmsgcmVsPSdkbnMtcHJlZmV0Y2gnIGhyZWY9Jy8vZm9udHMuZ29vZ2xlYXBpcy5jb20nIC8+CjxsaW5rIHJlbD0nZG5zLXByZWZldGNoJyBocmVmPScvL3Mudy5vcmcnIC8+CjxsaW5rIHJlbD0iYWx0ZXJuYXRlIiB0eXBlPSJhcHBsaWNhdGlvbi9yc3MreG1sIiB0aXRsZT0iR2FyYW4gbm8gZG91ICZyYXF1bzsgRmVlZCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2ZlZWQvIiAvPgo8bGluayByZWw9ImFsdGVybmF0ZSIgdHlwZT0iYXBwbGljYXRpb24vcnNzK3htbCIgdGl0bGU9IkdhcmFuIG5vIGRvdSAmcmFxdW87IOivhOiuukZlZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jb21tZW50cy9mZWVkLyIgLz4KPG1ldGEgY29udGVudD0iRGl2aSB2LjIuNS4zIiBuYW1lPSJnZW5lcmF0b3IiLz48bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdzY2FwLmZsYXNoYmxvY2stY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvZmxhc2hibG9jay5jc3M/dmVyPTUuNC42JyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nc2NhcC5wbGF5ZXItY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvcGxheWVyLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdjcmF5b24tY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jcmF5b24tc3ludGF4LWhpZ2hsaWdodGVyL2Nzcy9taW4vY3JheW9uLm1pbi5jc3M/dmVyPV8yLjcuMl9iZXRhJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nd3AtZWFzeWFyY2hpdmVzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3BsdWdpbnMvd3AtZWFzeWFyY2hpdmVzL2Nzcy93cC1lYXN5YXJjaGl2ZXMuY3NzP3Zlcj0zLjEuMicgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdzY3JlZW4nIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J3dwLWJsb2NrLWxpYnJhcnktY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2Nzcy9kaXN0L2Jsb2NrLWxpYnJhcnkvc3R5bGUubWluLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdtYXRoLWNhcHRjaGEtZnJvbnRlbmQtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy93cC1tYXRoLWNhcHRjaGEvY3NzL2Zyb250ZW5kLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSd3cC1wYWdlbmF2aS1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3dwLXBhZ2VuYXZpL3BhZ2VuYXZpLWNzcy5jc3M/dmVyPTIuNzAnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdkaXZpLWZvbnRzLWNzcycgIGhyZWY9J2h0dHBzOi8vZm9udHMubG9saS5uZXQvY3NzP2ZhbWlseT1PcGVuK1NhbnM6MzAwaXRhbGljLDQwMGl0YWxpYyw2MDBpdGFsaWMsNzAwaXRhbGljLDgwMGl0YWxpYyw0MDAsMzAwLDYwMCw3MDAsODAwJiMwMzg7c3Vic2V0PWxhdGluLGxhdGluLWV4dCcgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LWdmLWNoaW5lc2UtY3NzJyAgaHJlZj0nLy9mb250cy5sb2xpLm5ldC9lYXJseWFjY2Vzcy9jd3RleGZhbmdzb25nLmNzcycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2Rpdmktc3R5bGUtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0Rpdmkvc3R5bGUuY3NzP3Zlcj0yLjUuMycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LXNob3J0Y29kZXMtY3NzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2VwYW5lbC9zaG9ydGNvZGVzL2Nzcy9zaG9ydGNvZGVzLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nZXQtc2hvcnRjb2Rlcy1yZXNwb25zaXZlLWNzcy1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9lcGFuZWwvc2hvcnRjb2Rlcy9jc3Mvc2hvcnRjb2Rlc19yZXNwb25zaXZlLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9qcy9zb3VuZG1hbmFnZXIyLW5vZGVidWctanNtaW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2pzL2pxdWVyeS9qcXVlcnkuanM/dmVyPTEuMTIuNC13cCc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy9qcXVlcnkvanF1ZXJ5LW1pZ3JhdGUubWluLmpzP3Zlcj0xLjQuMSc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBDcmF5b25TeW50YXhTZXR0aW5ncyA9IHsidmVyc2lvbiI6Il8yLjcuMl9iZXRhIiwiaXNfYWRtaW4iOiIwIiwiYWpheHVybCI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1hZG1pblwvYWRtaW4tYWpheC5waHAiLCJwcmVmaXgiOiJjcmF5b24tIiwic2V0dGluZyI6ImNyYXlvbi1zZXR0aW5nIiwic2VsZWN0ZWQiOiJjcmF5b24tc2V0dGluZy1zZWxlY3RlZCIsImNoYW5nZWQiOiJjcmF5b24tc2V0dGluZy1jaGFuZ2VkIiwic3BlY2lhbCI6ImNyYXlvbi1zZXR0aW5nLXNwZWNpYWwiLCJvcmlnX3ZhbHVlIjoiZGF0YS1vcmlnLXZhbHVlIiwiZGVidWciOiIifTsKdmFyIENyYXlvblN5bnRheFN0cmluZ3MgPSB7ImNvcHkiOiJQcmVzcyAlcyB0byBDb3B5LCAlcyB0byBQYXN0ZSIsIm1pbmltaXplIjoiQ2xpY2sgVG8gRXhwYW5kIENvZGUifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL2NyYXlvbi1zeW50YXgtaGlnaGxpZ2h0ZXIvanMvbWluL2NyYXlvbi5taW4uanM/dmVyPV8yLjcuMl9iZXRhJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9zaW1wbGVzbWlsZXlzaG93L2pxdWVyeS5pbnNlcnRhdGNhcmV0LmpzJz48L3NjcmlwdD4KPGxpbmsgcmVsPSdodHRwczovL2FwaS53Lm9yZy8nIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1qc29uLycgLz4KPGxpbmsgcmVsPSJFZGl0VVJJIiB0eXBlPSJhcHBsaWNhdGlvbi9yc2QreG1sIiB0aXRsZT0iUlNEIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20veG1scnBjLnBocD9yc2QiIC8+CjxsaW5rIHJlbD0id2x3bWFuaWZlc3QiIHR5cGU9ImFwcGxpY2F0aW9uL3dsd21hbmlmZXN0K3htbCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL3dsd21hbmlmZXN0LnhtbCIgLz4gCjxtZXRhIG5hbWU9ImdlbmVyYXRvciIgY29udGVudD0iV29yZFByZXNzIDUuNC42IiAvPgoKPCEtLSBHZW5lcmF0ZWQgQnkgU2hvdy1Vc2VyQWdlbnQgMS4wLjggLSBodHRwOi8vemx6LmltL3Nob3ctdXNlcmFnZW50LyAtLT4KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3Nob3ctdXNlcmFnZW50L3Nob3ctdXNlcmFnZW50LmNzcyIgdHlwZT0idGV4dC9jc3MiIG1lZGlhPSJzY3JlZW4iIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT0wIiAvPgkJPHN0eWxlIGlkPSJ0aGVtZS1jdXN0b21pemVyLWNzcyI+DQoJCQkJCQkJCQkJCQkJLndvb2NvbW1lcmNlICNyZXNwb25kIGlucHV0I3N1Ym1pdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LCAud29vY29tbWVyY2UgI2NvbnRlbnQgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSAjY29udGVudCBpbnB1dC5idXR0b24sIC53b29jb21tZXJjZS1tZXNzYWdlLCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1pbmZvIHsgYmFja2dyb3VuZDogI2E5ZDMwMCAhaW1wb3J0YW50OyB9DQoJCQkjZXRfc2VhcmNoX2ljb246aG92ZXIsIC5tb2JpbGVfbWVudV9iYXI6YmVmb3JlLCAuZXQtc29jaWFsLWljb24gYTpob3ZlciwgLmV0X3BiX3N1bSwgLmV0X3BiX3ByaWNpbmcgbGkgYSwgLmV0X3BiX3ByaWNpbmdfdGFibGVfYnV0dG9uLCAuZXRfb3ZlcmxheTpiZWZvcmUsIC5lbnRyeS1zdW1tYXJ5IHAucHJpY2UgaW5zLCAud29vY29tbWVyY2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UtcGFnZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLmV0X3BiX21lbWJlcl9zb2NpYWxfbGlua3MgYTpob3ZlciwgLndvb2NvbW1lcmNlIC5zdGFyLXJhdGluZyBzcGFuOmJlZm9yZSwgLndvb2NvbW1lcmNlLXBhZ2UgLnN0YXItcmF0aW5nIHNwYW46YmVmb3JlLCAuZXRfcGJfd2lkZ2V0IGxpIGE6aG92ZXIsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydGZvbGlvX2ZpbHRlcnMgbGkgYS5hY3RpdmUsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydG9mb2xpb19wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAuZXRfcGJfZ2FsbGVyeSAuZXRfcGJfZ2FsbGVyeV9wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAud3AtcGFnZW5hdmkgc3Bhbi5jdXJyZW50LCAud3AtcGFnZW5hdmkgYTpob3ZlciwgLm5hdi1zaW5nbGUgYSwgLnBvc3RlZF9pbiBhIHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCS5ldF9wYl9jb250YWN0X3N1Ym1pdCwgLmV0X3Bhc3N3b3JkX3Byb3RlY3RlZF9mb3JtIC5ldF9zdWJtaXRfYnV0dG9uLCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9uZXdzbGV0dGVyX2J1dHRvbiwgLmNvbW1lbnQtcmVwbHktbGluaywgLmZvcm0tc3VibWl0IGlucHV0LCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9wcm9tb19idXR0b24sIC5ldF9wYl9iZ19sYXlvdXRfbGlnaHQgLmV0X3BiX21vcmVfYnV0dG9uLCAud29vY29tbWVyY2UgYS5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBhLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgYnV0dG9uLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBhLmJ1dHRvbiwgLndvb2NvbW1lcmNlLXBhZ2UgYS5idXR0b24sIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24geyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmZvb3Rlci13aWRnZXQgaDQgeyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmV0LXNlYXJjaC1mb3JtLCAubmF2IGxpIHVsLCAuZXRfbW9iaWxlX21lbnUsIC5mb290ZXItd2lkZ2V0IGxpOmJlZm9yZSwgLmV0X3BiX3ByaWNpbmcgbGk6YmVmb3JlLCBibG9ja3F1b3RlIHsgYm9yZGVyLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkuZXRfcGJfY291bnRlcl9hbW91bnQsIC5ldF9wYl9mZWF0dXJlZF90YWJsZSAuZXRfcGJfcHJpY2luZ19oZWFkaW5nLCAuZXRfcXVvdGVfY29udGVudCwgLmV0X2xpbmtfY29udGVudCwgLmV0X2F1ZGlvX2NvbnRlbnQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkJCQkJLmNvbnRhaW5lciwgLmV0X3BiX3JvdywgLmV0X3BiX3NsaWRlciAuZXRfcGJfY29udGFpbmVyLCAuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24gLmV0X3BiX3RpdGxlX2NvbnRhaW5lciwgLmV0X3BiX2Z1bGx3aWR0aF9zZWN0aW9uIC5ldF9wYl90aXRsZV9mZWF0dXJlZF9jb250YWluZXIsIC5ldF9wYl9mdWxsd2lkdGhfaGVhZGVyOm5vdCguZXRfcGJfZnVsbHNjcmVlbikgLmV0X3BiX2Z1bGx3aWR0aF9oZWFkZXJfY29udGFpbmVyIHsgbWF4LXdpZHRoOiA5NjBweDsgfQ0KCQkJLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIsIC5ldF9maXhlZF9uYXYuZXRfYm94ZWRfbGF5b3V0ICNwYWdlLWNvbnRhaW5lciAjdG9wLWhlYWRlciwgLmV0X2ZpeGVkX25hdi5ldF9ib3hlZF9sYXlvdXQgI3BhZ2UtY29udGFpbmVyICNtYWluLWhlYWRlciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmNvbnRhaW5lciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmV0X3BiX3JvdyB7IG1heC13aWR0aDogMTEyMHB4OyB9DQoJCQkJCQkJYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI3RvcC1oZWFkZXIsICNldC1zZWNvbmRhcnktbmF2IGxpIHVsIHsgYmFja2dyb3VuZC1jb2xvcjogI2E5ZDMwMDsgfQ0KCQkJCQkJCQkjdG9wLWhlYWRlciwgI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQkJCQkJCQkJCQ0KCQkNCgkJCQkJI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX3JlZCAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9yZWQgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfcGluayAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9waW5rICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX29yYW5nZSAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9vcmFuZ2UgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsIC5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI21haW4tZm9vdGVyIC5mb290ZXItd2lkZ2V0IGg0IHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkuZm9vdGVyLXdpZGdldCBsaTpiZWZvcmUgeyBib3JkZXItY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkNCgkJDQoJCQ0KCQlAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWluLXdpZHRoOiA5ODFweCApIHsNCgkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIsIC5ldC1maXhlZC1oZWFkZXIjdG9wLWhlYWRlciAjZXQtc2Vjb25kYXJ5LW5hdiBsaSB1bCB7IGJhY2tncm91bmQtY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtYW5jZXN0b3IgPiBhLA0KCQkJCS5ldC1maXhlZC1oZWFkZXIgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjICFpbXBvcnRhbnQ7IH0NCgkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQ0KCQkJCQl9DQoJCUBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKCBtaW4td2lkdGg6IDEyMDBweCkgew0KCQkJLmV0X3BiX3JvdyB7IHBhZGRpbmc6IDI0cHggMDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24geyBwYWRkaW5nOiA0OHB4IDA7IH0NCgkJCS5zaW5nbGUuZXRfcGJfcGFnZWJ1aWxkZXJfbGF5b3V0LmV0X2Z1bGxfd2lkdGhfcGFnZSAuZXRfcG9zdF9tZXRhX3dyYXBwZXIgeyBwYWRkaW5nLXRvcDogNzJweDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24uZXRfcGJfc2VjdGlvbl9maXJzdCB7IHBhZGRpbmctdG9wOiBpbmhlcml0OyB9DQoJCQkuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24geyBwYWRkaW5nOiAwOyB9DQoJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogOTgwcHggKSB7DQoJCQkJCQkJCQkJCQkJCQkJCQkJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogNzY3cHggKSB7DQoJCQkJCQkJCQkJCQkJCX0NCgk8L3N0eWxlPg0KDQoJPHN0eWxlIGNsYXNzPSJldF9vbmVfZm9udF9sYW5ndWFnZXMiPmgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGJvZHksIGlucHV0LCB0ZXh0YXJlYSwgc2VsZWN0IHsgZm9udC1mYW1pbHk6ICdjd1RlWEZhbmdTb25nJywgc2VyaWY7IH08L3N0eWxlPg0KCQ0KCTxzdHlsZSBpZD0ibW9kdWxlLWN1c3RvbWl6ZXItY3NzIj4NCgkJCTwvc3R5bGU+DQoNCgk8IS0tIEFsbCBpbiBvbmUgRmF2aWNvbiA0LjcgLS0+PGxpbmsgcmVsPSJpY29uIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTMvMDgvZmF2aWNvbi5wbmciIHR5cGU9ImltYWdlL3BuZyIvPgo8bGluayByZWw9ImFwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxMy8wOC9mYXZpY29uMi5wbmciIC8+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyIgaWQ9ImV0LWN1c3RvbS1jc3MiPgpoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBib2R5LCBpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCB7DQpmb250LWZhbWlseTogJ1BpbmdGYW5nIFNDJywgJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgVmVyZGFuYSwgJ0hpcmFnaW5vIFNhbnMgR0InLCAnTm90byBTYW5zIENKSyBTQycsICdTb3VyY2UgSGFuIFNhbnMgQ04nLCBTVEhlaXRpLCAnTWljcm9zb2Z0IFlhSGVpJywgJ1dlblF1YW5ZaSBNaWNybyBIZWknLCBTaW1TdW4sIHNhbnMtc2VyaWY7DQpmb250LXdlaWdodDogNDAwOw0KfQ0KDQojbWFpbi1oZWFkZXIgew0KICAgIGJhY2tncm91bmQ6IGhzbGEoMCwgMCUsIDEwMCUsIC44NSk7DQogICAgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTJweCk7DQogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEycHgpOw0KfQ0KDQpib2R5IHsgDQoJZm9udC1zaXplOiAxNnB4Ow0KCWNvbG9yOiAjMWQxZDFkOw0KCXdvcmQtd3JhcDpicmVhay13b3JkOw0KCXdvcmQtYnJlYWs6IG5vcm1hbDsNCn0NCg0KcCB7DQoJbWFyZ2luOiAwLjllbSAwIDAuNWVtOw0KCXBhZGRpbmctYm90dG9tOiAwLjZlbTsNCglmb250LXNpemU6IDEwMCU7DQoJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOw0KfQ0KDQouZXRfcGJfcG9zdCBoMiB7DQoJZm9udC13ZWlnaHQ6IGJvbGQ7DQp9DQoNCi5ldF9wYl9wb3N0IC5wb3N0LW1ldGEgew0KCTE0cHggIkNsYXNzaWMgR3JvdGVzcXVlIFcwMSIsIEFyaWFsLCBzYW5zLXNlcmlmOw0KfQ0KDQouZXRfcGJfcG9zdCB7DQoJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlMmUyZTI7DQoJcGFkZGluZy1ib3R0b206IDIwcHg7DQp9DQoNCi5ldF9wYl9wb3N0Omxhc3Qtb2YtdHlwZSB7DQoJYm9yZGVyLWJvdHRvbTogMHB4IHNvbGlkICNlMmUyZTI7DQp9DQoNCiNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB7DQoJcGFkZGluZy10b3A6IDMwcHg7DQp9DQoNCi5ldF9yaWdodF9zaWRlYmFyICNzaWRlYmFyIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmhvbWUgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMHB4Ow0KfQ0KDQouc2luZ2xlLXBvc3QgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmV0X3BiX3Bvc3Qgew0KICBtYXJnaW4tYm90dG9tOiA0MHB4Ow0KfQ0KDQouZXRfcGJfcG9zdCAuZW50cnktY29udGVudCwgDQoucHJvamVjdCAuZW50cnktY29udGVudCB7DQogIHBhZGRpbmctdG9wOiAxMHB4Ow0KfQ0KDQoud2lkZ2V0X2Fib3V0bWV3aWRnZXQgLmNsZWFyZml4LA0KLmV0X3BiX3dpZGdldCBsaSB7DQoJZm9udC1zaXplOiA5MyU7DQp9DQoNCi53aWRnZXR0aXRsZSB7DQoJZm9udC1zaXplOiAxMjAlOw0KfQ0KDQouZXRfcGJfc2Nyb2xsX3RvcCB7DQogICAgYm90dG9tOiAxNXB4Ow0KfQ0KDQojdG9wLW1lbnUgbGkgPiBhLCANCi5mdWxsd2lkdGgtbWVudSBsaSA+IGEgew0KCWZvbnQtc2l6ZTogMTRweDsNCglmb250LXdlaWdodDogNDAwOw0KfQ0KDQojZm9vdGVyLWJvdHRvbSB7DQoJcGFkZGluZzogNXB4IDAgN3B4Ow0KfQ0KDQppbWcud3Atc21pbGV5IHsNCgltYXgtaGVpZ2h0OiAxLjJlbSAhaW1wb3J0YW50Ow0KCWhlaWdodDogMS4yZW0gIWltcG9ydGFudDsNCgl3aWR0aDogMS4yZW0gIWltcG9ydGFudDsNCn0NCg0KLndwLXNtaWxleWxpbmsgew0KCW1heC13aWR0aDogMjJweCAhaW1wb3J0YW50Ow0KfQ0KDQojbGVmdC1hcmVhIGE6aG92ZXIgew0KCXRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQojY29tbWVudGZvcm0gdGV4dGFyZWEsIA0KI2NvbW1lbnRmb3JtIGlucHV0W3R5cGU9InRleHQiXSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KfQ0KDQpAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWF4LXdpZHRoOiA3NjdweCApIHsNCgkuZXRfcGJfcm93LCAuY29udGFpbmVyLCAuZXRfcGJfY29udGFpbmVyIHsgd2lkdGg6IDg1JTsgfQ0KCS5ldF9wYl9wb3N0IGgyLCAuZXRfcGJfcG9ydGZvbGlvX2l0ZW0gaDIgeyBmb250LXNpemU6IDI0cHg7IH0NCgkuY29tbWVudC1ib2R5IHsgcGFkZGluZzogMCAwIDI1cHggMTAwcHg7IH0NCn0NCg0KI2R5bmFtaWMtdG8tdG9wIHsNCglkaXNwbGF5Om5vbmU7DQoJb3ZlcmZsb3c6aGlkZGVuOw0KCXdpZHRoOmF1dG87DQoJei1pbmRleDo5MDsNCglwb3NpdGlvbjpmaXhlZDsNCgl0b3A6YXV0bzsNCglsZWZ0OmF1dG87DQoJZm9udC1mYW1pbHk6c2Fucy1zZXJpZjsNCglmb250LXNpemU6MWVtOw0KCWNvbG9yOiNmZmY7DQoJdGV4dC1kZWNvcmF0aW9uOm5vbmU7DQoJdGV4dC1zaGFkb3c6MCAxcHggMCAjMzMzOw0KCWZvbnQtd2VpZ2h0OmJvbGQ7DQoJcGFkZGluZzoxN3B4IDE2cHg7DQoJYm9yZGVyOjBweCBzb2xpZCAjMDAwOw0KCWJhY2tncm91bmQ6IzExMTsNCgktd2Via2l0LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktbW96LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktaWNhYi1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJLWtodG1sLWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktby1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJYmFja2dyb3VuZC1vcmlnaW46Ym9yZGVyOw0KCS13ZWJraXQtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1tb3otYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1pY2FiLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgkta2h0bWwtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1vLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgliYWNrZ3JvdW5kLWNsaXA6cGFkZGluZy1ib3g7DQoJLXdlYmtpdC1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktbXMtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLW1vei1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktby1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgkta2h0bWwtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLWljYWItYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLXdlYmtpdC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLW1vei1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLWljYWItYm9yZGVyLXJhZGl1czoyM3B4Ow0KCS1raHRtbC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJYm9yZGVyLXJhZGl1czoyM3B4DQp9DQojZHluYW1pYy10by10b3A6aG92ZXIgew0KCWJhY2tncm91bmQ6IzRkNGRhYzsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1ncmFkaWVudCggbGluZWFyLCAwJSAwJSwgMCUgMTAwJSwgZnJvbSggcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSApLCB0byggcmdiYSggMCwgMCwgMCwgMCApICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1raHRtbC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tb3otbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzA4ZiAtby1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tcy1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1pY2FiLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAyNTUsIDI1NSwgMjU1LCAuMiApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWN1cnNvcjpwb2ludGVyDQp9DQojZHluYW1pYy10by10b3A6YWN0aXZlIHsNCgliYWNrZ3JvdW5kOiMxMTE7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtZ3JhZGllbnQoIGxpbmVhciwgMCUgMCUsIDAlIDEwMCUsIGZyb20oIHJnYmEoIDAsIDAsIDAsIC4zICkgKSwgdG8oIHJnYmEoIDAsIDAsIDAsIDAgKSApICk7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbW96LWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLWtodG1sLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLW8tbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbXMtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtaWNhYi1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMCwgMCwgMCwgLjEgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMTExIGxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKQ0KfQ0KI2R5bmFtaWMtdG8tdG9wLCNkeW5hbWljLXRvLXRvcDphY3RpdmUsI2R5bmFtaWMtdG8tdG9wOmZvY3VzLCNkeW5hbWljLXRvLXRvcDpob3ZlciB7DQoJb3V0bGluZTpub25lDQp9DQojZHluYW1pYy10by10b3Agc3BhbiB7DQoJZGlzcGxheTpibG9jazsNCglvdmVyZmxvdzpoaWRkZW47DQoJd2lkdGg6MTRweDsNCgloZWlnaHQ6MTJweDsNCgliYWNrZ3JvdW5kOnVybCgvd3AtY29udGVudC9wbHVnaW5zL2R5bmFtaWMtdG8tdG9wL2Nzcy9pbWFnZXMvdXAucG5nICluby1yZXBlYXQgY2VudGVyIGNlbnRlcg0KfQ0KDQouZW50cnktY29udGVudCB0YWJsZSwgYm9keS5ldC1wYi1wcmV2aWV3ICNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB0YWJsZSB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0MxQzFDMTsNCiAgICBsaW5lLWhlaWdodDogMS40ZW07DQoNCiAgICBib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlOw0KfQ0KDQp0aGVhZCB7DQoJYmFja2dyb3VuZC1jb2xvcjogI0YxRjFGMTsNCn0NCg0KcCNjb3B5cmlnaHQgew0KICAgIGNvbG9yOiAjNzE3MTcxOw0KfQo8L3N0eWxlPjwvaGVhZD4NCjxib2R5IGNsYXNzPSJlcnJvcjQwNCBldF9wYl9idXR0b25faGVscGVyX2NsYXNzIGV0X2ZpeGVkX25hdiBldF9zaG93X25hdiBldF9jb3Zlcl9iYWNrZ3JvdW5kIGV0X3BiX2d1dHRlciBvc3ggZXRfcGJfZ3V0dGVyczMgZXRfcHJpbWFyeV9uYXZfZHJvcGRvd25fYW5pbWF0aW9uX2ZhZGUgZXRfc2Vjb25kYXJ5X25hdl9kcm9wZG93bl9hbmltYXRpb25fZmFkZSBldF9wYl9mb290ZXJfY29sdW1uczQgZXRfaGVhZGVyX3N0eWxlX2xlZnQgZXRfcmlnaHRfc2lkZWJhciBjaHJvbWUiPg0KCTxkaXYgaWQ9InBhZ2UtY29udGFpbmVyIj4NCg0KCQ0KCQk8aGVhZGVyIGlkPSJtYWluLWhlYWRlciIgZGF0YS1oZWlnaHQtb25sb2FkPSI2NiI+DQoJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgY2xlYXJmaXggZXRfbWVudV9jb250YWluZXIiPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImxvZ29fY29udGFpbmVyIj4NCgkJCQkJPHNwYW4gY2xhc3M9ImxvZ29faGVscGVyIj48L3NwYW4+DQoJCQkJCTxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQkJPGltZyBzcmM9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxNS8wNS9sb2dvMS5wbmciIGFsdD0iR2FyYW4gbm8gZG91IiBpZD0ibG9nbyIgZGF0YS1oZWlnaHQtcGVyY2VudGFnZT0iNTQiIC8+DQoJCQkJCTwvYT4NCgkJCQk8L2Rpdj4NCgkJCQk8ZGl2IGlkPSJldC10b3AtbmF2aWdhdGlvbiIgZGF0YS1oZWlnaHQ9IjY2IiBkYXRhLWZpeGVkLWhlaWdodD0iNDAiPg0KCQkJCQk8bmF2IGlkPSJ0b3AtbWVudS1uYXYiPg0KCQkJCQkJCQkJCQk8dWwgaWQ9InRvcC1tZW51IiBjbGFzcz0ibmF2Ij4NCgkJCQkJCQkJCQkJCQkJCTxsaSA+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tLyI+6aaW6aG1PC9hPjwvbGk+DQoJCQkJCQkJDQoJCQkJCQkJPGxpIGNsYXNzPSJwYWdlX2l0ZW0gcGFnZS1pdGVtLTM0Ij48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vYWJvdXQvIj5BYm91dDwvYT48L2xpPgo8bGkgY2xhc3M9InBhZ2VfaXRlbSBwYWdlLWl0ZW0tNDE1MDIiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9hcmNoaXZlLyI+QXJjaGl2ZTwvYT48L2xpPgoJCQkJCQkJCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2FjZy8iPkFDRzwvYT4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMSI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L290aGVyLyI+5YW25LuWPC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2NoaXJydXAvIj7lkJDmp708L2E+CjwvbGk+Cgk8bGkgY2xhc3M9ImNhdC1pdGVtIGNhdC1pdGVtLTExIj48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vY2F0ZWdvcnkvdGVjLyI+5oqA5pyvPC9hPgo8dWwgY2xhc3M9J2NoaWxkcmVuJz4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMzAiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jYXRlZ29yeS90ZWMvaW9zLXRlYy8iPmlPUzwvYT4KPC9saT4KPC91bD4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNyI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2RhaWx5LyI+5pel5bi4PC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMiI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2Rlc2lnbi8iPuiuvuiuoTwvYT4KPC9saT4KCQkJCQkJPC91bD4NCgkJCQkJCQkJCQk8L25hdj4NCg0KCQkJCQkNCgkJCQkJDQoJCQkJCTxkaXYgaWQ9ImV0X21vYmlsZV9uYXZfbWVudSI+DQoJCQk8ZGl2IGNsYXNzPSJtb2JpbGVfbmF2IGNsb3NlZCI+DQoJCQkJPHNwYW4gY2xhc3M9InNlbGVjdF9wYWdlIj7pgInmi6npobXpnaI8L3NwYW4+DQoJCQkJPHNwYW4gY2xhc3M9Im1vYmlsZV9tZW51X2JhciI+PC9zcGFuPg0KCQkJPC9kaXY+DQoJCTwvZGl2PgkJCQk8L2Rpdj4gPCEtLSAjZXQtdG9wLW5hdmlnYXRpb24gLS0+DQoJCQk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KCQkJPGRpdiBjbGFzcz0iZXRfc2VhcmNoX291dGVyIj4NCgkJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgZXRfc2VhcmNoX2Zvcm1fY29udGFpbmVyIj4NCgkJCQkJPGZvcm0gcm9sZT0ic2VhcmNoIiBtZXRob2Q9ImdldCIgY2xhc3M9ImV0LXNlYXJjaC1mb3JtIiBhY3Rpb249Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQk8aW5wdXQgdHlwZT0ic2VhcmNoIiBjbGFzcz0iZXQtc2VhcmNoLWZpZWxkIiBwbGFjZWhvbGRlcj0i5pCc57SiICZoZWxsaXA7IiB2YWx1ZT0iIiBuYW1lPSJzIiB0aXRsZT0i5pCc57Si77yaIiAvPgkJCQkJPC9mb3JtPg0KCQkJCQk8c3BhbiBjbGFzcz0iZXRfY2xvc2Vfc2VhcmNoX2ZpZWxkIj48L3NwYW4+DQoJCQkJPC9kaXY+DQoJCQk8L2Rpdj4NCgkJPC9oZWFkZXI+IDwhLS0gI21haW4taGVhZGVyIC0tPg0KDQoJCTxkaXYgaWQ9ImV0LW1haW4tYXJlYSI+DQo8ZGl2IGlkPSJtYWluLWNvbnRlbnQiPg0KCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQoJCTxkaXYgaWQ9ImNvbnRlbnQtYXJlYSIgY2xhc3M9ImNsZWFyZml4Ij4NCgkJCTxkaXYgaWQ9ImxlZnQtYXJlYSI+DQoJCQkJPGFydGljbGUgaWQ9InBvc3QtMCIgY2xhc3M9ImV0X3BiX3Bvc3Qgbm90X2ZvdW5kIj4NCgkJCQkJPGRpdiBjbGFzcz0iZW50cnkiPg0KPCEtLUlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+DQoJPGgxPuacquaJvuWIsOe7k+aenDwvaDE+DQoJPHA+5oKo6K+35rGC55qE6aG16Z2i5peg5rOV5om+5Yiw44CC5bCd6K+V57K+56Gu5oKo55qE5pCc57Si77yM5oiW6ICF5L2/55So5LiK6Z2i55qE5a+86Iiq5a6a5L2N5paH56ug44CCPC9wPg0KPC9kaXY+DQo8IS0tRW5kIGlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+CQkJCTwvYXJ0aWNsZT4gPCEtLSAuZXRfcGJfcG9zdCAtLT4NCgkJCTwvZGl2PiA8IS0tICNsZWZ0LWFyZWEgLS0+DQoNCgkJCQk8ZGl2IGlkPSJzaWRlYmFyIj4NCgkJPGRpdiBpZD0iYWJvdXRtZXdpZGdldC01IiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF9hYm91dG1ld2lkZ2V0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7lhbPkuo48L2g0PgkJPGRpdiBjbGFzcz0iY2xlYXJmaXgiPg0KCQkJPGltZyBzcmM9IiIgaWQ9ImFib3V0LWltYWdlIiBhbHQ9IiIgLz4NCgkJCeS8veiTneS5i+WgguKAlOKAlDxiciAvPuS4gOWPqumtlOazleW4iOeahOW3peWdigkJPC9kaXY+IDwhLS0gZW5kIGFib3V0IG1lIHNlY3Rpb24gLS0+DQoJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+PGRpdiBpZD0idGV4dC0yIiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF90ZXh0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7nm7jlhbPpk77mjqU8L2g0PgkJCTxkaXYgY2xhc3M9InRleHR3aWRnZXQiPjx1bD4KPGxpPjxhIGhyZWY9Imh0dHA6Ly9naXRodWIuY29tL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5HaXRodWI8L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHA6Ly93ZWliby5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+V2VpYm88L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+VHdpdHRlcjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5MaW5rZWRJbjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cDovL2liaXJlbWUuZGV2aWFudGFydC5jb20vIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5EZXZpYW50QVJUPC9hPjwvbGk+CjwvdWw+CjwvZGl2PgoJCTwvZGl2PiA8IS0tIGVuZCAuZXRfcGJfd2lkZ2V0IC0tPjxkaXYgaWQ9Im1ldGEtMiIgY2xhc3M9ImV0X3BiX3dpZGdldCB3aWRnZXRfbWV0YSI+PGg0IGNsYXNzPSJ3aWRnZXR0aXRsZSI+5Yqf6IO9PC9oND4JCQk8dWw+CgkJCQkJCTxsaT48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtbG9naW4ucGhwIj7nmbvlvZU8L2E+PC9saT4KCQkJPGxpPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9mZWVkLyI+5p2h55uuZmVlZDwvYT48L2xpPgoJCQk8bGk+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NvbW1lbnRzL2ZlZWQvIj7or4TorrpmZWVkPC9hPjwvbGk+CgkJCTxsaT48YSBocmVmPSJodHRwczovL2NuLndvcmRwcmVzcy5vcmcvIj5Xb3JkUHJlc3Mub3JnPC9hPjwvbGk+CQkJPC91bD4KCQkJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+CTwvZGl2PiA8IS0tIGVuZCAjc2lkZWJhciAtLT4NCgkJPC9kaXY+IDwhLS0gI2NvbnRlbnQtYXJlYSAtLT4NCgk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KPC9kaXY+IDwhLS0gI21haW4tY29udGVudCAtLT4NCg0KCgkJCTxmb290ZXIgaWQ9Im1haW4tZm9vdGVyIj4KCQkJCQoKCQkKCQkJCTxkaXYgaWQ9ImZvb3Rlci1ib3R0b20iPgoJCQkJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciBjbGVhcmZpeCI+CgkJCQkKCQkJCQkJPHAgaWQ9ImNvcHlyaWdodCI+CgkJCQkJCQlDb3B5cmlnaHQgMjAyMSBpYmlyZW1lCgkJCQkJCTwvcD4KCQkJCQk8L2Rpdj4JPCEtLSAuY29udGFpbmVyIC0tPgoJCQkJPC9kaXY+CgkJCTwvZm9vdGVyPiA8IS0tICNtYWluLWZvb3RlciAtLT4KCQk8L2Rpdj4gPCEtLSAjZXQtbWFpbi1hcmVhIC0tPgoKCgk8L2Rpdj4gPCEtLSAjcGFnZS1jb250YWluZXIgLS0+CgoJPCEtLSBCYWlkdSBBbmFseXRpY3MgLS0+DQo8c2NyaXB0Pg0KdmFyIF9obXQgPSBfaG10IHx8IFtdOw0KKGZ1bmN0aW9uKCkgew0KICB2YXIgaG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgaG0uc3JjID0gImh0dHBzOi8vaG0uYmFpZHUuY29tL2htLmpzPzZmMzAwN2QzZmUxNTI0NDk4MGVmZjU4OWY5ZDc4MDYzIjsNCiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07IA0KICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGhtLCBzKTsNCn0pKCk7DQo8L3NjcmlwdD4NCg0KPCEtLSBHb29nbGUgQW5hbHl0aWNzIC0tPg0KPHNjcmlwdCBhc3luYyBzcmM9Imh0dHBzOi8vd3d3Lmdvb2dsZXRhZ21hbmFnZXIuY29tL2d0YWcvanM/aWQ9VUEtNDMwMTc2NDctMSI+PC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICB3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsNCiAgZnVuY3Rpb24gZ3RhZygpe2RhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7fQ0KICBndGFnKCdqcycsIG5ldyBEYXRlKCkpOw0KICBndGFnKCdjb25maWcnLCAnVUEtNDMwMTc2NDctMScpOw0KPC9zY3JpcHQ+CjwhLS0gV1AgQXVkaW8gcGxheWVyIHBsdWdpbiB2MS45LjYgLSBodHRwczovL3d3dy50aXBzYW5kdHJpY2tzLWhxLmNvbS93b3JkcHJlc3MtYXVkaW8tbXVzaWMtcGxheWVyLXBsdWdpbi00NTU2LyAtLT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICAgICAgc291bmRNYW5hZ2VyLnVzZUZsYXNoQmxvY2sgPSB0cnVlOyAvLyBvcHRpb25hbCAtIGlmIHVzZWQsIHJlcXVpcmVkIGZsYXNoYmxvY2suY3NzDQogICAgICAgIHNvdW5kTWFuYWdlci51cmwgPSAnaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9zd2Yvc291bmRtYW5hZ2VyMi5zd2YnOw0KICAgICAgICBmdW5jdGlvbiBwbGF5X21wMyhmbGcsIGlkcywgbXAzdXJsLCB2b2x1bWUsIGxvb3BzKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL0NoZWNrIHRoZSBmaWxlIFVSTCBwYXJhbWV0ZXIgdmFsdWUNCiAgICAgICAgICAgIHZhciBwaWVjZXMgPSBtcDN1cmwuc3BsaXQoInwiKTsNCiAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMSkgey8vV2UgaGF2ZSBnb3QgYW4gLm9nZyBmaWxlIHRvbw0KICAgICAgICAgICAgICAgIG1wM2ZpbGUgPSBwaWVjZXNbMF07DQogICAgICAgICAgICAgICAgb2dnZmlsZSA9IHBpZWNlc1sxXTsNCiAgICAgICAgICAgICAgICAvL3NldCB0aGUgZmlsZSBVUkwgdG8gYmUgYW4gYXJyYXkgd2l0aCB0aGUgbXAzIGFuZCBvZ2cgZmlsZQ0KICAgICAgICAgICAgICAgIG1wM3VybCA9IG5ldyBBcnJheShtcDNmaWxlLCBvZ2dmaWxlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLmNyZWF0ZVNvdW5kKHsNCiAgICAgICAgICAgICAgICBpZDogJ2J0bnBsYXlfJyArIGlkcywNCiAgICAgICAgICAgICAgICB2b2x1bWU6IHZvbHVtZSwNCiAgICAgICAgICAgICAgICB1cmw6IG1wM3VybA0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGlmIChmbGcgPT0gJ3BsYXknKSB7DQogICAgICAgICAgICAgICAgICAgIHNvdW5kTWFuYWdlci5wbGF5KCdidG5wbGF5XycgKyBpZHMsIHsNCiAgICAgICAgICAgICAgICAgICAgb25maW5pc2g6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvb3BzID09ICd0cnVlJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZCgnYnRucGxheV8nICsgaWRzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuc3RvcF8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChmbGcgPT0gJ3N0b3AnKSB7DQogICAgLy9zb3VuZE1hbmFnZXIuc3RvcCgnYnRucGxheV8nK2lkcyk7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBhdXNlKCdidG5wbGF5XycgKyBpZHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIHNob3dfaGlkZShmbGFnLCBpZHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChmbGFnID09ICdwbGF5Jykgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoZmxhZyA9PSAnc3RvcCcpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRucGxheV8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmdW5jdGlvbiBsb29wU291bmQoc291bmRJRCkNCiAgICAgICAgew0KICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBsYXkoc291bmRJRCwge29uZmluaXNoOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZChzb3VuZElEKTsNCiAgICAgICAgICAgICAgICAgICAgfX0pOw0KICAgICAgICAgICAgfSwgMSk7DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gc3RvcF9hbGxfdHJhY2tzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLnN0b3BBbGwoKTsNCiAgICAgICAgICAgIHZhciBpbnB1dHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5wbGF5XyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsvL1RvZ2dsZSB0aGUgcGxheSBidXR0b24NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5zdG9wXyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Ly9IaWRlIHRoZSBzdG9wIGJ1dHRvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9mcm9udGVuZC1idWlsZGVyLWdsb2JhbC1mdW5jdGlvbnMuanM/dmVyPTIuNS4zJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvY3VzdG9tLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9qcXVlcnkuZml0dmlkcy5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvd2F5cG9pbnRzLm1pbi5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvanF1ZXJ5Lm1hZ25pZmljLXBvcHVwLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBldF9jdXN0b20gPSB7ImFqYXh1cmwiOiJodHRwczpcL1wvYmxvZy5pYmlyZW1lLmNvbVwvd3AtYWRtaW5cL2FkbWluLWFqYXgucGhwIiwiaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2ltYWdlcyIsImJ1aWxkZXJfaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2luY2x1ZGVzXC9idWlsZGVyXC9pbWFnZXMiLCJldF9sb2FkX25vbmNlIjoiZGM4NmFmOTNlMiIsInN1YnNjcmlwdGlvbl9mYWlsZWQiOiJQbGVhc2UsIGNoZWNrIHRoZSBmaWVsZHMgYmVsb3cgdG8gbWFrZSBzdXJlIHlvdSBlbnRlcmVkIHRoZSBjb3JyZWN0IGluZm9ybWF0aW9uLiIsImZpbGwiOiJGaWxsIiwiZmllbGQiOiJmaWVsZCIsImludmFsaWQiOiJJbnZhbGlkIGVtYWlsIiwiY2FwdGNoYSI6IkNhcHRjaGEiLCJwcmV2IjoiUHJldiIsInByZXZpb3VzIjoiXHU0ZTBhXHU0ZTAwXHU5ODc1IiwibmV4dCI6Ilx1NGUwYlx1NGUwMFx1OTg3NSIsImlzX2J1aWxkZXJfcGx1Z2luX3VzZWQiOiIifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvZnJvbnRlbmQtYnVpbGRlci1zY3JpcHRzLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy93cC1lbWJlZC5taW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==" srcset="/img/loading.gif" lazyload></p>
<p>苹果官方将整个系统大致划分为上述 4 个层次：<br>应用层包括用户能接触到的图形应用，例如 Spotlight、Aqua、SpringBoard 等。<br>应用框架层即开发人员接触到的 Cocoa 等框架。<br>核心框架层包括各种核心框架、OpenGL 等内容。<br>Darwin 即操作系统的核心，包括系统内核、驱动、Shell 等内容，这一层是开源的，其所有源码都可以在 <a target="_blank" rel="noopener" href="http://opensource.apple.com/">opensource.apple.com</a> 里找到。</p>
<p>我们在深入看一下 Darwin 这个核心的架构：<br>[<img src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+DQo8IS0tW2lmIElFIDZdPg0KPGh0bWwgaWQ9ImllNiIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDddPg0KPGh0bWwgaWQ9ImllNyIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDhdPg0KPGh0bWwgaWQ9ImllOCIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmICEoSUUgNikgfCAhKElFIDcpIHwgIShJRSA4KSAgXT48IS0tPg0KPGh0bWwgbGFuZz0iemgtQ04iPg0KPCEtLTwhW2VuZGlmXS0tPg0KPGhlYWQ+DQoJPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+DQoJPHRpdGxlPjQwNCDmnKrmib7liLAgfCBHYXJhbiBubyBkb3U8L3RpdGxlPg0KCQkJDQoJDQoJPGxpbmsgcmVsPSJwaW5nYmFjayIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3htbHJwYy5waHAiIC8+DQoNCgkJPCEtLVtpZiBsdCBJRSA5XT4NCgk8c2NyaXB0IHNyYz0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvaHRtbDUuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQoJPCFbZW5kaWZdLS0+DQoNCgk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUgPSAnanMnOw0KCTwvc2NyaXB0Pg0KDQoJPGxpbmsgcmVsPSdkbnMtcHJlZmV0Y2gnIGhyZWY9Jy8vZm9udHMuZ29vZ2xlYXBpcy5jb20nIC8+CjxsaW5rIHJlbD0nZG5zLXByZWZldGNoJyBocmVmPScvL3Mudy5vcmcnIC8+CjxsaW5rIHJlbD0iYWx0ZXJuYXRlIiB0eXBlPSJhcHBsaWNhdGlvbi9yc3MreG1sIiB0aXRsZT0iR2FyYW4gbm8gZG91ICZyYXF1bzsgRmVlZCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2ZlZWQvIiAvPgo8bGluayByZWw9ImFsdGVybmF0ZSIgdHlwZT0iYXBwbGljYXRpb24vcnNzK3htbCIgdGl0bGU9IkdhcmFuIG5vIGRvdSAmcmFxdW87IOivhOiuukZlZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jb21tZW50cy9mZWVkLyIgLz4KPG1ldGEgY29udGVudD0iRGl2aSB2LjIuNS4zIiBuYW1lPSJnZW5lcmF0b3IiLz48bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdzY2FwLmZsYXNoYmxvY2stY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvZmxhc2hibG9jay5jc3M/dmVyPTUuNC42JyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nc2NhcC5wbGF5ZXItY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvcGxheWVyLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdjcmF5b24tY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jcmF5b24tc3ludGF4LWhpZ2hsaWdodGVyL2Nzcy9taW4vY3JheW9uLm1pbi5jc3M/dmVyPV8yLjcuMl9iZXRhJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nd3AtZWFzeWFyY2hpdmVzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3BsdWdpbnMvd3AtZWFzeWFyY2hpdmVzL2Nzcy93cC1lYXN5YXJjaGl2ZXMuY3NzP3Zlcj0zLjEuMicgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdzY3JlZW4nIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J3dwLWJsb2NrLWxpYnJhcnktY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2Nzcy9kaXN0L2Jsb2NrLWxpYnJhcnkvc3R5bGUubWluLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdtYXRoLWNhcHRjaGEtZnJvbnRlbmQtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy93cC1tYXRoLWNhcHRjaGEvY3NzL2Zyb250ZW5kLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSd3cC1wYWdlbmF2aS1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3dwLXBhZ2VuYXZpL3BhZ2VuYXZpLWNzcy5jc3M/dmVyPTIuNzAnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdkaXZpLWZvbnRzLWNzcycgIGhyZWY9J2h0dHBzOi8vZm9udHMubG9saS5uZXQvY3NzP2ZhbWlseT1PcGVuK1NhbnM6MzAwaXRhbGljLDQwMGl0YWxpYyw2MDBpdGFsaWMsNzAwaXRhbGljLDgwMGl0YWxpYyw0MDAsMzAwLDYwMCw3MDAsODAwJiMwMzg7c3Vic2V0PWxhdGluLGxhdGluLWV4dCcgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LWdmLWNoaW5lc2UtY3NzJyAgaHJlZj0nLy9mb250cy5sb2xpLm5ldC9lYXJseWFjY2Vzcy9jd3RleGZhbmdzb25nLmNzcycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2Rpdmktc3R5bGUtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0Rpdmkvc3R5bGUuY3NzP3Zlcj0yLjUuMycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LXNob3J0Y29kZXMtY3NzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2VwYW5lbC9zaG9ydGNvZGVzL2Nzcy9zaG9ydGNvZGVzLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nZXQtc2hvcnRjb2Rlcy1yZXNwb25zaXZlLWNzcy1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9lcGFuZWwvc2hvcnRjb2Rlcy9jc3Mvc2hvcnRjb2Rlc19yZXNwb25zaXZlLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9qcy9zb3VuZG1hbmFnZXIyLW5vZGVidWctanNtaW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2pzL2pxdWVyeS9qcXVlcnkuanM/dmVyPTEuMTIuNC13cCc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy9qcXVlcnkvanF1ZXJ5LW1pZ3JhdGUubWluLmpzP3Zlcj0xLjQuMSc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBDcmF5b25TeW50YXhTZXR0aW5ncyA9IHsidmVyc2lvbiI6Il8yLjcuMl9iZXRhIiwiaXNfYWRtaW4iOiIwIiwiYWpheHVybCI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1hZG1pblwvYWRtaW4tYWpheC5waHAiLCJwcmVmaXgiOiJjcmF5b24tIiwic2V0dGluZyI6ImNyYXlvbi1zZXR0aW5nIiwic2VsZWN0ZWQiOiJjcmF5b24tc2V0dGluZy1zZWxlY3RlZCIsImNoYW5nZWQiOiJjcmF5b24tc2V0dGluZy1jaGFuZ2VkIiwic3BlY2lhbCI6ImNyYXlvbi1zZXR0aW5nLXNwZWNpYWwiLCJvcmlnX3ZhbHVlIjoiZGF0YS1vcmlnLXZhbHVlIiwiZGVidWciOiIifTsKdmFyIENyYXlvblN5bnRheFN0cmluZ3MgPSB7ImNvcHkiOiJQcmVzcyAlcyB0byBDb3B5LCAlcyB0byBQYXN0ZSIsIm1pbmltaXplIjoiQ2xpY2sgVG8gRXhwYW5kIENvZGUifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL2NyYXlvbi1zeW50YXgtaGlnaGxpZ2h0ZXIvanMvbWluL2NyYXlvbi5taW4uanM/dmVyPV8yLjcuMl9iZXRhJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9zaW1wbGVzbWlsZXlzaG93L2pxdWVyeS5pbnNlcnRhdGNhcmV0LmpzJz48L3NjcmlwdD4KPGxpbmsgcmVsPSdodHRwczovL2FwaS53Lm9yZy8nIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1qc29uLycgLz4KPGxpbmsgcmVsPSJFZGl0VVJJIiB0eXBlPSJhcHBsaWNhdGlvbi9yc2QreG1sIiB0aXRsZT0iUlNEIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20veG1scnBjLnBocD9yc2QiIC8+CjxsaW5rIHJlbD0id2x3bWFuaWZlc3QiIHR5cGU9ImFwcGxpY2F0aW9uL3dsd21hbmlmZXN0K3htbCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL3dsd21hbmlmZXN0LnhtbCIgLz4gCjxtZXRhIG5hbWU9ImdlbmVyYXRvciIgY29udGVudD0iV29yZFByZXNzIDUuNC42IiAvPgoKPCEtLSBHZW5lcmF0ZWQgQnkgU2hvdy1Vc2VyQWdlbnQgMS4wLjggLSBodHRwOi8vemx6LmltL3Nob3ctdXNlcmFnZW50LyAtLT4KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3Nob3ctdXNlcmFnZW50L3Nob3ctdXNlcmFnZW50LmNzcyIgdHlwZT0idGV4dC9jc3MiIG1lZGlhPSJzY3JlZW4iIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT0wIiAvPgkJPHN0eWxlIGlkPSJ0aGVtZS1jdXN0b21pemVyLWNzcyI+DQoJCQkJCQkJCQkJCQkJLndvb2NvbW1lcmNlICNyZXNwb25kIGlucHV0I3N1Ym1pdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LCAud29vY29tbWVyY2UgI2NvbnRlbnQgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSAjY29udGVudCBpbnB1dC5idXR0b24sIC53b29jb21tZXJjZS1tZXNzYWdlLCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1pbmZvIHsgYmFja2dyb3VuZDogI2E5ZDMwMCAhaW1wb3J0YW50OyB9DQoJCQkjZXRfc2VhcmNoX2ljb246aG92ZXIsIC5tb2JpbGVfbWVudV9iYXI6YmVmb3JlLCAuZXQtc29jaWFsLWljb24gYTpob3ZlciwgLmV0X3BiX3N1bSwgLmV0X3BiX3ByaWNpbmcgbGkgYSwgLmV0X3BiX3ByaWNpbmdfdGFibGVfYnV0dG9uLCAuZXRfb3ZlcmxheTpiZWZvcmUsIC5lbnRyeS1zdW1tYXJ5IHAucHJpY2UgaW5zLCAud29vY29tbWVyY2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UtcGFnZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLmV0X3BiX21lbWJlcl9zb2NpYWxfbGlua3MgYTpob3ZlciwgLndvb2NvbW1lcmNlIC5zdGFyLXJhdGluZyBzcGFuOmJlZm9yZSwgLndvb2NvbW1lcmNlLXBhZ2UgLnN0YXItcmF0aW5nIHNwYW46YmVmb3JlLCAuZXRfcGJfd2lkZ2V0IGxpIGE6aG92ZXIsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydGZvbGlvX2ZpbHRlcnMgbGkgYS5hY3RpdmUsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydG9mb2xpb19wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAuZXRfcGJfZ2FsbGVyeSAuZXRfcGJfZ2FsbGVyeV9wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAud3AtcGFnZW5hdmkgc3Bhbi5jdXJyZW50LCAud3AtcGFnZW5hdmkgYTpob3ZlciwgLm5hdi1zaW5nbGUgYSwgLnBvc3RlZF9pbiBhIHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCS5ldF9wYl9jb250YWN0X3N1Ym1pdCwgLmV0X3Bhc3N3b3JkX3Byb3RlY3RlZF9mb3JtIC5ldF9zdWJtaXRfYnV0dG9uLCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9uZXdzbGV0dGVyX2J1dHRvbiwgLmNvbW1lbnQtcmVwbHktbGluaywgLmZvcm0tc3VibWl0IGlucHV0LCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9wcm9tb19idXR0b24sIC5ldF9wYl9iZ19sYXlvdXRfbGlnaHQgLmV0X3BiX21vcmVfYnV0dG9uLCAud29vY29tbWVyY2UgYS5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBhLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgYnV0dG9uLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBhLmJ1dHRvbiwgLndvb2NvbW1lcmNlLXBhZ2UgYS5idXR0b24sIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24geyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmZvb3Rlci13aWRnZXQgaDQgeyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmV0LXNlYXJjaC1mb3JtLCAubmF2IGxpIHVsLCAuZXRfbW9iaWxlX21lbnUsIC5mb290ZXItd2lkZ2V0IGxpOmJlZm9yZSwgLmV0X3BiX3ByaWNpbmcgbGk6YmVmb3JlLCBibG9ja3F1b3RlIHsgYm9yZGVyLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkuZXRfcGJfY291bnRlcl9hbW91bnQsIC5ldF9wYl9mZWF0dXJlZF90YWJsZSAuZXRfcGJfcHJpY2luZ19oZWFkaW5nLCAuZXRfcXVvdGVfY29udGVudCwgLmV0X2xpbmtfY29udGVudCwgLmV0X2F1ZGlvX2NvbnRlbnQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkJCQkJLmNvbnRhaW5lciwgLmV0X3BiX3JvdywgLmV0X3BiX3NsaWRlciAuZXRfcGJfY29udGFpbmVyLCAuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24gLmV0X3BiX3RpdGxlX2NvbnRhaW5lciwgLmV0X3BiX2Z1bGx3aWR0aF9zZWN0aW9uIC5ldF9wYl90aXRsZV9mZWF0dXJlZF9jb250YWluZXIsIC5ldF9wYl9mdWxsd2lkdGhfaGVhZGVyOm5vdCguZXRfcGJfZnVsbHNjcmVlbikgLmV0X3BiX2Z1bGx3aWR0aF9oZWFkZXJfY29udGFpbmVyIHsgbWF4LXdpZHRoOiA5NjBweDsgfQ0KCQkJLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIsIC5ldF9maXhlZF9uYXYuZXRfYm94ZWRfbGF5b3V0ICNwYWdlLWNvbnRhaW5lciAjdG9wLWhlYWRlciwgLmV0X2ZpeGVkX25hdi5ldF9ib3hlZF9sYXlvdXQgI3BhZ2UtY29udGFpbmVyICNtYWluLWhlYWRlciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmNvbnRhaW5lciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmV0X3BiX3JvdyB7IG1heC13aWR0aDogMTEyMHB4OyB9DQoJCQkJCQkJYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI3RvcC1oZWFkZXIsICNldC1zZWNvbmRhcnktbmF2IGxpIHVsIHsgYmFja2dyb3VuZC1jb2xvcjogI2E5ZDMwMDsgfQ0KCQkJCQkJCQkjdG9wLWhlYWRlciwgI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQkJCQkJCQkJCQ0KCQkNCgkJCQkJI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX3JlZCAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9yZWQgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfcGluayAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9waW5rICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX29yYW5nZSAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9vcmFuZ2UgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsIC5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI21haW4tZm9vdGVyIC5mb290ZXItd2lkZ2V0IGg0IHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkuZm9vdGVyLXdpZGdldCBsaTpiZWZvcmUgeyBib3JkZXItY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkNCgkJDQoJCQ0KCQlAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWluLXdpZHRoOiA5ODFweCApIHsNCgkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIsIC5ldC1maXhlZC1oZWFkZXIjdG9wLWhlYWRlciAjZXQtc2Vjb25kYXJ5LW5hdiBsaSB1bCB7IGJhY2tncm91bmQtY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtYW5jZXN0b3IgPiBhLA0KCQkJCS5ldC1maXhlZC1oZWFkZXIgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjICFpbXBvcnRhbnQ7IH0NCgkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQ0KCQkJCQl9DQoJCUBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKCBtaW4td2lkdGg6IDEyMDBweCkgew0KCQkJLmV0X3BiX3JvdyB7IHBhZGRpbmc6IDI0cHggMDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24geyBwYWRkaW5nOiA0OHB4IDA7IH0NCgkJCS5zaW5nbGUuZXRfcGJfcGFnZWJ1aWxkZXJfbGF5b3V0LmV0X2Z1bGxfd2lkdGhfcGFnZSAuZXRfcG9zdF9tZXRhX3dyYXBwZXIgeyBwYWRkaW5nLXRvcDogNzJweDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24uZXRfcGJfc2VjdGlvbl9maXJzdCB7IHBhZGRpbmctdG9wOiBpbmhlcml0OyB9DQoJCQkuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24geyBwYWRkaW5nOiAwOyB9DQoJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogOTgwcHggKSB7DQoJCQkJCQkJCQkJCQkJCQkJCQkJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogNzY3cHggKSB7DQoJCQkJCQkJCQkJCQkJCX0NCgk8L3N0eWxlPg0KDQoJPHN0eWxlIGNsYXNzPSJldF9vbmVfZm9udF9sYW5ndWFnZXMiPmgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGJvZHksIGlucHV0LCB0ZXh0YXJlYSwgc2VsZWN0IHsgZm9udC1mYW1pbHk6ICdjd1RlWEZhbmdTb25nJywgc2VyaWY7IH08L3N0eWxlPg0KCQ0KCTxzdHlsZSBpZD0ibW9kdWxlLWN1c3RvbWl6ZXItY3NzIj4NCgkJCTwvc3R5bGU+DQoNCgk8IS0tIEFsbCBpbiBvbmUgRmF2aWNvbiA0LjcgLS0+PGxpbmsgcmVsPSJpY29uIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTMvMDgvZmF2aWNvbi5wbmciIHR5cGU9ImltYWdlL3BuZyIvPgo8bGluayByZWw9ImFwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxMy8wOC9mYXZpY29uMi5wbmciIC8+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyIgaWQ9ImV0LWN1c3RvbS1jc3MiPgpoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBib2R5LCBpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCB7DQpmb250LWZhbWlseTogJ1BpbmdGYW5nIFNDJywgJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgVmVyZGFuYSwgJ0hpcmFnaW5vIFNhbnMgR0InLCAnTm90byBTYW5zIENKSyBTQycsICdTb3VyY2UgSGFuIFNhbnMgQ04nLCBTVEhlaXRpLCAnTWljcm9zb2Z0IFlhSGVpJywgJ1dlblF1YW5ZaSBNaWNybyBIZWknLCBTaW1TdW4sIHNhbnMtc2VyaWY7DQpmb250LXdlaWdodDogNDAwOw0KfQ0KDQojbWFpbi1oZWFkZXIgew0KICAgIGJhY2tncm91bmQ6IGhzbGEoMCwgMCUsIDEwMCUsIC44NSk7DQogICAgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTJweCk7DQogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEycHgpOw0KfQ0KDQpib2R5IHsgDQoJZm9udC1zaXplOiAxNnB4Ow0KCWNvbG9yOiAjMWQxZDFkOw0KCXdvcmQtd3JhcDpicmVhay13b3JkOw0KCXdvcmQtYnJlYWs6IG5vcm1hbDsNCn0NCg0KcCB7DQoJbWFyZ2luOiAwLjllbSAwIDAuNWVtOw0KCXBhZGRpbmctYm90dG9tOiAwLjZlbTsNCglmb250LXNpemU6IDEwMCU7DQoJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOw0KfQ0KDQouZXRfcGJfcG9zdCBoMiB7DQoJZm9udC13ZWlnaHQ6IGJvbGQ7DQp9DQoNCi5ldF9wYl9wb3N0IC5wb3N0LW1ldGEgew0KCTE0cHggIkNsYXNzaWMgR3JvdGVzcXVlIFcwMSIsIEFyaWFsLCBzYW5zLXNlcmlmOw0KfQ0KDQouZXRfcGJfcG9zdCB7DQoJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlMmUyZTI7DQoJcGFkZGluZy1ib3R0b206IDIwcHg7DQp9DQoNCi5ldF9wYl9wb3N0Omxhc3Qtb2YtdHlwZSB7DQoJYm9yZGVyLWJvdHRvbTogMHB4IHNvbGlkICNlMmUyZTI7DQp9DQoNCiNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB7DQoJcGFkZGluZy10b3A6IDMwcHg7DQp9DQoNCi5ldF9yaWdodF9zaWRlYmFyICNzaWRlYmFyIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmhvbWUgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMHB4Ow0KfQ0KDQouc2luZ2xlLXBvc3QgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmV0X3BiX3Bvc3Qgew0KICBtYXJnaW4tYm90dG9tOiA0MHB4Ow0KfQ0KDQouZXRfcGJfcG9zdCAuZW50cnktY29udGVudCwgDQoucHJvamVjdCAuZW50cnktY29udGVudCB7DQogIHBhZGRpbmctdG9wOiAxMHB4Ow0KfQ0KDQoud2lkZ2V0X2Fib3V0bWV3aWRnZXQgLmNsZWFyZml4LA0KLmV0X3BiX3dpZGdldCBsaSB7DQoJZm9udC1zaXplOiA5MyU7DQp9DQoNCi53aWRnZXR0aXRsZSB7DQoJZm9udC1zaXplOiAxMjAlOw0KfQ0KDQouZXRfcGJfc2Nyb2xsX3RvcCB7DQogICAgYm90dG9tOiAxNXB4Ow0KfQ0KDQojdG9wLW1lbnUgbGkgPiBhLCANCi5mdWxsd2lkdGgtbWVudSBsaSA+IGEgew0KCWZvbnQtc2l6ZTogMTRweDsNCglmb250LXdlaWdodDogNDAwOw0KfQ0KDQojZm9vdGVyLWJvdHRvbSB7DQoJcGFkZGluZzogNXB4IDAgN3B4Ow0KfQ0KDQppbWcud3Atc21pbGV5IHsNCgltYXgtaGVpZ2h0OiAxLjJlbSAhaW1wb3J0YW50Ow0KCWhlaWdodDogMS4yZW0gIWltcG9ydGFudDsNCgl3aWR0aDogMS4yZW0gIWltcG9ydGFudDsNCn0NCg0KLndwLXNtaWxleWxpbmsgew0KCW1heC13aWR0aDogMjJweCAhaW1wb3J0YW50Ow0KfQ0KDQojbGVmdC1hcmVhIGE6aG92ZXIgew0KCXRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQojY29tbWVudGZvcm0gdGV4dGFyZWEsIA0KI2NvbW1lbnRmb3JtIGlucHV0W3R5cGU9InRleHQiXSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KfQ0KDQpAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWF4LXdpZHRoOiA3NjdweCApIHsNCgkuZXRfcGJfcm93LCAuY29udGFpbmVyLCAuZXRfcGJfY29udGFpbmVyIHsgd2lkdGg6IDg1JTsgfQ0KCS5ldF9wYl9wb3N0IGgyLCAuZXRfcGJfcG9ydGZvbGlvX2l0ZW0gaDIgeyBmb250LXNpemU6IDI0cHg7IH0NCgkuY29tbWVudC1ib2R5IHsgcGFkZGluZzogMCAwIDI1cHggMTAwcHg7IH0NCn0NCg0KI2R5bmFtaWMtdG8tdG9wIHsNCglkaXNwbGF5Om5vbmU7DQoJb3ZlcmZsb3c6aGlkZGVuOw0KCXdpZHRoOmF1dG87DQoJei1pbmRleDo5MDsNCglwb3NpdGlvbjpmaXhlZDsNCgl0b3A6YXV0bzsNCglsZWZ0OmF1dG87DQoJZm9udC1mYW1pbHk6c2Fucy1zZXJpZjsNCglmb250LXNpemU6MWVtOw0KCWNvbG9yOiNmZmY7DQoJdGV4dC1kZWNvcmF0aW9uOm5vbmU7DQoJdGV4dC1zaGFkb3c6MCAxcHggMCAjMzMzOw0KCWZvbnQtd2VpZ2h0OmJvbGQ7DQoJcGFkZGluZzoxN3B4IDE2cHg7DQoJYm9yZGVyOjBweCBzb2xpZCAjMDAwOw0KCWJhY2tncm91bmQ6IzExMTsNCgktd2Via2l0LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktbW96LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktaWNhYi1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJLWtodG1sLWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktby1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJYmFja2dyb3VuZC1vcmlnaW46Ym9yZGVyOw0KCS13ZWJraXQtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1tb3otYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1pY2FiLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgkta2h0bWwtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1vLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgliYWNrZ3JvdW5kLWNsaXA6cGFkZGluZy1ib3g7DQoJLXdlYmtpdC1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktbXMtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLW1vei1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktby1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgkta2h0bWwtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLWljYWItYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLXdlYmtpdC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLW1vei1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLWljYWItYm9yZGVyLXJhZGl1czoyM3B4Ow0KCS1raHRtbC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJYm9yZGVyLXJhZGl1czoyM3B4DQp9DQojZHluYW1pYy10by10b3A6aG92ZXIgew0KCWJhY2tncm91bmQ6IzRkNGRhYzsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1ncmFkaWVudCggbGluZWFyLCAwJSAwJSwgMCUgMTAwJSwgZnJvbSggcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSApLCB0byggcmdiYSggMCwgMCwgMCwgMCApICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1raHRtbC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tb3otbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzA4ZiAtby1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tcy1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1pY2FiLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAyNTUsIDI1NSwgMjU1LCAuMiApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWN1cnNvcjpwb2ludGVyDQp9DQojZHluYW1pYy10by10b3A6YWN0aXZlIHsNCgliYWNrZ3JvdW5kOiMxMTE7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtZ3JhZGllbnQoIGxpbmVhciwgMCUgMCUsIDAlIDEwMCUsIGZyb20oIHJnYmEoIDAsIDAsIDAsIC4zICkgKSwgdG8oIHJnYmEoIDAsIDAsIDAsIDAgKSApICk7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbW96LWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLWtodG1sLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLW8tbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbXMtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtaWNhYi1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMCwgMCwgMCwgLjEgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMTExIGxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKQ0KfQ0KI2R5bmFtaWMtdG8tdG9wLCNkeW5hbWljLXRvLXRvcDphY3RpdmUsI2R5bmFtaWMtdG8tdG9wOmZvY3VzLCNkeW5hbWljLXRvLXRvcDpob3ZlciB7DQoJb3V0bGluZTpub25lDQp9DQojZHluYW1pYy10by10b3Agc3BhbiB7DQoJZGlzcGxheTpibG9jazsNCglvdmVyZmxvdzpoaWRkZW47DQoJd2lkdGg6MTRweDsNCgloZWlnaHQ6MTJweDsNCgliYWNrZ3JvdW5kOnVybCgvd3AtY29udGVudC9wbHVnaW5zL2R5bmFtaWMtdG8tdG9wL2Nzcy9pbWFnZXMvdXAucG5nICluby1yZXBlYXQgY2VudGVyIGNlbnRlcg0KfQ0KDQouZW50cnktY29udGVudCB0YWJsZSwgYm9keS5ldC1wYi1wcmV2aWV3ICNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB0YWJsZSB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0MxQzFDMTsNCiAgICBsaW5lLWhlaWdodDogMS40ZW07DQoNCiAgICBib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlOw0KfQ0KDQp0aGVhZCB7DQoJYmFja2dyb3VuZC1jb2xvcjogI0YxRjFGMTsNCn0NCg0KcCNjb3B5cmlnaHQgew0KICAgIGNvbG9yOiAjNzE3MTcxOw0KfQo8L3N0eWxlPjwvaGVhZD4NCjxib2R5IGNsYXNzPSJlcnJvcjQwNCBldF9wYl9idXR0b25faGVscGVyX2NsYXNzIGV0X2ZpeGVkX25hdiBldF9zaG93X25hdiBldF9jb3Zlcl9iYWNrZ3JvdW5kIGV0X3BiX2d1dHRlciBvc3ggZXRfcGJfZ3V0dGVyczMgZXRfcHJpbWFyeV9uYXZfZHJvcGRvd25fYW5pbWF0aW9uX2ZhZGUgZXRfc2Vjb25kYXJ5X25hdl9kcm9wZG93bl9hbmltYXRpb25fZmFkZSBldF9wYl9mb290ZXJfY29sdW1uczQgZXRfaGVhZGVyX3N0eWxlX2xlZnQgZXRfcmlnaHRfc2lkZWJhciBjaHJvbWUiPg0KCTxkaXYgaWQ9InBhZ2UtY29udGFpbmVyIj4NCg0KCQ0KCQk8aGVhZGVyIGlkPSJtYWluLWhlYWRlciIgZGF0YS1oZWlnaHQtb25sb2FkPSI2NiI+DQoJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgY2xlYXJmaXggZXRfbWVudV9jb250YWluZXIiPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImxvZ29fY29udGFpbmVyIj4NCgkJCQkJPHNwYW4gY2xhc3M9ImxvZ29faGVscGVyIj48L3NwYW4+DQoJCQkJCTxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQkJPGltZyBzcmM9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxNS8wNS9sb2dvMS5wbmciIGFsdD0iR2FyYW4gbm8gZG91IiBpZD0ibG9nbyIgZGF0YS1oZWlnaHQtcGVyY2VudGFnZT0iNTQiIC8+DQoJCQkJCTwvYT4NCgkJCQk8L2Rpdj4NCgkJCQk8ZGl2IGlkPSJldC10b3AtbmF2aWdhdGlvbiIgZGF0YS1oZWlnaHQ9IjY2IiBkYXRhLWZpeGVkLWhlaWdodD0iNDAiPg0KCQkJCQk8bmF2IGlkPSJ0b3AtbWVudS1uYXYiPg0KCQkJCQkJCQkJCQk8dWwgaWQ9InRvcC1tZW51IiBjbGFzcz0ibmF2Ij4NCgkJCQkJCQkJCQkJCQkJCTxsaSA+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tLyI+6aaW6aG1PC9hPjwvbGk+DQoJCQkJCQkJDQoJCQkJCQkJPGxpIGNsYXNzPSJwYWdlX2l0ZW0gcGFnZS1pdGVtLTM0Ij48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vYWJvdXQvIj5BYm91dDwvYT48L2xpPgo8bGkgY2xhc3M9InBhZ2VfaXRlbSBwYWdlLWl0ZW0tNDE1MDIiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9hcmNoaXZlLyI+QXJjaGl2ZTwvYT48L2xpPgoJCQkJCQkJCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2FjZy8iPkFDRzwvYT4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMSI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L290aGVyLyI+5YW25LuWPC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2NoaXJydXAvIj7lkJDmp708L2E+CjwvbGk+Cgk8bGkgY2xhc3M9ImNhdC1pdGVtIGNhdC1pdGVtLTExIj48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vY2F0ZWdvcnkvdGVjLyI+5oqA5pyvPC9hPgo8dWwgY2xhc3M9J2NoaWxkcmVuJz4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMzAiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jYXRlZ29yeS90ZWMvaW9zLXRlYy8iPmlPUzwvYT4KPC9saT4KPC91bD4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNyI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2RhaWx5LyI+5pel5bi4PC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMiI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2Rlc2lnbi8iPuiuvuiuoTwvYT4KPC9saT4KCQkJCQkJPC91bD4NCgkJCQkJCQkJCQk8L25hdj4NCg0KCQkJCQkNCgkJCQkJDQoJCQkJCTxkaXYgaWQ9ImV0X21vYmlsZV9uYXZfbWVudSI+DQoJCQk8ZGl2IGNsYXNzPSJtb2JpbGVfbmF2IGNsb3NlZCI+DQoJCQkJPHNwYW4gY2xhc3M9InNlbGVjdF9wYWdlIj7pgInmi6npobXpnaI8L3NwYW4+DQoJCQkJPHNwYW4gY2xhc3M9Im1vYmlsZV9tZW51X2JhciI+PC9zcGFuPg0KCQkJPC9kaXY+DQoJCTwvZGl2PgkJCQk8L2Rpdj4gPCEtLSAjZXQtdG9wLW5hdmlnYXRpb24gLS0+DQoJCQk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KCQkJPGRpdiBjbGFzcz0iZXRfc2VhcmNoX291dGVyIj4NCgkJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgZXRfc2VhcmNoX2Zvcm1fY29udGFpbmVyIj4NCgkJCQkJPGZvcm0gcm9sZT0ic2VhcmNoIiBtZXRob2Q9ImdldCIgY2xhc3M9ImV0LXNlYXJjaC1mb3JtIiBhY3Rpb249Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQk8aW5wdXQgdHlwZT0ic2VhcmNoIiBjbGFzcz0iZXQtc2VhcmNoLWZpZWxkIiBwbGFjZWhvbGRlcj0i5pCc57SiICZoZWxsaXA7IiB2YWx1ZT0iIiBuYW1lPSJzIiB0aXRsZT0i5pCc57Si77yaIiAvPgkJCQkJPC9mb3JtPg0KCQkJCQk8c3BhbiBjbGFzcz0iZXRfY2xvc2Vfc2VhcmNoX2ZpZWxkIj48L3NwYW4+DQoJCQkJPC9kaXY+DQoJCQk8L2Rpdj4NCgkJPC9oZWFkZXI+IDwhLS0gI21haW4taGVhZGVyIC0tPg0KDQoJCTxkaXYgaWQ9ImV0LW1haW4tYXJlYSI+DQo8ZGl2IGlkPSJtYWluLWNvbnRlbnQiPg0KCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQoJCTxkaXYgaWQ9ImNvbnRlbnQtYXJlYSIgY2xhc3M9ImNsZWFyZml4Ij4NCgkJCTxkaXYgaWQ9ImxlZnQtYXJlYSI+DQoJCQkJPGFydGljbGUgaWQ9InBvc3QtMCIgY2xhc3M9ImV0X3BiX3Bvc3Qgbm90X2ZvdW5kIj4NCgkJCQkJPGRpdiBjbGFzcz0iZW50cnkiPg0KPCEtLUlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+DQoJPGgxPuacquaJvuWIsOe7k+aenDwvaDE+DQoJPHA+5oKo6K+35rGC55qE6aG16Z2i5peg5rOV5om+5Yiw44CC5bCd6K+V57K+56Gu5oKo55qE5pCc57Si77yM5oiW6ICF5L2/55So5LiK6Z2i55qE5a+86Iiq5a6a5L2N5paH56ug44CCPC9wPg0KPC9kaXY+DQo8IS0tRW5kIGlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+CQkJCTwvYXJ0aWNsZT4gPCEtLSAuZXRfcGJfcG9zdCAtLT4NCgkJCTwvZGl2PiA8IS0tICNsZWZ0LWFyZWEgLS0+DQoNCgkJCQk8ZGl2IGlkPSJzaWRlYmFyIj4NCgkJPGRpdiBpZD0iYWJvdXRtZXdpZGdldC01IiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF9hYm91dG1ld2lkZ2V0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7lhbPkuo48L2g0PgkJPGRpdiBjbGFzcz0iY2xlYXJmaXgiPg0KCQkJPGltZyBzcmM9IiIgaWQ9ImFib3V0LWltYWdlIiBhbHQ9IiIgLz4NCgkJCeS8veiTneS5i+WgguKAlOKAlDxiciAvPuS4gOWPqumtlOazleW4iOeahOW3peWdigkJPC9kaXY+IDwhLS0gZW5kIGFib3V0IG1lIHNlY3Rpb24gLS0+DQoJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+PGRpdiBpZD0idGV4dC0yIiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF90ZXh0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7nm7jlhbPpk77mjqU8L2g0PgkJCTxkaXYgY2xhc3M9InRleHR3aWRnZXQiPjx1bD4KPGxpPjxhIGhyZWY9Imh0dHA6Ly9naXRodWIuY29tL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5HaXRodWI8L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHA6Ly93ZWliby5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+V2VpYm88L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+VHdpdHRlcjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5MaW5rZWRJbjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cDovL2liaXJlbWUuZGV2aWFudGFydC5jb20vIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5EZXZpYW50QVJUPC9hPjwvbGk+CjwvdWw+CjwvZGl2PgoJCTwvZGl2PiA8IS0tIGVuZCAuZXRfcGJfd2lkZ2V0IC0tPjxkaXYgaWQ9Im1ldGEtMiIgY2xhc3M9ImV0X3BiX3dpZGdldCB3aWRnZXRfbWV0YSI+PGg0IGNsYXNzPSJ3aWRnZXR0aXRsZSI+5Yqf6IO9PC9oND4JCQk8dWw+CgkJCQkJCTxsaT48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtbG9naW4ucGhwIj7nmbvlvZU8L2E+PC9saT4KCQkJPGxpPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9mZWVkLyI+5p2h55uuZmVlZDwvYT48L2xpPgoJCQk8bGk+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NvbW1lbnRzL2ZlZWQvIj7or4TorrpmZWVkPC9hPjwvbGk+CgkJCTxsaT48YSBocmVmPSJodHRwczovL2NuLndvcmRwcmVzcy5vcmcvIj5Xb3JkUHJlc3Mub3JnPC9hPjwvbGk+CQkJPC91bD4KCQkJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+CTwvZGl2PiA8IS0tIGVuZCAjc2lkZWJhciAtLT4NCgkJPC9kaXY+IDwhLS0gI2NvbnRlbnQtYXJlYSAtLT4NCgk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KPC9kaXY+IDwhLS0gI21haW4tY29udGVudCAtLT4NCg0KCgkJCTxmb290ZXIgaWQ9Im1haW4tZm9vdGVyIj4KCQkJCQoKCQkKCQkJCTxkaXYgaWQ9ImZvb3Rlci1ib3R0b20iPgoJCQkJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciBjbGVhcmZpeCI+CgkJCQkKCQkJCQkJPHAgaWQ9ImNvcHlyaWdodCI+CgkJCQkJCQlDb3B5cmlnaHQgMjAyMSBpYmlyZW1lCgkJCQkJCTwvcD4KCQkJCQk8L2Rpdj4JPCEtLSAuY29udGFpbmVyIC0tPgoJCQkJPC9kaXY+CgkJCTwvZm9vdGVyPiA8IS0tICNtYWluLWZvb3RlciAtLT4KCQk8L2Rpdj4gPCEtLSAjZXQtbWFpbi1hcmVhIC0tPgoKCgk8L2Rpdj4gPCEtLSAjcGFnZS1jb250YWluZXIgLS0+CgoJPCEtLSBCYWlkdSBBbmFseXRpY3MgLS0+DQo8c2NyaXB0Pg0KdmFyIF9obXQgPSBfaG10IHx8IFtdOw0KKGZ1bmN0aW9uKCkgew0KICB2YXIgaG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgaG0uc3JjID0gImh0dHBzOi8vaG0uYmFpZHUuY29tL2htLmpzPzZmMzAwN2QzZmUxNTI0NDk4MGVmZjU4OWY5ZDc4MDYzIjsNCiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07IA0KICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGhtLCBzKTsNCn0pKCk7DQo8L3NjcmlwdD4NCg0KPCEtLSBHb29nbGUgQW5hbHl0aWNzIC0tPg0KPHNjcmlwdCBhc3luYyBzcmM9Imh0dHBzOi8vd3d3Lmdvb2dsZXRhZ21hbmFnZXIuY29tL2d0YWcvanM/aWQ9VUEtNDMwMTc2NDctMSI+PC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICB3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsNCiAgZnVuY3Rpb24gZ3RhZygpe2RhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7fQ0KICBndGFnKCdqcycsIG5ldyBEYXRlKCkpOw0KICBndGFnKCdjb25maWcnLCAnVUEtNDMwMTc2NDctMScpOw0KPC9zY3JpcHQ+CjwhLS0gV1AgQXVkaW8gcGxheWVyIHBsdWdpbiB2MS45LjYgLSBodHRwczovL3d3dy50aXBzYW5kdHJpY2tzLWhxLmNvbS93b3JkcHJlc3MtYXVkaW8tbXVzaWMtcGxheWVyLXBsdWdpbi00NTU2LyAtLT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICAgICAgc291bmRNYW5hZ2VyLnVzZUZsYXNoQmxvY2sgPSB0cnVlOyAvLyBvcHRpb25hbCAtIGlmIHVzZWQsIHJlcXVpcmVkIGZsYXNoYmxvY2suY3NzDQogICAgICAgIHNvdW5kTWFuYWdlci51cmwgPSAnaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9zd2Yvc291bmRtYW5hZ2VyMi5zd2YnOw0KICAgICAgICBmdW5jdGlvbiBwbGF5X21wMyhmbGcsIGlkcywgbXAzdXJsLCB2b2x1bWUsIGxvb3BzKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL0NoZWNrIHRoZSBmaWxlIFVSTCBwYXJhbWV0ZXIgdmFsdWUNCiAgICAgICAgICAgIHZhciBwaWVjZXMgPSBtcDN1cmwuc3BsaXQoInwiKTsNCiAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMSkgey8vV2UgaGF2ZSBnb3QgYW4gLm9nZyBmaWxlIHRvbw0KICAgICAgICAgICAgICAgIG1wM2ZpbGUgPSBwaWVjZXNbMF07DQogICAgICAgICAgICAgICAgb2dnZmlsZSA9IHBpZWNlc1sxXTsNCiAgICAgICAgICAgICAgICAvL3NldCB0aGUgZmlsZSBVUkwgdG8gYmUgYW4gYXJyYXkgd2l0aCB0aGUgbXAzIGFuZCBvZ2cgZmlsZQ0KICAgICAgICAgICAgICAgIG1wM3VybCA9IG5ldyBBcnJheShtcDNmaWxlLCBvZ2dmaWxlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLmNyZWF0ZVNvdW5kKHsNCiAgICAgICAgICAgICAgICBpZDogJ2J0bnBsYXlfJyArIGlkcywNCiAgICAgICAgICAgICAgICB2b2x1bWU6IHZvbHVtZSwNCiAgICAgICAgICAgICAgICB1cmw6IG1wM3VybA0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGlmIChmbGcgPT0gJ3BsYXknKSB7DQogICAgICAgICAgICAgICAgICAgIHNvdW5kTWFuYWdlci5wbGF5KCdidG5wbGF5XycgKyBpZHMsIHsNCiAgICAgICAgICAgICAgICAgICAgb25maW5pc2g6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvb3BzID09ICd0cnVlJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZCgnYnRucGxheV8nICsgaWRzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuc3RvcF8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChmbGcgPT0gJ3N0b3AnKSB7DQogICAgLy9zb3VuZE1hbmFnZXIuc3RvcCgnYnRucGxheV8nK2lkcyk7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBhdXNlKCdidG5wbGF5XycgKyBpZHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIHNob3dfaGlkZShmbGFnLCBpZHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChmbGFnID09ICdwbGF5Jykgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoZmxhZyA9PSAnc3RvcCcpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRucGxheV8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmdW5jdGlvbiBsb29wU291bmQoc291bmRJRCkNCiAgICAgICAgew0KICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBsYXkoc291bmRJRCwge29uZmluaXNoOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZChzb3VuZElEKTsNCiAgICAgICAgICAgICAgICAgICAgfX0pOw0KICAgICAgICAgICAgfSwgMSk7DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gc3RvcF9hbGxfdHJhY2tzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLnN0b3BBbGwoKTsNCiAgICAgICAgICAgIHZhciBpbnB1dHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5wbGF5XyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsvL1RvZ2dsZSB0aGUgcGxheSBidXR0b24NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5zdG9wXyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Ly9IaWRlIHRoZSBzdG9wIGJ1dHRvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9mcm9udGVuZC1idWlsZGVyLWdsb2JhbC1mdW5jdGlvbnMuanM/dmVyPTIuNS4zJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvY3VzdG9tLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9qcXVlcnkuZml0dmlkcy5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvd2F5cG9pbnRzLm1pbi5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvanF1ZXJ5Lm1hZ25pZmljLXBvcHVwLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBldF9jdXN0b20gPSB7ImFqYXh1cmwiOiJodHRwczpcL1wvYmxvZy5pYmlyZW1lLmNvbVwvd3AtYWRtaW5cL2FkbWluLWFqYXgucGhwIiwiaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2ltYWdlcyIsImJ1aWxkZXJfaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2luY2x1ZGVzXC9idWlsZGVyXC9pbWFnZXMiLCJldF9sb2FkX25vbmNlIjoiZGM4NmFmOTNlMiIsInN1YnNjcmlwdGlvbl9mYWlsZWQiOiJQbGVhc2UsIGNoZWNrIHRoZSBmaWVsZHMgYmVsb3cgdG8gbWFrZSBzdXJlIHlvdSBlbnRlcmVkIHRoZSBjb3JyZWN0IGluZm9ybWF0aW9uLiIsImZpbGwiOiJGaWxsIiwiZmllbGQiOiJmaWVsZCIsImludmFsaWQiOiJJbnZhbGlkIGVtYWlsIiwiY2FwdGNoYSI6IkNhcHRjaGEiLCJwcmV2IjoiUHJldiIsInByZXZpb3VzIjoiXHU0ZTBhXHU0ZTAwXHU5ODc1IiwibmV4dCI6Ilx1NGUwYlx1NGUwMFx1OTg3NSIsImlzX2J1aWxkZXJfcGx1Z2luX3VzZWQiOiIifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvZnJvbnRlbmQtYnVpbGRlci1zY3JpcHRzLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy93cC1lbWJlZC5taW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==" srcset="/img/loading.gif" lazyload></p>
<p>其中，在硬件层上面的三个组成部分：Mach、BSD、IOKit (还包括一些上面没标注的内容)，共同组成了 XNU 内核。<br>XNU 内核的内环被称作 Mach，其作为一个微内核，仅提供了诸如处理器调度、IPC (进程间通信) 等非常少量的基础服务。<br>BSD 层可以看作围绕 Mach 层的一个外环，其提供了诸如进程管理、文件系统和网络等功能。<br>IOKit 层是为设备驱动提供了一个面向对象 (C++) 的一个框架。</p>
<p>Mach 本身提供的 API 非常有限，而且苹果也不鼓励使用 Mach 的 API，但是这些 API 非常基础，如果没有这些 API 的话，其他任何工作都无法实施。在 Mach 中，所有的东西都是通过自己的对象实现的，进程、线程和虚拟内存都被称为 “对象”。和其他架构不同， Mach 的对象间不能直接调用，只能通过消息传递的方式实现对象间的通信。”消息” 是 Mach 中最基础的概念，消息在两个端口 (port) 之间传递，这就是 Mach 的 IPC (进程间通信) 的核心。</p>
<p>Mach 的消息定义是在 &lt;mach/message.h&gt; 头文件的，很简单：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>  <span class="hljs-keyword">mach_msg_header_t</span> header;<br>  <span class="hljs-keyword">mach_msg_body_t</span> body;<br>&#125; <span class="hljs-keyword">mach_msg_base_t</span>;<br> <br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>  <span class="hljs-keyword">mach_msg_bits_t</span> msgh_bits;<br>  <span class="hljs-keyword">mach_msg_size_t</span> msgh_size;<br>  <span class="hljs-keyword">mach_port_t</span> msgh_remote_port;<br>  <span class="hljs-keyword">mach_port_t</span> msgh_local_port;<br>  <span class="hljs-keyword">mach_port_name_t</span> msgh_voucher_port;<br>  <span class="hljs-keyword">mach_msg_id_t</span> msgh_id;<br>&#125; <span class="hljs-keyword">mach_msg_header_t</span>;<br></code></pre></td></tr></table></figure>


<p>一条 Mach 消息实际上就是一个二进制数据包 (BLOB)，其头部定义了当前端口 local_port 和目标端口 remote_port，<br>发送和接受消息是通过同一个 API 进行的，其 option 标记了消息传递的方向：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">mach_msg_return_t</span> <span class="hljs-title">mach_msg</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-keyword">mach_msg_header_t</span> *msg,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-keyword">mach_msg_option_t</span> option,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-keyword">mach_msg_size_t</span> send_size,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-keyword">mach_msg_size_t</span> rcv_size,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-keyword">mach_port_name_t</span> rcv_name,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-keyword">mach_msg_timeout_t</span> timeout,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-keyword">mach_port_name_t</span> notify)</span></span>;<br></code></pre></td></tr></table></figure>


<p>为了实现消息的发送和接收，mach_msg() 函数实际上是调用了一个 Mach 陷阱 (trap)，即函数 mach_msg_trap()，陷阱这个概念在 Mach 中等同于系统调用。当你在用户态调用 mach_msg_trap() 时会触发陷阱机制，切换到内核态；内核态中内核实现的 mach_msg() 函数会完成实际的工作，如下图：<br>[<img src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+DQo8IS0tW2lmIElFIDZdPg0KPGh0bWwgaWQ9ImllNiIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDddPg0KPGh0bWwgaWQ9ImllNyIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDhdPg0KPGh0bWwgaWQ9ImllOCIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmICEoSUUgNikgfCAhKElFIDcpIHwgIShJRSA4KSAgXT48IS0tPg0KPGh0bWwgbGFuZz0iemgtQ04iPg0KPCEtLTwhW2VuZGlmXS0tPg0KPGhlYWQ+DQoJPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+DQoJPHRpdGxlPjQwNCDmnKrmib7liLAgfCBHYXJhbiBubyBkb3U8L3RpdGxlPg0KCQkJDQoJDQoJPGxpbmsgcmVsPSJwaW5nYmFjayIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3htbHJwYy5waHAiIC8+DQoNCgkJPCEtLVtpZiBsdCBJRSA5XT4NCgk8c2NyaXB0IHNyYz0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvaHRtbDUuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQoJPCFbZW5kaWZdLS0+DQoNCgk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUgPSAnanMnOw0KCTwvc2NyaXB0Pg0KDQoJPGxpbmsgcmVsPSdkbnMtcHJlZmV0Y2gnIGhyZWY9Jy8vZm9udHMuZ29vZ2xlYXBpcy5jb20nIC8+CjxsaW5rIHJlbD0nZG5zLXByZWZldGNoJyBocmVmPScvL3Mudy5vcmcnIC8+CjxsaW5rIHJlbD0iYWx0ZXJuYXRlIiB0eXBlPSJhcHBsaWNhdGlvbi9yc3MreG1sIiB0aXRsZT0iR2FyYW4gbm8gZG91ICZyYXF1bzsgRmVlZCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2ZlZWQvIiAvPgo8bGluayByZWw9ImFsdGVybmF0ZSIgdHlwZT0iYXBwbGljYXRpb24vcnNzK3htbCIgdGl0bGU9IkdhcmFuIG5vIGRvdSAmcmFxdW87IOivhOiuukZlZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jb21tZW50cy9mZWVkLyIgLz4KPG1ldGEgY29udGVudD0iRGl2aSB2LjIuNS4zIiBuYW1lPSJnZW5lcmF0b3IiLz48bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdzY2FwLmZsYXNoYmxvY2stY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvZmxhc2hibG9jay5jc3M/dmVyPTUuNC42JyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nc2NhcC5wbGF5ZXItY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvcGxheWVyLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdjcmF5b24tY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jcmF5b24tc3ludGF4LWhpZ2hsaWdodGVyL2Nzcy9taW4vY3JheW9uLm1pbi5jc3M/dmVyPV8yLjcuMl9iZXRhJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nd3AtZWFzeWFyY2hpdmVzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3BsdWdpbnMvd3AtZWFzeWFyY2hpdmVzL2Nzcy93cC1lYXN5YXJjaGl2ZXMuY3NzP3Zlcj0zLjEuMicgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdzY3JlZW4nIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J3dwLWJsb2NrLWxpYnJhcnktY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2Nzcy9kaXN0L2Jsb2NrLWxpYnJhcnkvc3R5bGUubWluLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdtYXRoLWNhcHRjaGEtZnJvbnRlbmQtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy93cC1tYXRoLWNhcHRjaGEvY3NzL2Zyb250ZW5kLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSd3cC1wYWdlbmF2aS1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3dwLXBhZ2VuYXZpL3BhZ2VuYXZpLWNzcy5jc3M/dmVyPTIuNzAnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdkaXZpLWZvbnRzLWNzcycgIGhyZWY9J2h0dHBzOi8vZm9udHMubG9saS5uZXQvY3NzP2ZhbWlseT1PcGVuK1NhbnM6MzAwaXRhbGljLDQwMGl0YWxpYyw2MDBpdGFsaWMsNzAwaXRhbGljLDgwMGl0YWxpYyw0MDAsMzAwLDYwMCw3MDAsODAwJiMwMzg7c3Vic2V0PWxhdGluLGxhdGluLWV4dCcgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LWdmLWNoaW5lc2UtY3NzJyAgaHJlZj0nLy9mb250cy5sb2xpLm5ldC9lYXJseWFjY2Vzcy9jd3RleGZhbmdzb25nLmNzcycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2Rpdmktc3R5bGUtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0Rpdmkvc3R5bGUuY3NzP3Zlcj0yLjUuMycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LXNob3J0Y29kZXMtY3NzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2VwYW5lbC9zaG9ydGNvZGVzL2Nzcy9zaG9ydGNvZGVzLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nZXQtc2hvcnRjb2Rlcy1yZXNwb25zaXZlLWNzcy1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9lcGFuZWwvc2hvcnRjb2Rlcy9jc3Mvc2hvcnRjb2Rlc19yZXNwb25zaXZlLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9qcy9zb3VuZG1hbmFnZXIyLW5vZGVidWctanNtaW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2pzL2pxdWVyeS9qcXVlcnkuanM/dmVyPTEuMTIuNC13cCc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy9qcXVlcnkvanF1ZXJ5LW1pZ3JhdGUubWluLmpzP3Zlcj0xLjQuMSc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBDcmF5b25TeW50YXhTZXR0aW5ncyA9IHsidmVyc2lvbiI6Il8yLjcuMl9iZXRhIiwiaXNfYWRtaW4iOiIwIiwiYWpheHVybCI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1hZG1pblwvYWRtaW4tYWpheC5waHAiLCJwcmVmaXgiOiJjcmF5b24tIiwic2V0dGluZyI6ImNyYXlvbi1zZXR0aW5nIiwic2VsZWN0ZWQiOiJjcmF5b24tc2V0dGluZy1zZWxlY3RlZCIsImNoYW5nZWQiOiJjcmF5b24tc2V0dGluZy1jaGFuZ2VkIiwic3BlY2lhbCI6ImNyYXlvbi1zZXR0aW5nLXNwZWNpYWwiLCJvcmlnX3ZhbHVlIjoiZGF0YS1vcmlnLXZhbHVlIiwiZGVidWciOiIifTsKdmFyIENyYXlvblN5bnRheFN0cmluZ3MgPSB7ImNvcHkiOiJQcmVzcyAlcyB0byBDb3B5LCAlcyB0byBQYXN0ZSIsIm1pbmltaXplIjoiQ2xpY2sgVG8gRXhwYW5kIENvZGUifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL2NyYXlvbi1zeW50YXgtaGlnaGxpZ2h0ZXIvanMvbWluL2NyYXlvbi5taW4uanM/dmVyPV8yLjcuMl9iZXRhJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9zaW1wbGVzbWlsZXlzaG93L2pxdWVyeS5pbnNlcnRhdGNhcmV0LmpzJz48L3NjcmlwdD4KPGxpbmsgcmVsPSdodHRwczovL2FwaS53Lm9yZy8nIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1qc29uLycgLz4KPGxpbmsgcmVsPSJFZGl0VVJJIiB0eXBlPSJhcHBsaWNhdGlvbi9yc2QreG1sIiB0aXRsZT0iUlNEIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20veG1scnBjLnBocD9yc2QiIC8+CjxsaW5rIHJlbD0id2x3bWFuaWZlc3QiIHR5cGU9ImFwcGxpY2F0aW9uL3dsd21hbmlmZXN0K3htbCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL3dsd21hbmlmZXN0LnhtbCIgLz4gCjxtZXRhIG5hbWU9ImdlbmVyYXRvciIgY29udGVudD0iV29yZFByZXNzIDUuNC42IiAvPgoKPCEtLSBHZW5lcmF0ZWQgQnkgU2hvdy1Vc2VyQWdlbnQgMS4wLjggLSBodHRwOi8vemx6LmltL3Nob3ctdXNlcmFnZW50LyAtLT4KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3Nob3ctdXNlcmFnZW50L3Nob3ctdXNlcmFnZW50LmNzcyIgdHlwZT0idGV4dC9jc3MiIG1lZGlhPSJzY3JlZW4iIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT0wIiAvPgkJPHN0eWxlIGlkPSJ0aGVtZS1jdXN0b21pemVyLWNzcyI+DQoJCQkJCQkJCQkJCQkJLndvb2NvbW1lcmNlICNyZXNwb25kIGlucHV0I3N1Ym1pdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LCAud29vY29tbWVyY2UgI2NvbnRlbnQgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSAjY29udGVudCBpbnB1dC5idXR0b24sIC53b29jb21tZXJjZS1tZXNzYWdlLCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1pbmZvIHsgYmFja2dyb3VuZDogI2E5ZDMwMCAhaW1wb3J0YW50OyB9DQoJCQkjZXRfc2VhcmNoX2ljb246aG92ZXIsIC5tb2JpbGVfbWVudV9iYXI6YmVmb3JlLCAuZXQtc29jaWFsLWljb24gYTpob3ZlciwgLmV0X3BiX3N1bSwgLmV0X3BiX3ByaWNpbmcgbGkgYSwgLmV0X3BiX3ByaWNpbmdfdGFibGVfYnV0dG9uLCAuZXRfb3ZlcmxheTpiZWZvcmUsIC5lbnRyeS1zdW1tYXJ5IHAucHJpY2UgaW5zLCAud29vY29tbWVyY2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UtcGFnZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLmV0X3BiX21lbWJlcl9zb2NpYWxfbGlua3MgYTpob3ZlciwgLndvb2NvbW1lcmNlIC5zdGFyLXJhdGluZyBzcGFuOmJlZm9yZSwgLndvb2NvbW1lcmNlLXBhZ2UgLnN0YXItcmF0aW5nIHNwYW46YmVmb3JlLCAuZXRfcGJfd2lkZ2V0IGxpIGE6aG92ZXIsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydGZvbGlvX2ZpbHRlcnMgbGkgYS5hY3RpdmUsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydG9mb2xpb19wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAuZXRfcGJfZ2FsbGVyeSAuZXRfcGJfZ2FsbGVyeV9wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAud3AtcGFnZW5hdmkgc3Bhbi5jdXJyZW50LCAud3AtcGFnZW5hdmkgYTpob3ZlciwgLm5hdi1zaW5nbGUgYSwgLnBvc3RlZF9pbiBhIHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCS5ldF9wYl9jb250YWN0X3N1Ym1pdCwgLmV0X3Bhc3N3b3JkX3Byb3RlY3RlZF9mb3JtIC5ldF9zdWJtaXRfYnV0dG9uLCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9uZXdzbGV0dGVyX2J1dHRvbiwgLmNvbW1lbnQtcmVwbHktbGluaywgLmZvcm0tc3VibWl0IGlucHV0LCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9wcm9tb19idXR0b24sIC5ldF9wYl9iZ19sYXlvdXRfbGlnaHQgLmV0X3BiX21vcmVfYnV0dG9uLCAud29vY29tbWVyY2UgYS5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBhLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgYnV0dG9uLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBhLmJ1dHRvbiwgLndvb2NvbW1lcmNlLXBhZ2UgYS5idXR0b24sIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24geyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmZvb3Rlci13aWRnZXQgaDQgeyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmV0LXNlYXJjaC1mb3JtLCAubmF2IGxpIHVsLCAuZXRfbW9iaWxlX21lbnUsIC5mb290ZXItd2lkZ2V0IGxpOmJlZm9yZSwgLmV0X3BiX3ByaWNpbmcgbGk6YmVmb3JlLCBibG9ja3F1b3RlIHsgYm9yZGVyLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkuZXRfcGJfY291bnRlcl9hbW91bnQsIC5ldF9wYl9mZWF0dXJlZF90YWJsZSAuZXRfcGJfcHJpY2luZ19oZWFkaW5nLCAuZXRfcXVvdGVfY29udGVudCwgLmV0X2xpbmtfY29udGVudCwgLmV0X2F1ZGlvX2NvbnRlbnQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkJCQkJLmNvbnRhaW5lciwgLmV0X3BiX3JvdywgLmV0X3BiX3NsaWRlciAuZXRfcGJfY29udGFpbmVyLCAuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24gLmV0X3BiX3RpdGxlX2NvbnRhaW5lciwgLmV0X3BiX2Z1bGx3aWR0aF9zZWN0aW9uIC5ldF9wYl90aXRsZV9mZWF0dXJlZF9jb250YWluZXIsIC5ldF9wYl9mdWxsd2lkdGhfaGVhZGVyOm5vdCguZXRfcGJfZnVsbHNjcmVlbikgLmV0X3BiX2Z1bGx3aWR0aF9oZWFkZXJfY29udGFpbmVyIHsgbWF4LXdpZHRoOiA5NjBweDsgfQ0KCQkJLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIsIC5ldF9maXhlZF9uYXYuZXRfYm94ZWRfbGF5b3V0ICNwYWdlLWNvbnRhaW5lciAjdG9wLWhlYWRlciwgLmV0X2ZpeGVkX25hdi5ldF9ib3hlZF9sYXlvdXQgI3BhZ2UtY29udGFpbmVyICNtYWluLWhlYWRlciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmNvbnRhaW5lciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmV0X3BiX3JvdyB7IG1heC13aWR0aDogMTEyMHB4OyB9DQoJCQkJCQkJYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI3RvcC1oZWFkZXIsICNldC1zZWNvbmRhcnktbmF2IGxpIHVsIHsgYmFja2dyb3VuZC1jb2xvcjogI2E5ZDMwMDsgfQ0KCQkJCQkJCQkjdG9wLWhlYWRlciwgI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQkJCQkJCQkJCQ0KCQkNCgkJCQkJI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX3JlZCAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9yZWQgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfcGluayAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9waW5rICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX29yYW5nZSAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9vcmFuZ2UgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsIC5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI21haW4tZm9vdGVyIC5mb290ZXItd2lkZ2V0IGg0IHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkuZm9vdGVyLXdpZGdldCBsaTpiZWZvcmUgeyBib3JkZXItY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkNCgkJDQoJCQ0KCQlAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWluLXdpZHRoOiA5ODFweCApIHsNCgkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIsIC5ldC1maXhlZC1oZWFkZXIjdG9wLWhlYWRlciAjZXQtc2Vjb25kYXJ5LW5hdiBsaSB1bCB7IGJhY2tncm91bmQtY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtYW5jZXN0b3IgPiBhLA0KCQkJCS5ldC1maXhlZC1oZWFkZXIgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjICFpbXBvcnRhbnQ7IH0NCgkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQ0KCQkJCQl9DQoJCUBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKCBtaW4td2lkdGg6IDEyMDBweCkgew0KCQkJLmV0X3BiX3JvdyB7IHBhZGRpbmc6IDI0cHggMDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24geyBwYWRkaW5nOiA0OHB4IDA7IH0NCgkJCS5zaW5nbGUuZXRfcGJfcGFnZWJ1aWxkZXJfbGF5b3V0LmV0X2Z1bGxfd2lkdGhfcGFnZSAuZXRfcG9zdF9tZXRhX3dyYXBwZXIgeyBwYWRkaW5nLXRvcDogNzJweDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24uZXRfcGJfc2VjdGlvbl9maXJzdCB7IHBhZGRpbmctdG9wOiBpbmhlcml0OyB9DQoJCQkuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24geyBwYWRkaW5nOiAwOyB9DQoJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogOTgwcHggKSB7DQoJCQkJCQkJCQkJCQkJCQkJCQkJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogNzY3cHggKSB7DQoJCQkJCQkJCQkJCQkJCX0NCgk8L3N0eWxlPg0KDQoJPHN0eWxlIGNsYXNzPSJldF9vbmVfZm9udF9sYW5ndWFnZXMiPmgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGJvZHksIGlucHV0LCB0ZXh0YXJlYSwgc2VsZWN0IHsgZm9udC1mYW1pbHk6ICdjd1RlWEZhbmdTb25nJywgc2VyaWY7IH08L3N0eWxlPg0KCQ0KCTxzdHlsZSBpZD0ibW9kdWxlLWN1c3RvbWl6ZXItY3NzIj4NCgkJCTwvc3R5bGU+DQoNCgk8IS0tIEFsbCBpbiBvbmUgRmF2aWNvbiA0LjcgLS0+PGxpbmsgcmVsPSJpY29uIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTMvMDgvZmF2aWNvbi5wbmciIHR5cGU9ImltYWdlL3BuZyIvPgo8bGluayByZWw9ImFwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxMy8wOC9mYXZpY29uMi5wbmciIC8+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyIgaWQ9ImV0LWN1c3RvbS1jc3MiPgpoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBib2R5LCBpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCB7DQpmb250LWZhbWlseTogJ1BpbmdGYW5nIFNDJywgJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgVmVyZGFuYSwgJ0hpcmFnaW5vIFNhbnMgR0InLCAnTm90byBTYW5zIENKSyBTQycsICdTb3VyY2UgSGFuIFNhbnMgQ04nLCBTVEhlaXRpLCAnTWljcm9zb2Z0IFlhSGVpJywgJ1dlblF1YW5ZaSBNaWNybyBIZWknLCBTaW1TdW4sIHNhbnMtc2VyaWY7DQpmb250LXdlaWdodDogNDAwOw0KfQ0KDQojbWFpbi1oZWFkZXIgew0KICAgIGJhY2tncm91bmQ6IGhzbGEoMCwgMCUsIDEwMCUsIC44NSk7DQogICAgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTJweCk7DQogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEycHgpOw0KfQ0KDQpib2R5IHsgDQoJZm9udC1zaXplOiAxNnB4Ow0KCWNvbG9yOiAjMWQxZDFkOw0KCXdvcmQtd3JhcDpicmVhay13b3JkOw0KCXdvcmQtYnJlYWs6IG5vcm1hbDsNCn0NCg0KcCB7DQoJbWFyZ2luOiAwLjllbSAwIDAuNWVtOw0KCXBhZGRpbmctYm90dG9tOiAwLjZlbTsNCglmb250LXNpemU6IDEwMCU7DQoJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOw0KfQ0KDQouZXRfcGJfcG9zdCBoMiB7DQoJZm9udC13ZWlnaHQ6IGJvbGQ7DQp9DQoNCi5ldF9wYl9wb3N0IC5wb3N0LW1ldGEgew0KCTE0cHggIkNsYXNzaWMgR3JvdGVzcXVlIFcwMSIsIEFyaWFsLCBzYW5zLXNlcmlmOw0KfQ0KDQouZXRfcGJfcG9zdCB7DQoJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlMmUyZTI7DQoJcGFkZGluZy1ib3R0b206IDIwcHg7DQp9DQoNCi5ldF9wYl9wb3N0Omxhc3Qtb2YtdHlwZSB7DQoJYm9yZGVyLWJvdHRvbTogMHB4IHNvbGlkICNlMmUyZTI7DQp9DQoNCiNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB7DQoJcGFkZGluZy10b3A6IDMwcHg7DQp9DQoNCi5ldF9yaWdodF9zaWRlYmFyICNzaWRlYmFyIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmhvbWUgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMHB4Ow0KfQ0KDQouc2luZ2xlLXBvc3QgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmV0X3BiX3Bvc3Qgew0KICBtYXJnaW4tYm90dG9tOiA0MHB4Ow0KfQ0KDQouZXRfcGJfcG9zdCAuZW50cnktY29udGVudCwgDQoucHJvamVjdCAuZW50cnktY29udGVudCB7DQogIHBhZGRpbmctdG9wOiAxMHB4Ow0KfQ0KDQoud2lkZ2V0X2Fib3V0bWV3aWRnZXQgLmNsZWFyZml4LA0KLmV0X3BiX3dpZGdldCBsaSB7DQoJZm9udC1zaXplOiA5MyU7DQp9DQoNCi53aWRnZXR0aXRsZSB7DQoJZm9udC1zaXplOiAxMjAlOw0KfQ0KDQouZXRfcGJfc2Nyb2xsX3RvcCB7DQogICAgYm90dG9tOiAxNXB4Ow0KfQ0KDQojdG9wLW1lbnUgbGkgPiBhLCANCi5mdWxsd2lkdGgtbWVudSBsaSA+IGEgew0KCWZvbnQtc2l6ZTogMTRweDsNCglmb250LXdlaWdodDogNDAwOw0KfQ0KDQojZm9vdGVyLWJvdHRvbSB7DQoJcGFkZGluZzogNXB4IDAgN3B4Ow0KfQ0KDQppbWcud3Atc21pbGV5IHsNCgltYXgtaGVpZ2h0OiAxLjJlbSAhaW1wb3J0YW50Ow0KCWhlaWdodDogMS4yZW0gIWltcG9ydGFudDsNCgl3aWR0aDogMS4yZW0gIWltcG9ydGFudDsNCn0NCg0KLndwLXNtaWxleWxpbmsgew0KCW1heC13aWR0aDogMjJweCAhaW1wb3J0YW50Ow0KfQ0KDQojbGVmdC1hcmVhIGE6aG92ZXIgew0KCXRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQojY29tbWVudGZvcm0gdGV4dGFyZWEsIA0KI2NvbW1lbnRmb3JtIGlucHV0W3R5cGU9InRleHQiXSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KfQ0KDQpAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWF4LXdpZHRoOiA3NjdweCApIHsNCgkuZXRfcGJfcm93LCAuY29udGFpbmVyLCAuZXRfcGJfY29udGFpbmVyIHsgd2lkdGg6IDg1JTsgfQ0KCS5ldF9wYl9wb3N0IGgyLCAuZXRfcGJfcG9ydGZvbGlvX2l0ZW0gaDIgeyBmb250LXNpemU6IDI0cHg7IH0NCgkuY29tbWVudC1ib2R5IHsgcGFkZGluZzogMCAwIDI1cHggMTAwcHg7IH0NCn0NCg0KI2R5bmFtaWMtdG8tdG9wIHsNCglkaXNwbGF5Om5vbmU7DQoJb3ZlcmZsb3c6aGlkZGVuOw0KCXdpZHRoOmF1dG87DQoJei1pbmRleDo5MDsNCglwb3NpdGlvbjpmaXhlZDsNCgl0b3A6YXV0bzsNCglsZWZ0OmF1dG87DQoJZm9udC1mYW1pbHk6c2Fucy1zZXJpZjsNCglmb250LXNpemU6MWVtOw0KCWNvbG9yOiNmZmY7DQoJdGV4dC1kZWNvcmF0aW9uOm5vbmU7DQoJdGV4dC1zaGFkb3c6MCAxcHggMCAjMzMzOw0KCWZvbnQtd2VpZ2h0OmJvbGQ7DQoJcGFkZGluZzoxN3B4IDE2cHg7DQoJYm9yZGVyOjBweCBzb2xpZCAjMDAwOw0KCWJhY2tncm91bmQ6IzExMTsNCgktd2Via2l0LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktbW96LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktaWNhYi1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJLWtodG1sLWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktby1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJYmFja2dyb3VuZC1vcmlnaW46Ym9yZGVyOw0KCS13ZWJraXQtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1tb3otYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1pY2FiLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgkta2h0bWwtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1vLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgliYWNrZ3JvdW5kLWNsaXA6cGFkZGluZy1ib3g7DQoJLXdlYmtpdC1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktbXMtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLW1vei1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktby1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgkta2h0bWwtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLWljYWItYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLXdlYmtpdC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLW1vei1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLWljYWItYm9yZGVyLXJhZGl1czoyM3B4Ow0KCS1raHRtbC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJYm9yZGVyLXJhZGl1czoyM3B4DQp9DQojZHluYW1pYy10by10b3A6aG92ZXIgew0KCWJhY2tncm91bmQ6IzRkNGRhYzsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1ncmFkaWVudCggbGluZWFyLCAwJSAwJSwgMCUgMTAwJSwgZnJvbSggcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSApLCB0byggcmdiYSggMCwgMCwgMCwgMCApICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1raHRtbC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tb3otbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzA4ZiAtby1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tcy1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1pY2FiLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAyNTUsIDI1NSwgMjU1LCAuMiApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWN1cnNvcjpwb2ludGVyDQp9DQojZHluYW1pYy10by10b3A6YWN0aXZlIHsNCgliYWNrZ3JvdW5kOiMxMTE7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtZ3JhZGllbnQoIGxpbmVhciwgMCUgMCUsIDAlIDEwMCUsIGZyb20oIHJnYmEoIDAsIDAsIDAsIC4zICkgKSwgdG8oIHJnYmEoIDAsIDAsIDAsIDAgKSApICk7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbW96LWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLWtodG1sLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLW8tbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbXMtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtaWNhYi1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMCwgMCwgMCwgLjEgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMTExIGxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKQ0KfQ0KI2R5bmFtaWMtdG8tdG9wLCNkeW5hbWljLXRvLXRvcDphY3RpdmUsI2R5bmFtaWMtdG8tdG9wOmZvY3VzLCNkeW5hbWljLXRvLXRvcDpob3ZlciB7DQoJb3V0bGluZTpub25lDQp9DQojZHluYW1pYy10by10b3Agc3BhbiB7DQoJZGlzcGxheTpibG9jazsNCglvdmVyZmxvdzpoaWRkZW47DQoJd2lkdGg6MTRweDsNCgloZWlnaHQ6MTJweDsNCgliYWNrZ3JvdW5kOnVybCgvd3AtY29udGVudC9wbHVnaW5zL2R5bmFtaWMtdG8tdG9wL2Nzcy9pbWFnZXMvdXAucG5nICluby1yZXBlYXQgY2VudGVyIGNlbnRlcg0KfQ0KDQouZW50cnktY29udGVudCB0YWJsZSwgYm9keS5ldC1wYi1wcmV2aWV3ICNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB0YWJsZSB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0MxQzFDMTsNCiAgICBsaW5lLWhlaWdodDogMS40ZW07DQoNCiAgICBib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlOw0KfQ0KDQp0aGVhZCB7DQoJYmFja2dyb3VuZC1jb2xvcjogI0YxRjFGMTsNCn0NCg0KcCNjb3B5cmlnaHQgew0KICAgIGNvbG9yOiAjNzE3MTcxOw0KfQo8L3N0eWxlPjwvaGVhZD4NCjxib2R5IGNsYXNzPSJlcnJvcjQwNCBldF9wYl9idXR0b25faGVscGVyX2NsYXNzIGV0X2ZpeGVkX25hdiBldF9zaG93X25hdiBldF9jb3Zlcl9iYWNrZ3JvdW5kIGV0X3BiX2d1dHRlciBvc3ggZXRfcGJfZ3V0dGVyczMgZXRfcHJpbWFyeV9uYXZfZHJvcGRvd25fYW5pbWF0aW9uX2ZhZGUgZXRfc2Vjb25kYXJ5X25hdl9kcm9wZG93bl9hbmltYXRpb25fZmFkZSBldF9wYl9mb290ZXJfY29sdW1uczQgZXRfaGVhZGVyX3N0eWxlX2xlZnQgZXRfcmlnaHRfc2lkZWJhciBjaHJvbWUiPg0KCTxkaXYgaWQ9InBhZ2UtY29udGFpbmVyIj4NCg0KCQ0KCQk8aGVhZGVyIGlkPSJtYWluLWhlYWRlciIgZGF0YS1oZWlnaHQtb25sb2FkPSI2NiI+DQoJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgY2xlYXJmaXggZXRfbWVudV9jb250YWluZXIiPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImxvZ29fY29udGFpbmVyIj4NCgkJCQkJPHNwYW4gY2xhc3M9ImxvZ29faGVscGVyIj48L3NwYW4+DQoJCQkJCTxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQkJPGltZyBzcmM9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxNS8wNS9sb2dvMS5wbmciIGFsdD0iR2FyYW4gbm8gZG91IiBpZD0ibG9nbyIgZGF0YS1oZWlnaHQtcGVyY2VudGFnZT0iNTQiIC8+DQoJCQkJCTwvYT4NCgkJCQk8L2Rpdj4NCgkJCQk8ZGl2IGlkPSJldC10b3AtbmF2aWdhdGlvbiIgZGF0YS1oZWlnaHQ9IjY2IiBkYXRhLWZpeGVkLWhlaWdodD0iNDAiPg0KCQkJCQk8bmF2IGlkPSJ0b3AtbWVudS1uYXYiPg0KCQkJCQkJCQkJCQk8dWwgaWQ9InRvcC1tZW51IiBjbGFzcz0ibmF2Ij4NCgkJCQkJCQkJCQkJCQkJCTxsaSA+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tLyI+6aaW6aG1PC9hPjwvbGk+DQoJCQkJCQkJDQoJCQkJCQkJPGxpIGNsYXNzPSJwYWdlX2l0ZW0gcGFnZS1pdGVtLTM0Ij48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vYWJvdXQvIj5BYm91dDwvYT48L2xpPgo8bGkgY2xhc3M9InBhZ2VfaXRlbSBwYWdlLWl0ZW0tNDE1MDIiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9hcmNoaXZlLyI+QXJjaGl2ZTwvYT48L2xpPgoJCQkJCQkJCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2FjZy8iPkFDRzwvYT4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMSI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L290aGVyLyI+5YW25LuWPC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2NoaXJydXAvIj7lkJDmp708L2E+CjwvbGk+Cgk8bGkgY2xhc3M9ImNhdC1pdGVtIGNhdC1pdGVtLTExIj48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vY2F0ZWdvcnkvdGVjLyI+5oqA5pyvPC9hPgo8dWwgY2xhc3M9J2NoaWxkcmVuJz4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMzAiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jYXRlZ29yeS90ZWMvaW9zLXRlYy8iPmlPUzwvYT4KPC9saT4KPC91bD4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNyI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2RhaWx5LyI+5pel5bi4PC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMiI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2Rlc2lnbi8iPuiuvuiuoTwvYT4KPC9saT4KCQkJCQkJPC91bD4NCgkJCQkJCQkJCQk8L25hdj4NCg0KCQkJCQkNCgkJCQkJDQoJCQkJCTxkaXYgaWQ9ImV0X21vYmlsZV9uYXZfbWVudSI+DQoJCQk8ZGl2IGNsYXNzPSJtb2JpbGVfbmF2IGNsb3NlZCI+DQoJCQkJPHNwYW4gY2xhc3M9InNlbGVjdF9wYWdlIj7pgInmi6npobXpnaI8L3NwYW4+DQoJCQkJPHNwYW4gY2xhc3M9Im1vYmlsZV9tZW51X2JhciI+PC9zcGFuPg0KCQkJPC9kaXY+DQoJCTwvZGl2PgkJCQk8L2Rpdj4gPCEtLSAjZXQtdG9wLW5hdmlnYXRpb24gLS0+DQoJCQk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KCQkJPGRpdiBjbGFzcz0iZXRfc2VhcmNoX291dGVyIj4NCgkJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgZXRfc2VhcmNoX2Zvcm1fY29udGFpbmVyIj4NCgkJCQkJPGZvcm0gcm9sZT0ic2VhcmNoIiBtZXRob2Q9ImdldCIgY2xhc3M9ImV0LXNlYXJjaC1mb3JtIiBhY3Rpb249Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQk8aW5wdXQgdHlwZT0ic2VhcmNoIiBjbGFzcz0iZXQtc2VhcmNoLWZpZWxkIiBwbGFjZWhvbGRlcj0i5pCc57SiICZoZWxsaXA7IiB2YWx1ZT0iIiBuYW1lPSJzIiB0aXRsZT0i5pCc57Si77yaIiAvPgkJCQkJPC9mb3JtPg0KCQkJCQk8c3BhbiBjbGFzcz0iZXRfY2xvc2Vfc2VhcmNoX2ZpZWxkIj48L3NwYW4+DQoJCQkJPC9kaXY+DQoJCQk8L2Rpdj4NCgkJPC9oZWFkZXI+IDwhLS0gI21haW4taGVhZGVyIC0tPg0KDQoJCTxkaXYgaWQ9ImV0LW1haW4tYXJlYSI+DQo8ZGl2IGlkPSJtYWluLWNvbnRlbnQiPg0KCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQoJCTxkaXYgaWQ9ImNvbnRlbnQtYXJlYSIgY2xhc3M9ImNsZWFyZml4Ij4NCgkJCTxkaXYgaWQ9ImxlZnQtYXJlYSI+DQoJCQkJPGFydGljbGUgaWQ9InBvc3QtMCIgY2xhc3M9ImV0X3BiX3Bvc3Qgbm90X2ZvdW5kIj4NCgkJCQkJPGRpdiBjbGFzcz0iZW50cnkiPg0KPCEtLUlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+DQoJPGgxPuacquaJvuWIsOe7k+aenDwvaDE+DQoJPHA+5oKo6K+35rGC55qE6aG16Z2i5peg5rOV5om+5Yiw44CC5bCd6K+V57K+56Gu5oKo55qE5pCc57Si77yM5oiW6ICF5L2/55So5LiK6Z2i55qE5a+86Iiq5a6a5L2N5paH56ug44CCPC9wPg0KPC9kaXY+DQo8IS0tRW5kIGlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+CQkJCTwvYXJ0aWNsZT4gPCEtLSAuZXRfcGJfcG9zdCAtLT4NCgkJCTwvZGl2PiA8IS0tICNsZWZ0LWFyZWEgLS0+DQoNCgkJCQk8ZGl2IGlkPSJzaWRlYmFyIj4NCgkJPGRpdiBpZD0iYWJvdXRtZXdpZGdldC01IiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF9hYm91dG1ld2lkZ2V0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7lhbPkuo48L2g0PgkJPGRpdiBjbGFzcz0iY2xlYXJmaXgiPg0KCQkJPGltZyBzcmM9IiIgaWQ9ImFib3V0LWltYWdlIiBhbHQ9IiIgLz4NCgkJCeS8veiTneS5i+WgguKAlOKAlDxiciAvPuS4gOWPqumtlOazleW4iOeahOW3peWdigkJPC9kaXY+IDwhLS0gZW5kIGFib3V0IG1lIHNlY3Rpb24gLS0+DQoJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+PGRpdiBpZD0idGV4dC0yIiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF90ZXh0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7nm7jlhbPpk77mjqU8L2g0PgkJCTxkaXYgY2xhc3M9InRleHR3aWRnZXQiPjx1bD4KPGxpPjxhIGhyZWY9Imh0dHA6Ly9naXRodWIuY29tL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5HaXRodWI8L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHA6Ly93ZWliby5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+V2VpYm88L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+VHdpdHRlcjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5MaW5rZWRJbjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cDovL2liaXJlbWUuZGV2aWFudGFydC5jb20vIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5EZXZpYW50QVJUPC9hPjwvbGk+CjwvdWw+CjwvZGl2PgoJCTwvZGl2PiA8IS0tIGVuZCAuZXRfcGJfd2lkZ2V0IC0tPjxkaXYgaWQ9Im1ldGEtMiIgY2xhc3M9ImV0X3BiX3dpZGdldCB3aWRnZXRfbWV0YSI+PGg0IGNsYXNzPSJ3aWRnZXR0aXRsZSI+5Yqf6IO9PC9oND4JCQk8dWw+CgkJCQkJCTxsaT48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtbG9naW4ucGhwIj7nmbvlvZU8L2E+PC9saT4KCQkJPGxpPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9mZWVkLyI+5p2h55uuZmVlZDwvYT48L2xpPgoJCQk8bGk+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NvbW1lbnRzL2ZlZWQvIj7or4TorrpmZWVkPC9hPjwvbGk+CgkJCTxsaT48YSBocmVmPSJodHRwczovL2NuLndvcmRwcmVzcy5vcmcvIj5Xb3JkUHJlc3Mub3JnPC9hPjwvbGk+CQkJPC91bD4KCQkJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+CTwvZGl2PiA8IS0tIGVuZCAjc2lkZWJhciAtLT4NCgkJPC9kaXY+IDwhLS0gI2NvbnRlbnQtYXJlYSAtLT4NCgk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KPC9kaXY+IDwhLS0gI21haW4tY29udGVudCAtLT4NCg0KCgkJCTxmb290ZXIgaWQ9Im1haW4tZm9vdGVyIj4KCQkJCQoKCQkKCQkJCTxkaXYgaWQ9ImZvb3Rlci1ib3R0b20iPgoJCQkJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciBjbGVhcmZpeCI+CgkJCQkKCQkJCQkJPHAgaWQ9ImNvcHlyaWdodCI+CgkJCQkJCQlDb3B5cmlnaHQgMjAyMSBpYmlyZW1lCgkJCQkJCTwvcD4KCQkJCQk8L2Rpdj4JPCEtLSAuY29udGFpbmVyIC0tPgoJCQkJPC9kaXY+CgkJCTwvZm9vdGVyPiA8IS0tICNtYWluLWZvb3RlciAtLT4KCQk8L2Rpdj4gPCEtLSAjZXQtbWFpbi1hcmVhIC0tPgoKCgk8L2Rpdj4gPCEtLSAjcGFnZS1jb250YWluZXIgLS0+CgoJPCEtLSBCYWlkdSBBbmFseXRpY3MgLS0+DQo8c2NyaXB0Pg0KdmFyIF9obXQgPSBfaG10IHx8IFtdOw0KKGZ1bmN0aW9uKCkgew0KICB2YXIgaG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgaG0uc3JjID0gImh0dHBzOi8vaG0uYmFpZHUuY29tL2htLmpzPzZmMzAwN2QzZmUxNTI0NDk4MGVmZjU4OWY5ZDc4MDYzIjsNCiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07IA0KICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGhtLCBzKTsNCn0pKCk7DQo8L3NjcmlwdD4NCg0KPCEtLSBHb29nbGUgQW5hbHl0aWNzIC0tPg0KPHNjcmlwdCBhc3luYyBzcmM9Imh0dHBzOi8vd3d3Lmdvb2dsZXRhZ21hbmFnZXIuY29tL2d0YWcvanM/aWQ9VUEtNDMwMTc2NDctMSI+PC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICB3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsNCiAgZnVuY3Rpb24gZ3RhZygpe2RhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7fQ0KICBndGFnKCdqcycsIG5ldyBEYXRlKCkpOw0KICBndGFnKCdjb25maWcnLCAnVUEtNDMwMTc2NDctMScpOw0KPC9zY3JpcHQ+CjwhLS0gV1AgQXVkaW8gcGxheWVyIHBsdWdpbiB2MS45LjYgLSBodHRwczovL3d3dy50aXBzYW5kdHJpY2tzLWhxLmNvbS93b3JkcHJlc3MtYXVkaW8tbXVzaWMtcGxheWVyLXBsdWdpbi00NTU2LyAtLT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICAgICAgc291bmRNYW5hZ2VyLnVzZUZsYXNoQmxvY2sgPSB0cnVlOyAvLyBvcHRpb25hbCAtIGlmIHVzZWQsIHJlcXVpcmVkIGZsYXNoYmxvY2suY3NzDQogICAgICAgIHNvdW5kTWFuYWdlci51cmwgPSAnaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9zd2Yvc291bmRtYW5hZ2VyMi5zd2YnOw0KICAgICAgICBmdW5jdGlvbiBwbGF5X21wMyhmbGcsIGlkcywgbXAzdXJsLCB2b2x1bWUsIGxvb3BzKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL0NoZWNrIHRoZSBmaWxlIFVSTCBwYXJhbWV0ZXIgdmFsdWUNCiAgICAgICAgICAgIHZhciBwaWVjZXMgPSBtcDN1cmwuc3BsaXQoInwiKTsNCiAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMSkgey8vV2UgaGF2ZSBnb3QgYW4gLm9nZyBmaWxlIHRvbw0KICAgICAgICAgICAgICAgIG1wM2ZpbGUgPSBwaWVjZXNbMF07DQogICAgICAgICAgICAgICAgb2dnZmlsZSA9IHBpZWNlc1sxXTsNCiAgICAgICAgICAgICAgICAvL3NldCB0aGUgZmlsZSBVUkwgdG8gYmUgYW4gYXJyYXkgd2l0aCB0aGUgbXAzIGFuZCBvZ2cgZmlsZQ0KICAgICAgICAgICAgICAgIG1wM3VybCA9IG5ldyBBcnJheShtcDNmaWxlLCBvZ2dmaWxlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLmNyZWF0ZVNvdW5kKHsNCiAgICAgICAgICAgICAgICBpZDogJ2J0bnBsYXlfJyArIGlkcywNCiAgICAgICAgICAgICAgICB2b2x1bWU6IHZvbHVtZSwNCiAgICAgICAgICAgICAgICB1cmw6IG1wM3VybA0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGlmIChmbGcgPT0gJ3BsYXknKSB7DQogICAgICAgICAgICAgICAgICAgIHNvdW5kTWFuYWdlci5wbGF5KCdidG5wbGF5XycgKyBpZHMsIHsNCiAgICAgICAgICAgICAgICAgICAgb25maW5pc2g6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvb3BzID09ICd0cnVlJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZCgnYnRucGxheV8nICsgaWRzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuc3RvcF8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChmbGcgPT0gJ3N0b3AnKSB7DQogICAgLy9zb3VuZE1hbmFnZXIuc3RvcCgnYnRucGxheV8nK2lkcyk7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBhdXNlKCdidG5wbGF5XycgKyBpZHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIHNob3dfaGlkZShmbGFnLCBpZHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChmbGFnID09ICdwbGF5Jykgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoZmxhZyA9PSAnc3RvcCcpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRucGxheV8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmdW5jdGlvbiBsb29wU291bmQoc291bmRJRCkNCiAgICAgICAgew0KICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBsYXkoc291bmRJRCwge29uZmluaXNoOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZChzb3VuZElEKTsNCiAgICAgICAgICAgICAgICAgICAgfX0pOw0KICAgICAgICAgICAgfSwgMSk7DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gc3RvcF9hbGxfdHJhY2tzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLnN0b3BBbGwoKTsNCiAgICAgICAgICAgIHZhciBpbnB1dHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5wbGF5XyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsvL1RvZ2dsZSB0aGUgcGxheSBidXR0b24NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5zdG9wXyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Ly9IaWRlIHRoZSBzdG9wIGJ1dHRvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9mcm9udGVuZC1idWlsZGVyLWdsb2JhbC1mdW5jdGlvbnMuanM/dmVyPTIuNS4zJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvY3VzdG9tLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9qcXVlcnkuZml0dmlkcy5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvd2F5cG9pbnRzLm1pbi5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvanF1ZXJ5Lm1hZ25pZmljLXBvcHVwLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBldF9jdXN0b20gPSB7ImFqYXh1cmwiOiJodHRwczpcL1wvYmxvZy5pYmlyZW1lLmNvbVwvd3AtYWRtaW5cL2FkbWluLWFqYXgucGhwIiwiaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2ltYWdlcyIsImJ1aWxkZXJfaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2luY2x1ZGVzXC9idWlsZGVyXC9pbWFnZXMiLCJldF9sb2FkX25vbmNlIjoiZGM4NmFmOTNlMiIsInN1YnNjcmlwdGlvbl9mYWlsZWQiOiJQbGVhc2UsIGNoZWNrIHRoZSBmaWVsZHMgYmVsb3cgdG8gbWFrZSBzdXJlIHlvdSBlbnRlcmVkIHRoZSBjb3JyZWN0IGluZm9ybWF0aW9uLiIsImZpbGwiOiJGaWxsIiwiZmllbGQiOiJmaWVsZCIsImludmFsaWQiOiJJbnZhbGlkIGVtYWlsIiwiY2FwdGNoYSI6IkNhcHRjaGEiLCJwcmV2IjoiUHJldiIsInByZXZpb3VzIjoiXHU0ZTBhXHU0ZTAwXHU5ODc1IiwibmV4dCI6Ilx1NGUwYlx1NGUwMFx1OTg3NSIsImlzX2J1aWxkZXJfcGx1Z2luX3VzZWQiOiIifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvZnJvbnRlbmQtYnVpbGRlci1zY3JpcHRzLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy93cC1lbWJlZC5taW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==" srcset="/img/loading.gif" lazyload></p>
<p>这些概念可以参考维基百科: <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/System_call">System_call</a>、<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Trap_%28computing%29">Trap_(computing)</a>。</p>
<p>RunLoop 的核心就是一个 mach_msg() (见上面代码的第 7 步)，RunLoop 调用这个函数去接收消息，如果没有别人发送 port 消息过来，内核会将线程置于等待状态。例如你在模拟器里跑起一个 iOS 的 App，然后在 App 静止时点击暂停，你会看到主线程调用栈是停留在 mach_msg_trap() 这个地方。</p>
<p>关于具体的如何利用 mach port 发送信息，可以看看 <a target="_blank" rel="noopener" href="http://nshipster.com/inter-process-communication/">NSHipster 这一篇文章</a>，或者<a target="_blank" rel="noopener" href="http://segmentfault.com/a/1190000002400329">这里</a>的中文翻译 。</p>
<p>关于 Mach 的历史可以看看这篇很有趣的文章：<a target="_blank" rel="noopener" href="http://www.programmer.com.cn/8121/">Mac OS X 背后的故事（三）Mach 之父 Avie Tevanian</a>。</p>
<h2 id="苹果用-RunLoop-实现的功能"><a href="#苹果用-RunLoop-实现的功能" class="headerlink" title="苹果用 RunLoop 实现的功能"></a>苹果用 RunLoop 实现的功能</h2><p>首先我们可以看一下 App 启动后 RunLoop 的状态：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs nix">CFRunLoop &#123;<br>    current <span class="hljs-attr">mode</span> = kCFRunLoopDefaultMode<br>    common <span class="hljs-attr">modes</span> = &#123;<br>        UITrackingRunLoopMode<br>        kCFRunLoopDefaultMode<br>    &#125;<br> <br>    common mode <span class="hljs-attr">items</span> = &#123;<br> <br>        // source0 (manual)<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> =-<span class="hljs-number">1</span>, &#123;<br>            <span class="hljs-attr">callout</span> = _UIApplicationHandleEventQueue&#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> =-<span class="hljs-number">1</span>, &#123;<br>            <span class="hljs-attr">callout</span> = PurpleEventSignalCallback &#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>, &#123;<br>            <span class="hljs-attr">callout</span> = FBSSerialQueueRunLoopSourceHandler&#125;&#125;<br> <br>        // source1 (mach port)<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>,  &#123;<span class="hljs-attr">port</span> = <span class="hljs-number">17923</span>&#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>,  &#123;<span class="hljs-attr">port</span> = <span class="hljs-number">12039</span>&#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>,  &#123;<span class="hljs-attr">port</span> = <span class="hljs-number">16647</span>&#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> =-<span class="hljs-number">1</span>, &#123;<br>            <span class="hljs-attr">callout</span> = PurpleEventCallback&#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>, &#123;<span class="hljs-attr">port</span> = <span class="hljs-number">2407</span>,<br>            <span class="hljs-attr">callout</span> = _ZL20notify_port_callbackP12__CFMachPortPvlS1_&#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>, &#123;<span class="hljs-attr">port</span> = <span class="hljs-number">1</span>c03,<br>            <span class="hljs-attr">callout</span> = __IOHIDEventSystemClientAvailabilityCallback&#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>, &#123;<span class="hljs-attr">port</span> = <span class="hljs-number">1</span>b03,<br>            <span class="hljs-attr">callout</span> = __IOHIDEventSystemClientQueueCallback&#125;&#125;<br>        CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">1</span>, &#123;<span class="hljs-attr">port</span> = <span class="hljs-number">1903</span>,<br>            <span class="hljs-attr">callout</span> = __IOMIGMachPortPortCallback&#125;&#125;<br> <br>        // Ovserver<br>        CFRunLoopObserver &#123;<span class="hljs-attr">order</span> = -<span class="hljs-number">2147483647</span>, <span class="hljs-attr">activities</span> = <span class="hljs-number">0</span>x1, // Entry<br>            <span class="hljs-attr">callout</span> = _wrapRunLoopWithAutoreleasePoolHandler&#125;<br>        CFRunLoopObserver &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>, <span class="hljs-attr">activities</span> = <span class="hljs-number">0</span>x20,          // BeforeWaiting<br>            <span class="hljs-attr">callout</span> = _UIGestureRecognizerUpdateObserver&#125;<br>        CFRunLoopObserver &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">1999000</span>, <span class="hljs-attr">activities</span> = <span class="hljs-number">0</span>xa0,    // BeforeWaiting | Exit<br>            <span class="hljs-attr">callout</span> = _afterCACommitHandler&#125;<br>        CFRunLoopObserver &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">2000000</span>, <span class="hljs-attr">activities</span> = <span class="hljs-number">0</span>xa0,    // BeforeWaiting | Exit<br>            <span class="hljs-attr">callout</span> = _ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv&#125;<br>        CFRunLoopObserver &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">2147483647</span>, <span class="hljs-attr">activities</span> = <span class="hljs-number">0</span>xa0, // BeforeWaiting | Exit<br>            <span class="hljs-attr">callout</span> = _wrapRunLoopWithAutoreleasePoolHandler&#125;<br> <br>        // Timer<br>        CFRunLoopTimer &#123;<span class="hljs-attr">firing</span> = No, <span class="hljs-attr">interval</span> = <span class="hljs-number">3.1536</span>e+<span class="hljs-number">09</span>, <span class="hljs-attr">tolerance</span> = <span class="hljs-number">0</span>,<br>            next fire <span class="hljs-attr">date</span> = <span class="hljs-number">453098071</span> (-<span class="hljs-number">4421.76019</span> @ <span class="hljs-number">96223387169499</span>),<br>            <span class="hljs-attr">callout</span> = _ZN2CAL14timer_callbackEP16__CFRunLoopTimerPv (QuartzCore.framework)&#125;<br>    &#125;,<br> <br>    modes ＝ &#123;<br>        CFRunLoopMode  &#123;<br>            <span class="hljs-attr">sources0</span> =  &#123; <span class="hljs-comment">/* same as &#x27;common mode items&#x27; */</span> &#125;,<br>            <span class="hljs-attr">sources1</span> =  &#123; <span class="hljs-comment">/* same as &#x27;common mode items&#x27; */</span> &#125;,<br>            <span class="hljs-attr">observers</span> = &#123; <span class="hljs-comment">/* same as &#x27;common mode items&#x27; */</span> &#125;,<br>            <span class="hljs-attr">timers</span> =    &#123; <span class="hljs-comment">/* same as &#x27;common mode items&#x27; */</span> &#125;,<br>        &#125;,<br> <br>        CFRunLoopMode  &#123;<br>            <span class="hljs-attr">sources0</span> =  &#123; <span class="hljs-comment">/* same as &#x27;common mode items&#x27; */</span> &#125;,<br>            <span class="hljs-attr">sources1</span> =  &#123; <span class="hljs-comment">/* same as &#x27;common mode items&#x27; */</span> &#125;,<br>            <span class="hljs-attr">observers</span> = &#123; <span class="hljs-comment">/* same as &#x27;common mode items&#x27; */</span> &#125;,<br>            <span class="hljs-attr">timers</span> =    &#123; <span class="hljs-comment">/* same as &#x27;common mode items&#x27; */</span> &#125;,<br>        &#125;,<br> <br>        CFRunLoopMode  &#123;<br>            <span class="hljs-attr">sources0</span> = &#123;<br>                CFRunLoopSource &#123;<span class="hljs-attr">order</span> = <span class="hljs-number">0</span>, &#123;<br>                    <span class="hljs-attr">callout</span> = FBSSerialQueueRunLoopSourceHandler&#125;&#125;<br>            &#125;,<br>            <span class="hljs-attr">sources1</span> = (<span class="hljs-literal">null</span>),<br>            <span class="hljs-attr">observers</span> = &#123;<br>                CFRunLoopObserver &gt;&#123;<span class="hljs-attr">activities</span> = <span class="hljs-number">0</span>xa0, <span class="hljs-attr">order</span> = <span class="hljs-number">2000000</span>,<br>                    <span class="hljs-attr">callout</span> = _ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv&#125;<br>            )&#125;,<br>            <span class="hljs-attr">timers</span> = (<span class="hljs-literal">null</span>),<br>        &#125;,<br> <br>        CFRunLoopMode  &#123;<br>            <span class="hljs-attr">sources0</span> = &#123;<br>                CFRunLoopSource &#123;<span class="hljs-attr">order</span> = -<span class="hljs-number">1</span>, &#123;<br>                    <span class="hljs-attr">callout</span> = PurpleEventSignalCallback&#125;&#125;<br>            &#125;,<br>            <span class="hljs-attr">sources1</span> = &#123;<br>                CFRunLoopSource &#123;<span class="hljs-attr">order</span> = -<span class="hljs-number">1</span>, &#123;<br>                    <span class="hljs-attr">callout</span> = PurpleEventCallback&#125;&#125;<br>            &#125;,<br>            <span class="hljs-attr">observers</span> = (<span class="hljs-literal">null</span>),<br>            <span class="hljs-attr">timers</span> = (<span class="hljs-literal">null</span>),<br>        &#125;,<br>        <br>        CFRunLoopMode  &#123;<br>            <span class="hljs-attr">sources0</span> = (<span class="hljs-literal">null</span>),<br>            <span class="hljs-attr">sources1</span> = (<span class="hljs-literal">null</span>),<br>            <span class="hljs-attr">observers</span> = (<span class="hljs-literal">null</span>),<br>            <span class="hljs-attr">timers</span> = (<span class="hljs-literal">null</span>),<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>可以看到，系统默认注册了 5 个 Mode:  </p>
<ol>
<li>kCFRunLoopDefaultMode: App 的默认 Mode，通常主线程是在这个 Mode 下运行的。  </li>
<li>UITrackingRunLoopMode: 界面跟踪 Mode，用于 ScrollView 追踪触摸滑动，保证界面滑动时不受其他 Mode 影响。  </li>
<li>UIInitializationRunLoopMode: 在刚启动 App 时第进入的第一个 Mode，启动完成后就不再使用。<br>4: GSEventReceiveRunLoopMode: 接受系统事件的内部 Mode，通常用不到。<br>5: kCFRunLoopCommonModes: 这是一个占位的 Mode，没有实际作用。</li>
</ol>
<p>你可以在<a target="_blank" rel="noopener" href="http://iphonedevwiki.net/index.php/CFRunLoop">这里</a>看到更多的苹果内部的 Mode，但那些 Mode 在开发中就很难遇到了。</p>
<p>当 RunLoop 进行回调时，一般都是通过一个很长的函数调用出去 (call out), 当你在你的代码中下断点调试时，通常能在调用栈上看到这些函数。下面是这几个函数的整理版本，如果你在调用栈中看到这些长函数名，在这里查找一下就能定位到具体的调用地点了：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&#123;<br>    <span class="hljs-comment">/// 1. 通知Observers，即将进入RunLoop</span><br>    <span class="hljs-comment">/// 此处有Observer会创建AutoreleasePool: _objc_autoreleasePoolPush();</span><br>    <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(<span class="hljs-params">kCFRunLoopEntry</span>)</span>;<br>    <span class="hljs-keyword">do</span> &#123;<br> <br>        <span class="hljs-comment">/// 2. 通知 Observers: 即将触发 Timer 回调。</span><br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(<span class="hljs-params">kCFRunLoopBeforeTimers</span>)</span>;<br>        <span class="hljs-comment">/// 3. 通知 Observers: 即将触发 Source (非基于port的,Source0) 回调。</span><br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(<span class="hljs-params">kCFRunLoopBeforeSources</span>)</span>;<br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(<span class="hljs-params">block</span>)</span>;<br> <br>        <span class="hljs-comment">/// 4. 触发 Source0 (非基于port的) 回调。</span><br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__(<span class="hljs-params">source0</span>)</span>;<br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(<span class="hljs-params">block</span>)</span>;<br> <br>        <span class="hljs-comment">/// 6. 通知Observers，即将进入休眠</span><br>        <span class="hljs-comment">/// 此处有Observer释放并新建AutoreleasePool: _objc_autoreleasePoolPop(); _objc_autoreleasePoolPush();</span><br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(<span class="hljs-params">kCFRunLoopBeforeWaiting</span>)</span>;<br> <br>        <span class="hljs-comment">/// 7. sleep to wait msg.</span><br>        mach<span class="hljs-constructor">_msg()</span> -&gt; mach<span class="hljs-constructor">_msg_trap()</span>;<br>        <br> <br>        <span class="hljs-comment">/// 8. 通知Observers，线程被唤醒</span><br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(<span class="hljs-params">kCFRunLoopAfterWaiting</span>)</span>;<br> <br>        <span class="hljs-comment">/// 9. 如果是被Timer唤醒的，回调Timer</span><br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__(<span class="hljs-params">timer</span>)</span>;<br> <br>        <span class="hljs-comment">/// 9. 如果是被dispatch唤醒的，执行所有调用 dispatch_async 等方法放入main queue 的 block</span><br>        <span class="hljs-constructor">__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(<span class="hljs-params">dispatched_block</span>)</span>;<br> <br>        <span class="hljs-comment">/// 9. 如果如果Runloop是被 Source1 (基于port的) 的事件唤醒了，处理这个事件</span><br>        <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__(<span class="hljs-params">source1</span>)</span>;<br> <br> <br>    &#125; <span class="hljs-keyword">while</span> (...);<br> <br>    <span class="hljs-comment">/// 10. 通知Observers，即将退出RunLoop</span><br>    <span class="hljs-comment">/// 此处有Observer释放AutoreleasePool: _objc_autoreleasePoolPop();</span><br>    <span class="hljs-constructor">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(<span class="hljs-params">kCFRunLoopExit</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="AutoreleasePool"><a href="#AutoreleasePool" class="headerlink" title="AutoreleasePool"></a>AutoreleasePool</h3><p>App 启动后，苹果在主线程 RunLoop 里注册了两个 Observer，其回调都是 _wrapRunLoopWithAutoreleasePoolHandler()。</p>
<p>第一个 Observer 监视的事件是 Entry(即将进入 Loop)，其回调内会调用 _objc_autoreleasePoolPush() 创建自动释放池。其 order 是 - 2147483647，优先级最高，保证创建释放池发生在其他所有回调之前。</p>
<p>第二个 Observer 监视了两个事件： BeforeWaiting(准备进入休眠) 时调用_objc_autoreleasePoolPop() 和 _objc_autoreleasePoolPush() 释放旧的池并创建新池；Exit(即将退出 Loop) 时调用 _objc_autoreleasePoolPop() 来释放自动释放池。这个 Observer 的 order 是 2147483647，优先级最低，保证其释放池子发生在其他所有回调之后。</p>
<p>在主线程执行的代码，通常是写在诸如事件回调、Timer 回调内的。这些回调会被 RunLoop 创建好的 AutoreleasePool 环绕着，所以不会出现内存泄漏，开发者也不必显示创建 Pool 了。</p>
<h3 id="事件响应"><a href="#事件响应" class="headerlink" title="事件响应"></a>事件响应</h3><p>苹果注册了一个 Source1 (基于 mach port 的) 用来接收系统事件，其回调函数为 __IOHIDEventSystemClientQueueCallback()。</p>
<p>当一个硬件事件 (触摸 / 锁屏 / 摇晃等) 发生后，首先由 IOKit.framework 生成一个 IOHIDEvent 事件并由 SpringBoard 接收。这个过程的详细情况可以参考<a target="_blank" rel="noopener" href="http://iphonedevwiki.net/index.php/IOHIDFamily">这里</a>。SpringBoard 只接收按键 (锁屏 / 静音等)，触摸，加速，接近传感器等几种 Event，随后用 mach port 转发给需要的 App 进程。随后苹果注册的那个 Source1 就会触发回调，并调用 _UIApplicationHandleEventQueue() 进行应用内部的分发。</p>
<p>_UIApplicationHandleEventQueue() 会把 IOHIDEvent 处理并包装成 UIEvent 进行处理或分发，其中包括识别 UIGesture / 处理屏幕旋转 / 发送给 UIWindow 等。通常事件比如 UIButton 点击、touchesBegin/Move/End/Cancel 事件都是在这个回调中完成的。</p>
<h3 id="手势识别"><a href="#手势识别" class="headerlink" title="手势识别"></a>手势识别</h3><p>当上面的 _UIApplicationHandleEventQueue() 识别了一个手势时，其首先会调用 Cancel 将当前的 touchesBegin/Move/End 系列回调打断。随后系统将对应的 UIGestureRecognizer 标记为待处理。</p>
<p>苹果注册了一个 Observer 监测 BeforeWaiting (Loop 即将进入休眠) 事件，这个 Observer 的回调函数是 _UIGestureRecognizerUpdateObserver()，其内部会获取所有刚被标记为待处理的 GestureRecognizer，并执行 GestureRecognizer 的回调。</p>
<p>当有 UIGestureRecognizer 的变化 (创建 / 销毁 / 状态改变) 时，这个回调都会进行相应处理。</p>
<h3 id="界面更新"><a href="#界面更新" class="headerlink" title="界面更新"></a>界面更新</h3><p>当在操作 UI 时，比如改变了 Frame、更新了 UIView/CALayer 的层次时，或者手动调用了 UIView/CALayer 的 setNeedsLayout/setNeedsDisplay 方法后，这个 UIView/CALayer 就被标记为待处理，并被提交到一个全局的容器去。</p>
<p>苹果注册了一个 Observer 监听 BeforeWaiting(即将进入休眠) 和 Exit (即将退出 Loop) 事件，回调去执行一个很长的函数：<br>_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv()。这个函数里会遍历所有待处理的 UIView/CAlayer 以执行实际的绘制和调整，并更新 UI 界面。</p>
<p>这个函数内部的调用栈大概是这样的：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css">_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv()<br>    QuartzCore:CA::Transaction::observer_callback:<br>        CA::Transaction::<span class="hljs-built_in">commit</span>();<br>            CA::Context::<span class="hljs-built_in">commit_transaction</span>();<br>                CA::Layer::<span class="hljs-built_in">layout_and_display_if_needed</span>();<br>                    CA::Layer::<span class="hljs-built_in">layout_if_needed</span>();<br>                        <span class="hljs-selector-attr">[CALayer layoutSublayers]</span>;<br>                            <span class="hljs-selector-attr">[UIView layoutSubviews]</span>;<br>                    CA::Layer::<span class="hljs-built_in">display_if_needed</span>();<br>                        <span class="hljs-selector-attr">[CALayer display]</span>;<br>                            <span class="hljs-selector-attr">[UIView drawRect]</span>;<br></code></pre></td></tr></table></figure>


<h3 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h3><p>NSTimer 其实就是 CFRunLoopTimerRef，他们之间是 toll-free bridged 的。一个 NSTimer 注册到 RunLoop 后，RunLoop 会为其重复的时间点注册好事件。例如 10:00, 10:10, 10:20 这几个时间点。RunLoop 为了节省资源，并不会在非常准确的时间点回调这个 Timer。Timer 有个属性叫做 Tolerance (宽容度)，标示了当时间点到后，容许有多少最大误差。</p>
<p>如果某个时间点被错过了，例如执行了一个很长的任务，则那个时间点的回调也会跳过去，不会延后执行。就比如等公交，如果 10:10 时我忙着玩手机错过了那个点的公交，那我只能等 10:20 这一趟了。</p>
<p>CADisplayLink 是一个和屏幕刷新率一致的定时器（但实际实现原理更复杂，和 NSTimer 并不一样，其内部实际是操作了一个 Source）。如果在两次屏幕刷新之间执行了一个长任务，那其中就会有一帧被跳过去（和 NSTimer 相似），造成界面卡顿的感觉。在快速滑动 TableView 时，即使一帧的卡顿也会让用户有所察觉。Facebook 开源的 AsyncDisplayLink 就是为了解决界面卡顿的问题，其内部也用到了 RunLoop，这个稍后我会再单独写一页博客来分析。</p>
<h3 id="PerformSelecter"><a href="#PerformSelecter" class="headerlink" title="PerformSelecter"></a>PerformSelecter</h3><p>当调用 NSObject 的 performSelecter:afterDelay: 后，实际上其内部会创建一个 Timer 并添加到当前线程的 RunLoop 中。所以如果当前线程没有 RunLoop，则这个方法会失效。</p>
<p>当调用 performSelector:onThread: 时，实际上其会创建一个 Timer 加到对应的线程去，同样的，如果对应线程没有 RunLoop 该方法也会失效。</p>
<h3 id="关于-GCD"><a href="#关于-GCD" class="headerlink" title="关于 GCD"></a>关于 GCD</h3><p>实际上 RunLoop 底层也会用到 GCD 的东西，<del>比如 RunLoop 是用 dispatch_source_t 实现的 Timer</del>（评 论中有人提醒，NSTimer 是用了 XNU 内核的 mk_timer，我也仔细调试了一下，发现 NSTimer 确实是由 mk_timer 驱动，而非 GCD 驱动的）。但同时 GCD 提供的某些接口也用到了 RunLoop， 例如 dispatch_async()。</p>
<p>当调用 dispatch_async(dispatch_get_main_queue(), block) 时，libDispatch 会向主线程的 RunLoop 发送消息，RunLoop 会被唤醒，并从消息中取得这个 block，并在回调 <strong>CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE</strong>() 里执行这个 block。但这个逻辑仅限于 dispatch 到主线程，dispatch 到其他线程仍然是由 libDispatch 处理的。</p>
<h3 id="关于网络请求"><a href="#关于网络请求" class="headerlink" title="关于网络请求"></a>关于网络请求</h3><p>iOS 中，关于网络请求的接口自下至上有如下几层:</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xl">CFSocket<br>CFN<span class="hljs-function"><span class="hljs-title">etwork</span>       -&gt;</span>ASIHttpRequest<br>NSURLC<span class="hljs-function"><span class="hljs-title">onnection</span> -&gt;</span>AFNetworking<br>NSURLS<span class="hljs-function"><span class="hljs-title">ession</span>    -&gt;</span>AFNetworking2, Alamofire<br></code></pre></td></tr></table></figure>

<p>• CFSocket 是最底层的接口，只负责 socket 通信。<br>• CFNetwork 是基于 CFSocket 等接口的上层封装，ASIHttpRequest 工作于这一层。<br>• NSURLConnection 是基于 CFNetwork 的更高层的封装，提供面向对象的接口，AFNetworking 工作于这一层。<br>• NSURLSession 是 iOS7 中新增的接口，表面上是和 NSURLConnection 并列的，但底层仍然用到了 NSURLConnection 的部分功能 (比如 com.apple.NSURLConnectionLoader 线程)，AFNetworking2 和 Alamofire 工作于这一层。</p>
<p>下面主要介绍下 NSURLConnection 的工作过程。</p>
<p>通常使用 NSURLConnection 时，你会传入一个 Delegate，当调用了 [connection start] 后，这个 Delegate 就会不停收到事件回调。实际上，start 这个函数的内部会会获取 CurrentRunLoop，然后在其中的 DefaultMode 添加了 4 个 Source0 (即需要手动触发的 Source)。CFMultiplexerSource 是负责各种 Delegate 回调的，CFHTTPCookieStorage 是处理各种 Cookie 的。</p>
<p>当开始网络传输时，我们可以看到 NSURLConnection 创建了两个新线程：com.apple.NSURLConnectionLoader 和 com.apple.CFSocket.private。其中 CFSocket 线程是处理底层 socket 连接的。NSURLConnectionLoader 这个线程内部会使用 RunLoop 来接收底层 socket 的事件，并通过之前添加的 Source0 通知到上层的 Delegate。</p>
<p>[<img src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+DQo8IS0tW2lmIElFIDZdPg0KPGh0bWwgaWQ9ImllNiIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDddPg0KPGh0bWwgaWQ9ImllNyIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmIElFIDhdPg0KPGh0bWwgaWQ9ImllOCIgbGFuZz0iemgtQ04iPg0KPCFbZW5kaWZdLS0+DQo8IS0tW2lmICEoSUUgNikgfCAhKElFIDcpIHwgIShJRSA4KSAgXT48IS0tPg0KPGh0bWwgbGFuZz0iemgtQ04iPg0KPCEtLTwhW2VuZGlmXS0tPg0KPGhlYWQ+DQoJPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+DQoJPHRpdGxlPjQwNCDmnKrmib7liLAgfCBHYXJhbiBubyBkb3U8L3RpdGxlPg0KCQkJDQoJDQoJPGxpbmsgcmVsPSJwaW5nYmFjayIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3htbHJwYy5waHAiIC8+DQoNCgkJPCEtLVtpZiBsdCBJRSA5XT4NCgk8c2NyaXB0IHNyYz0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvaHRtbDUuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQoJPCFbZW5kaWZdLS0+DQoNCgk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUgPSAnanMnOw0KCTwvc2NyaXB0Pg0KDQoJPGxpbmsgcmVsPSdkbnMtcHJlZmV0Y2gnIGhyZWY9Jy8vZm9udHMuZ29vZ2xlYXBpcy5jb20nIC8+CjxsaW5rIHJlbD0nZG5zLXByZWZldGNoJyBocmVmPScvL3Mudy5vcmcnIC8+CjxsaW5rIHJlbD0iYWx0ZXJuYXRlIiB0eXBlPSJhcHBsaWNhdGlvbi9yc3MreG1sIiB0aXRsZT0iR2FyYW4gbm8gZG91ICZyYXF1bzsgRmVlZCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2ZlZWQvIiAvPgo8bGluayByZWw9ImFsdGVybmF0ZSIgdHlwZT0iYXBwbGljYXRpb24vcnNzK3htbCIgdGl0bGU9IkdhcmFuIG5vIGRvdSAmcmFxdW87IOivhOiuukZlZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jb21tZW50cy9mZWVkLyIgLz4KPG1ldGEgY29udGVudD0iRGl2aSB2LjIuNS4zIiBuYW1lPSJnZW5lcmF0b3IiLz48bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdzY2FwLmZsYXNoYmxvY2stY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvZmxhc2hibG9jay5jc3M/dmVyPTUuNC42JyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nc2NhcC5wbGF5ZXItY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9jc3MvcGxheWVyLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdjcmF5b24tY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jcmF5b24tc3ludGF4LWhpZ2hsaWdodGVyL2Nzcy9taW4vY3JheW9uLm1pbi5jc3M/dmVyPV8yLjcuMl9iZXRhJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nd3AtZWFzeWFyY2hpdmVzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3BsdWdpbnMvd3AtZWFzeWFyY2hpdmVzL2Nzcy93cC1lYXN5YXJjaGl2ZXMuY3NzP3Zlcj0zLjEuMicgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdzY3JlZW4nIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J3dwLWJsb2NrLWxpYnJhcnktY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2Nzcy9kaXN0L2Jsb2NrLWxpYnJhcnkvc3R5bGUubWluLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdtYXRoLWNhcHRjaGEtZnJvbnRlbmQtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy93cC1tYXRoLWNhcHRjaGEvY3NzL2Zyb250ZW5kLmNzcz92ZXI9NS40LjYnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSd3cC1wYWdlbmF2aS1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3dwLXBhZ2VuYXZpL3BhZ2VuYXZpLWNzcy5jc3M/dmVyPTIuNzAnIHR5cGU9J3RleHQvY3NzJyBtZWRpYT0nYWxsJyAvPgo8bGluayByZWw9J3N0eWxlc2hlZXQnIGlkPSdkaXZpLWZvbnRzLWNzcycgIGhyZWY9J2h0dHBzOi8vZm9udHMubG9saS5uZXQvY3NzP2ZhbWlseT1PcGVuK1NhbnM6MzAwaXRhbGljLDQwMGl0YWxpYyw2MDBpdGFsaWMsNzAwaXRhbGljLDgwMGl0YWxpYyw0MDAsMzAwLDYwMCw3MDAsODAwJiMwMzg7c3Vic2V0PWxhdGluLGxhdGluLWV4dCcgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LWdmLWNoaW5lc2UtY3NzJyAgaHJlZj0nLy9mb250cy5sb2xpLm5ldC9lYXJseWFjY2Vzcy9jd3RleGZhbmdzb25nLmNzcycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2Rpdmktc3R5bGUtY3NzJyAgaHJlZj0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0Rpdmkvc3R5bGUuY3NzP3Zlcj0yLjUuMycgdHlwZT0ndGV4dC9jc3MnIG1lZGlhPSdhbGwnIC8+CjxsaW5rIHJlbD0nc3R5bGVzaGVldCcgaWQ9J2V0LXNob3J0Y29kZXMtY3NzLWNzcycgIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2VwYW5lbC9zaG9ydGNvZGVzL2Nzcy9zaG9ydGNvZGVzLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBpZD0nZXQtc2hvcnRjb2Rlcy1yZXNwb25zaXZlLWNzcy1jc3MnICBocmVmPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9lcGFuZWwvc2hvcnRjb2Rlcy9jc3Mvc2hvcnRjb2Rlc19yZXNwb25zaXZlLmNzcz92ZXI9My4wJyB0eXBlPSd0ZXh0L2NzcycgbWVkaWE9J2FsbCcgLz4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9qcy9zb3VuZG1hbmFnZXIyLW5vZGVidWctanNtaW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL2pzL2pxdWVyeS9qcXVlcnkuanM/dmVyPTEuMTIuNC13cCc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy9qcXVlcnkvanF1ZXJ5LW1pZ3JhdGUubWluLmpzP3Zlcj0xLjQuMSc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBDcmF5b25TeW50YXhTZXR0aW5ncyA9IHsidmVyc2lvbiI6Il8yLjcuMl9iZXRhIiwiaXNfYWRtaW4iOiIwIiwiYWpheHVybCI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1hZG1pblwvYWRtaW4tYWpheC5waHAiLCJwcmVmaXgiOiJjcmF5b24tIiwic2V0dGluZyI6ImNyYXlvbi1zZXR0aW5nIiwic2VsZWN0ZWQiOiJjcmF5b24tc2V0dGluZy1zZWxlY3RlZCIsImNoYW5nZWQiOiJjcmF5b24tc2V0dGluZy1jaGFuZ2VkIiwic3BlY2lhbCI6ImNyYXlvbi1zZXR0aW5nLXNwZWNpYWwiLCJvcmlnX3ZhbHVlIjoiZGF0YS1vcmlnLXZhbHVlIiwiZGVidWciOiIifTsKdmFyIENyYXlvblN5bnRheFN0cmluZ3MgPSB7ImNvcHkiOiJQcmVzcyAlcyB0byBDb3B5LCAlcyB0byBQYXN0ZSIsIm1pbmltaXplIjoiQ2xpY2sgVG8gRXhwYW5kIENvZGUifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL2NyYXlvbi1zeW50YXgtaGlnaGxpZ2h0ZXIvanMvbWluL2NyYXlvbi5taW4uanM/dmVyPV8yLjcuMl9iZXRhJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9zaW1wbGVzbWlsZXlzaG93L2pxdWVyeS5pbnNlcnRhdGNhcmV0LmpzJz48L3NjcmlwdD4KPGxpbmsgcmVsPSdodHRwczovL2FwaS53Lm9yZy8nIGhyZWY9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1qc29uLycgLz4KPGxpbmsgcmVsPSJFZGl0VVJJIiB0eXBlPSJhcHBsaWNhdGlvbi9yc2QreG1sIiB0aXRsZT0iUlNEIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20veG1scnBjLnBocD9yc2QiIC8+CjxsaW5rIHJlbD0id2x3bWFuaWZlc3QiIHR5cGU9ImFwcGxpY2F0aW9uL3dsd21hbmlmZXN0K3htbCIgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWluY2x1ZGVzL3dsd21hbmlmZXN0LnhtbCIgLz4gCjxtZXRhIG5hbWU9ImdlbmVyYXRvciIgY29udGVudD0iV29yZFByZXNzIDUuNC42IiAvPgoKPCEtLSBHZW5lcmF0ZWQgQnkgU2hvdy1Vc2VyQWdlbnQgMS4wLjggLSBodHRwOi8vemx6LmltL3Nob3ctdXNlcmFnZW50LyAtLT4KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC9wbHVnaW5zL3Nob3ctdXNlcmFnZW50L3Nob3ctdXNlcmFnZW50LmNzcyIgdHlwZT0idGV4dC9jc3MiIG1lZGlhPSJzY3JlZW4iIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT0wIiAvPgkJPHN0eWxlIGlkPSJ0aGVtZS1jdXN0b21pemVyLWNzcyI+DQoJCQkJCQkJCQkJCQkJLndvb2NvbW1lcmNlICNyZXNwb25kIGlucHV0I3N1Ym1pdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LCAud29vY29tbWVyY2UgI2NvbnRlbnQgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSAjY29udGVudCBpbnB1dC5idXR0b24sIC53b29jb21tZXJjZS1tZXNzYWdlLCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1pbmZvIHsgYmFja2dyb3VuZDogI2E5ZDMwMCAhaW1wb3J0YW50OyB9DQoJCQkjZXRfc2VhcmNoX2ljb246aG92ZXIsIC5tb2JpbGVfbWVudV9iYXI6YmVmb3JlLCAuZXQtc29jaWFsLWljb24gYTpob3ZlciwgLmV0X3BiX3N1bSwgLmV0X3BiX3ByaWNpbmcgbGkgYSwgLmV0X3BiX3ByaWNpbmdfdGFibGVfYnV0dG9uLCAuZXRfb3ZlcmxheTpiZWZvcmUsIC5lbnRyeS1zdW1tYXJ5IHAucHJpY2UgaW5zLCAud29vY29tbWVyY2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgZGl2LnByb2R1Y3Qgc3Bhbi5wcmljZSwgLndvb2NvbW1lcmNlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGRpdi5wcm9kdWN0IHNwYW4ucHJpY2UsIC53b29jb21tZXJjZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UtcGFnZSBkaXYucHJvZHVjdCBwLnByaWNlLCAud29vY29tbWVyY2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLndvb2NvbW1lcmNlLXBhZ2UgI2NvbnRlbnQgZGl2LnByb2R1Y3QgcC5wcmljZSwgLmV0X3BiX21lbWJlcl9zb2NpYWxfbGlua3MgYTpob3ZlciwgLndvb2NvbW1lcmNlIC5zdGFyLXJhdGluZyBzcGFuOmJlZm9yZSwgLndvb2NvbW1lcmNlLXBhZ2UgLnN0YXItcmF0aW5nIHNwYW46YmVmb3JlLCAuZXRfcGJfd2lkZ2V0IGxpIGE6aG92ZXIsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydGZvbGlvX2ZpbHRlcnMgbGkgYS5hY3RpdmUsIC5ldF9wYl9maWx0ZXJhYmxlX3BvcnRmb2xpbyAuZXRfcGJfcG9ydG9mb2xpb19wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAuZXRfcGJfZ2FsbGVyeSAuZXRfcGJfZ2FsbGVyeV9wYWdpbmF0aW9uIHVsIGxpIGEuYWN0aXZlLCAud3AtcGFnZW5hdmkgc3Bhbi5jdXJyZW50LCAud3AtcGFnZW5hdmkgYTpob3ZlciwgLm5hdi1zaW5nbGUgYSwgLnBvc3RlZF9pbiBhIHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCS5ldF9wYl9jb250YWN0X3N1Ym1pdCwgLmV0X3Bhc3N3b3JkX3Byb3RlY3RlZF9mb3JtIC5ldF9zdWJtaXRfYnV0dG9uLCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9uZXdzbGV0dGVyX2J1dHRvbiwgLmNvbW1lbnQtcmVwbHktbGluaywgLmZvcm0tc3VibWl0IGlucHV0LCAuZXRfcGJfYmdfbGF5b3V0X2xpZ2h0IC5ldF9wYl9wcm9tb19idXR0b24sIC5ldF9wYl9iZ19sYXlvdXRfbGlnaHQgLmV0X3BiX21vcmVfYnV0dG9uLCAud29vY29tbWVyY2UgYS5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBhLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgYnV0dG9uLmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24uYWx0LCAud29vY29tbWVyY2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlLXBhZ2UgI3Jlc3BvbmQgaW5wdXQjc3VibWl0LmFsdCwgLndvb2NvbW1lcmNlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZS1wYWdlICNjb250ZW50IGlucHV0LmJ1dHRvbi5hbHQsIC53b29jb21tZXJjZSBhLmJ1dHRvbiwgLndvb2NvbW1lcmNlLXBhZ2UgYS5idXR0b24sIC53b29jb21tZXJjZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBidXR0b24uYnV0dG9uLCAud29vY29tbWVyY2UgaW5wdXQuYnV0dG9uLCAud29vY29tbWVyY2UtcGFnZSBpbnB1dC5idXR0b24geyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmZvb3Rlci13aWRnZXQgaDQgeyBjb2xvcjogI2E5ZDMwMDsgfQ0KCQkJLmV0LXNlYXJjaC1mb3JtLCAubmF2IGxpIHVsLCAuZXRfbW9iaWxlX21lbnUsIC5mb290ZXItd2lkZ2V0IGxpOmJlZm9yZSwgLmV0X3BiX3ByaWNpbmcgbGk6YmVmb3JlLCBibG9ja3F1b3RlIHsgYm9yZGVyLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkuZXRfcGJfY291bnRlcl9hbW91bnQsIC5ldF9wYl9mZWF0dXJlZF90YWJsZSAuZXRfcGJfcHJpY2luZ19oZWFkaW5nLCAuZXRfcXVvdGVfY29udGVudCwgLmV0X2xpbmtfY29udGVudCwgLmV0X2F1ZGlvX2NvbnRlbnQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjYTlkMzAwOyB9DQoJCQkJCQkJLmNvbnRhaW5lciwgLmV0X3BiX3JvdywgLmV0X3BiX3NsaWRlciAuZXRfcGJfY29udGFpbmVyLCAuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24gLmV0X3BiX3RpdGxlX2NvbnRhaW5lciwgLmV0X3BiX2Z1bGx3aWR0aF9zZWN0aW9uIC5ldF9wYl90aXRsZV9mZWF0dXJlZF9jb250YWluZXIsIC5ldF9wYl9mdWxsd2lkdGhfaGVhZGVyOm5vdCguZXRfcGJfZnVsbHNjcmVlbikgLmV0X3BiX2Z1bGx3aWR0aF9oZWFkZXJfY29udGFpbmVyIHsgbWF4LXdpZHRoOiA5NjBweDsgfQ0KCQkJLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIsIC5ldF9maXhlZF9uYXYuZXRfYm94ZWRfbGF5b3V0ICNwYWdlLWNvbnRhaW5lciAjdG9wLWhlYWRlciwgLmV0X2ZpeGVkX25hdi5ldF9ib3hlZF9sYXlvdXQgI3BhZ2UtY29udGFpbmVyICNtYWluLWhlYWRlciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmNvbnRhaW5lciwgLmV0X2JveGVkX2xheW91dCAjcGFnZS1jb250YWluZXIgLmV0X3BiX3JvdyB7IG1heC13aWR0aDogMTEyMHB4OyB9DQoJCQkJCQkJYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI3RvcC1oZWFkZXIsICNldC1zZWNvbmRhcnktbmF2IGxpIHVsIHsgYmFja2dyb3VuZC1jb2xvcjogI2E5ZDMwMDsgfQ0KCQkJCQkJCQkjdG9wLWhlYWRlciwgI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQkJCQkJCQkJCQ0KCQkNCgkJCQkJI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX3JlZCAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9yZWQgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfcGluayAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9waW5rICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtaXRlbSA+IGEsDQoJCQkuZXRfY29sb3Jfc2NoZW1lX29yYW5nZSAjdG9wLW1lbnUgbGkuY3VycmVudC1tZW51LWFuY2VzdG9yID4gYSwgLmV0X2NvbG9yX3NjaGVtZV9vcmFuZ2UgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSwNCgkJCS5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1hbmNlc3RvciA+IGEsIC5ldF9jb2xvcl9zY2hlbWVfZ3JlZW4gI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjOyB9DQoJCQkJCQkJCQkJCQkJI21haW4tZm9vdGVyIC5mb290ZXItd2lkZ2V0IGg0IHsgY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkuZm9vdGVyLXdpZGdldCBsaTpiZWZvcmUgeyBib3JkZXItY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkNCgkJDQoJCQ0KCQlAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWluLXdpZHRoOiA5ODFweCApIHsNCgkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIsIC5ldC1maXhlZC1oZWFkZXIjdG9wLWhlYWRlciAjZXQtc2Vjb25kYXJ5LW5hdiBsaSB1bCB7IGJhY2tncm91bmQtY29sb3I6ICNhOWQzMDA7IH0NCgkJCQkJCQkJCQkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyICN0b3AtbWVudSBsaS5jdXJyZW50LW1lbnUtYW5jZXN0b3IgPiBhLA0KCQkJCS5ldC1maXhlZC1oZWFkZXIgI3RvcC1tZW51IGxpLmN1cnJlbnQtbWVudS1pdGVtID4gYSB7IGNvbG9yOiAjMjA5YWZjICFpbXBvcnRhbnQ7IH0NCgkJCQkJCQkJCQkuZXQtZml4ZWQtaGVhZGVyI3RvcC1oZWFkZXIgYSB7IGNvbG9yOiByZ2JhKDAsMCwwLDAuNyk7IH0NCgkJCQ0KCQkJCQl9DQoJCUBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKCBtaW4td2lkdGg6IDEyMDBweCkgew0KCQkJLmV0X3BiX3JvdyB7IHBhZGRpbmc6IDI0cHggMDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24geyBwYWRkaW5nOiA0OHB4IDA7IH0NCgkJCS5zaW5nbGUuZXRfcGJfcGFnZWJ1aWxkZXJfbGF5b3V0LmV0X2Z1bGxfd2lkdGhfcGFnZSAuZXRfcG9zdF9tZXRhX3dyYXBwZXIgeyBwYWRkaW5nLXRvcDogNzJweDsgfQ0KCQkJLmV0X3BiX3NlY3Rpb24uZXRfcGJfc2VjdGlvbl9maXJzdCB7IHBhZGRpbmctdG9wOiBpbmhlcml0OyB9DQoJCQkuZXRfcGJfZnVsbHdpZHRoX3NlY3Rpb24geyBwYWRkaW5nOiAwOyB9DQoJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogOTgwcHggKSB7DQoJCQkJCQkJCQkJCQkJCQkJCQkJCX0NCgkJQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAoIG1heC13aWR0aDogNzY3cHggKSB7DQoJCQkJCQkJCQkJCQkJCX0NCgk8L3N0eWxlPg0KDQoJPHN0eWxlIGNsYXNzPSJldF9vbmVfZm9udF9sYW5ndWFnZXMiPmgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGJvZHksIGlucHV0LCB0ZXh0YXJlYSwgc2VsZWN0IHsgZm9udC1mYW1pbHk6ICdjd1RlWEZhbmdTb25nJywgc2VyaWY7IH08L3N0eWxlPg0KCQ0KCTxzdHlsZSBpZD0ibW9kdWxlLWN1c3RvbWl6ZXItY3NzIj4NCgkJCTwvc3R5bGU+DQoNCgk8IS0tIEFsbCBpbiBvbmUgRmF2aWNvbiA0LjcgLS0+PGxpbmsgcmVsPSJpY29uIiBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTMvMDgvZmF2aWNvbi5wbmciIHR5cGU9ImltYWdlL3BuZyIvPgo8bGluayByZWw9ImFwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQiIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxMy8wOC9mYXZpY29uMi5wbmciIC8+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyIgaWQ9ImV0LWN1c3RvbS1jc3MiPgpoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBib2R5LCBpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCB7DQpmb250LWZhbWlseTogJ1BpbmdGYW5nIFNDJywgJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgVmVyZGFuYSwgJ0hpcmFnaW5vIFNhbnMgR0InLCAnTm90byBTYW5zIENKSyBTQycsICdTb3VyY2UgSGFuIFNhbnMgQ04nLCBTVEhlaXRpLCAnTWljcm9zb2Z0IFlhSGVpJywgJ1dlblF1YW5ZaSBNaWNybyBIZWknLCBTaW1TdW4sIHNhbnMtc2VyaWY7DQpmb250LXdlaWdodDogNDAwOw0KfQ0KDQojbWFpbi1oZWFkZXIgew0KICAgIGJhY2tncm91bmQ6IGhzbGEoMCwgMCUsIDEwMCUsIC44NSk7DQogICAgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTJweCk7DQogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEycHgpOw0KfQ0KDQpib2R5IHsgDQoJZm9udC1zaXplOiAxNnB4Ow0KCWNvbG9yOiAjMWQxZDFkOw0KCXdvcmQtd3JhcDpicmVhay13b3JkOw0KCXdvcmQtYnJlYWs6IG5vcm1hbDsNCn0NCg0KcCB7DQoJbWFyZ2luOiAwLjllbSAwIDAuNWVtOw0KCXBhZGRpbmctYm90dG9tOiAwLjZlbTsNCglmb250LXNpemU6IDEwMCU7DQoJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOw0KfQ0KDQouZXRfcGJfcG9zdCBoMiB7DQoJZm9udC13ZWlnaHQ6IGJvbGQ7DQp9DQoNCi5ldF9wYl9wb3N0IC5wb3N0LW1ldGEgew0KCTE0cHggIkNsYXNzaWMgR3JvdGVzcXVlIFcwMSIsIEFyaWFsLCBzYW5zLXNlcmlmOw0KfQ0KDQouZXRfcGJfcG9zdCB7DQoJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlMmUyZTI7DQoJcGFkZGluZy1ib3R0b206IDIwcHg7DQp9DQoNCi5ldF9wYl9wb3N0Omxhc3Qtb2YtdHlwZSB7DQoJYm9yZGVyLWJvdHRvbTogMHB4IHNvbGlkICNlMmUyZTI7DQp9DQoNCiNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB7DQoJcGFkZGluZy10b3A6IDMwcHg7DQp9DQoNCi5ldF9yaWdodF9zaWRlYmFyICNzaWRlYmFyIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmhvbWUgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMHB4Ow0KfQ0KDQouc2luZ2xlLXBvc3QgI2NvbnRlbnQtYXJlYSAjbGVmdC1hcmVhIHsNCglwYWRkaW5nLXRvcDogMzBweDsNCn0NCg0KLmV0X3BiX3Bvc3Qgew0KICBtYXJnaW4tYm90dG9tOiA0MHB4Ow0KfQ0KDQouZXRfcGJfcG9zdCAuZW50cnktY29udGVudCwgDQoucHJvamVjdCAuZW50cnktY29udGVudCB7DQogIHBhZGRpbmctdG9wOiAxMHB4Ow0KfQ0KDQoud2lkZ2V0X2Fib3V0bWV3aWRnZXQgLmNsZWFyZml4LA0KLmV0X3BiX3dpZGdldCBsaSB7DQoJZm9udC1zaXplOiA5MyU7DQp9DQoNCi53aWRnZXR0aXRsZSB7DQoJZm9udC1zaXplOiAxMjAlOw0KfQ0KDQouZXRfcGJfc2Nyb2xsX3RvcCB7DQogICAgYm90dG9tOiAxNXB4Ow0KfQ0KDQojdG9wLW1lbnUgbGkgPiBhLCANCi5mdWxsd2lkdGgtbWVudSBsaSA+IGEgew0KCWZvbnQtc2l6ZTogMTRweDsNCglmb250LXdlaWdodDogNDAwOw0KfQ0KDQojZm9vdGVyLWJvdHRvbSB7DQoJcGFkZGluZzogNXB4IDAgN3B4Ow0KfQ0KDQppbWcud3Atc21pbGV5IHsNCgltYXgtaGVpZ2h0OiAxLjJlbSAhaW1wb3J0YW50Ow0KCWhlaWdodDogMS4yZW0gIWltcG9ydGFudDsNCgl3aWR0aDogMS4yZW0gIWltcG9ydGFudDsNCn0NCg0KLndwLXNtaWxleWxpbmsgew0KCW1heC13aWR0aDogMjJweCAhaW1wb3J0YW50Ow0KfQ0KDQojbGVmdC1hcmVhIGE6aG92ZXIgew0KCXRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQojY29tbWVudGZvcm0gdGV4dGFyZWEsIA0KI2NvbW1lbnRmb3JtIGlucHV0W3R5cGU9InRleHQiXSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KfQ0KDQpAbWVkaWEgb25seSBzY3JlZW4gYW5kICggbWF4LXdpZHRoOiA3NjdweCApIHsNCgkuZXRfcGJfcm93LCAuY29udGFpbmVyLCAuZXRfcGJfY29udGFpbmVyIHsgd2lkdGg6IDg1JTsgfQ0KCS5ldF9wYl9wb3N0IGgyLCAuZXRfcGJfcG9ydGZvbGlvX2l0ZW0gaDIgeyBmb250LXNpemU6IDI0cHg7IH0NCgkuY29tbWVudC1ib2R5IHsgcGFkZGluZzogMCAwIDI1cHggMTAwcHg7IH0NCn0NCg0KI2R5bmFtaWMtdG8tdG9wIHsNCglkaXNwbGF5Om5vbmU7DQoJb3ZlcmZsb3c6aGlkZGVuOw0KCXdpZHRoOmF1dG87DQoJei1pbmRleDo5MDsNCglwb3NpdGlvbjpmaXhlZDsNCgl0b3A6YXV0bzsNCglsZWZ0OmF1dG87DQoJZm9udC1mYW1pbHk6c2Fucy1zZXJpZjsNCglmb250LXNpemU6MWVtOw0KCWNvbG9yOiNmZmY7DQoJdGV4dC1kZWNvcmF0aW9uOm5vbmU7DQoJdGV4dC1zaGFkb3c6MCAxcHggMCAjMzMzOw0KCWZvbnQtd2VpZ2h0OmJvbGQ7DQoJcGFkZGluZzoxN3B4IDE2cHg7DQoJYm9yZGVyOjBweCBzb2xpZCAjMDAwOw0KCWJhY2tncm91bmQ6IzExMTsNCgktd2Via2l0LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktbW96LWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktaWNhYi1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJLWtodG1sLWJhY2tncm91bmQtb3JpZ2luOmJvcmRlcjsNCgktby1iYWNrZ3JvdW5kLW9yaWdpbjpib3JkZXI7DQoJYmFja2dyb3VuZC1vcmlnaW46Ym9yZGVyOw0KCS13ZWJraXQtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1tb3otYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1pY2FiLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgkta2h0bWwtYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Ow0KCS1vLWJhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDsNCgliYWNrZ3JvdW5kLWNsaXA6cGFkZGluZy1ib3g7DQoJLXdlYmtpdC1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktbXMtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLW1vei1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgktby1ib3gtc2hhZG93OjAgMXB4IDNweCByZ2JhKCAwLCAwLCAwLCAwLjQgKTsNCgkta2h0bWwtYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLWljYWItYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJYm94LXNoYWRvdzowIDFweCAzcHggcmdiYSggMCwgMCwgMCwgMC40ICk7DQoJLXdlYmtpdC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLW1vei1ib3JkZXItcmFkaXVzOjIzcHg7DQoJLWljYWItYm9yZGVyLXJhZGl1czoyM3B4Ow0KCS1raHRtbC1ib3JkZXItcmFkaXVzOjIzcHg7DQoJYm9yZGVyLXJhZGl1czoyM3B4DQp9DQojZHluYW1pYy10by10b3A6aG92ZXIgew0KCWJhY2tncm91bmQ6IzRkNGRhYzsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1ncmFkaWVudCggbGluZWFyLCAwJSAwJSwgMCUgMTAwJSwgZnJvbSggcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSApLCB0byggcmdiYSggMCwgMCwgMCwgMCApICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1raHRtbC1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tb3otbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzA4ZiAtby1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1tcy1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMjU1LCAyNTUsIDI1NSwgLjIgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMDhmIC1pY2FiLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAyNTUsIDI1NSwgMjU1LCAuMiApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMwOGYgbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDI1NSwgMjU1LCAyNTUsIC4yICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWN1cnNvcjpwb2ludGVyDQp9DQojZHluYW1pYy10by10b3A6YWN0aXZlIHsNCgliYWNrZ3JvdW5kOiMxMTE7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtZ3JhZGllbnQoIGxpbmVhciwgMCUgMCUsIDAlIDEwMCUsIGZyb20oIHJnYmEoIDAsIDAsIDAsIC4zICkgKSwgdG8oIHJnYmEoIDAsIDAsIDAsIDAgKSApICk7DQoJYmFja2dyb3VuZDojMTExIC13ZWJraXQtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbW96LWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLWtodG1sLWxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKTsNCgliYWNrZ3JvdW5kOiMxMTEgLW8tbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtbXMtbGluZWFyLWdyYWRpZW50KCB0b3AsIHJnYmEoIDAsIDAsIDAsIC4xICksIHJnYmEoIDAsIDAsIDAsIDAgKSApOw0KCWJhY2tncm91bmQ6IzExMSAtaWNhYi1saW5lYXItZ3JhZGllbnQoIHRvcCwgcmdiYSggMCwgMCwgMCwgLjEgKSwgcmdiYSggMCwgMCwgMCwgMCApICk7DQoJYmFja2dyb3VuZDojMTExIGxpbmVhci1ncmFkaWVudCggdG9wLCByZ2JhKCAwLCAwLCAwLCAuMSApLCByZ2JhKCAwLCAwLCAwLCAwICkgKQ0KfQ0KI2R5bmFtaWMtdG8tdG9wLCNkeW5hbWljLXRvLXRvcDphY3RpdmUsI2R5bmFtaWMtdG8tdG9wOmZvY3VzLCNkeW5hbWljLXRvLXRvcDpob3ZlciB7DQoJb3V0bGluZTpub25lDQp9DQojZHluYW1pYy10by10b3Agc3BhbiB7DQoJZGlzcGxheTpibG9jazsNCglvdmVyZmxvdzpoaWRkZW47DQoJd2lkdGg6MTRweDsNCgloZWlnaHQ6MTJweDsNCgliYWNrZ3JvdW5kOnVybCgvd3AtY29udGVudC9wbHVnaW5zL2R5bmFtaWMtdG8tdG9wL2Nzcy9pbWFnZXMvdXAucG5nICluby1yZXBlYXQgY2VudGVyIGNlbnRlcg0KfQ0KDQouZW50cnktY29udGVudCB0YWJsZSwgYm9keS5ldC1wYi1wcmV2aWV3ICNtYWluLWNvbnRlbnQgLmNvbnRhaW5lciB0YWJsZSB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0MxQzFDMTsNCiAgICBsaW5lLWhlaWdodDogMS40ZW07DQoNCiAgICBib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlOw0KfQ0KDQp0aGVhZCB7DQoJYmFja2dyb3VuZC1jb2xvcjogI0YxRjFGMTsNCn0NCg0KcCNjb3B5cmlnaHQgew0KICAgIGNvbG9yOiAjNzE3MTcxOw0KfQo8L3N0eWxlPjwvaGVhZD4NCjxib2R5IGNsYXNzPSJlcnJvcjQwNCBldF9wYl9idXR0b25faGVscGVyX2NsYXNzIGV0X2ZpeGVkX25hdiBldF9zaG93X25hdiBldF9jb3Zlcl9iYWNrZ3JvdW5kIGV0X3BiX2d1dHRlciBvc3ggZXRfcGJfZ3V0dGVyczMgZXRfcHJpbWFyeV9uYXZfZHJvcGRvd25fYW5pbWF0aW9uX2ZhZGUgZXRfc2Vjb25kYXJ5X25hdl9kcm9wZG93bl9hbmltYXRpb25fZmFkZSBldF9wYl9mb290ZXJfY29sdW1uczQgZXRfaGVhZGVyX3N0eWxlX2xlZnQgZXRfcmlnaHRfc2lkZWJhciBjaHJvbWUiPg0KCTxkaXYgaWQ9InBhZ2UtY29udGFpbmVyIj4NCg0KCQ0KCQk8aGVhZGVyIGlkPSJtYWluLWhlYWRlciIgZGF0YS1oZWlnaHQtb25sb2FkPSI2NiI+DQoJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgY2xlYXJmaXggZXRfbWVudV9jb250YWluZXIiPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImxvZ29fY29udGFpbmVyIj4NCgkJCQkJPHNwYW4gY2xhc3M9ImxvZ29faGVscGVyIj48L3NwYW4+DQoJCQkJCTxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQkJPGltZyBzcmM9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3VwbG9hZHMvMjAxNS8wNS9sb2dvMS5wbmciIGFsdD0iR2FyYW4gbm8gZG91IiBpZD0ibG9nbyIgZGF0YS1oZWlnaHQtcGVyY2VudGFnZT0iNTQiIC8+DQoJCQkJCTwvYT4NCgkJCQk8L2Rpdj4NCgkJCQk8ZGl2IGlkPSJldC10b3AtbmF2aWdhdGlvbiIgZGF0YS1oZWlnaHQ9IjY2IiBkYXRhLWZpeGVkLWhlaWdodD0iNDAiPg0KCQkJCQk8bmF2IGlkPSJ0b3AtbWVudS1uYXYiPg0KCQkJCQkJCQkJCQk8dWwgaWQ9InRvcC1tZW51IiBjbGFzcz0ibmF2Ij4NCgkJCQkJCQkJCQkJCQkJCTxsaSA+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tLyI+6aaW6aG1PC9hPjwvbGk+DQoJCQkJCQkJDQoJCQkJCQkJPGxpIGNsYXNzPSJwYWdlX2l0ZW0gcGFnZS1pdGVtLTM0Ij48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vYWJvdXQvIj5BYm91dDwvYT48L2xpPgo8bGkgY2xhc3M9InBhZ2VfaXRlbSBwYWdlLWl0ZW0tNDE1MDIiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9hcmNoaXZlLyI+QXJjaGl2ZTwvYT48L2xpPgoJCQkJCQkJCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2FjZy8iPkFDRzwvYT4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMSI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L290aGVyLyI+5YW25LuWPC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMCI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2NoaXJydXAvIj7lkJDmp708L2E+CjwvbGk+Cgk8bGkgY2xhc3M9ImNhdC1pdGVtIGNhdC1pdGVtLTExIj48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vY2F0ZWdvcnkvdGVjLyI+5oqA5pyvPC9hPgo8dWwgY2xhc3M9J2NoaWxkcmVuJz4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tMzAiPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9jYXRlZ29yeS90ZWMvaW9zLXRlYy8iPmlPUzwvYT4KPC9saT4KPC91bD4KPC9saT4KCTxsaSBjbGFzcz0iY2F0LWl0ZW0gY2F0LWl0ZW0tNyI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2RhaWx5LyI+5pel5bi4PC9hPgo8L2xpPgoJPGxpIGNsYXNzPSJjYXQtaXRlbSBjYXQtaXRlbS0xMiI+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NhdGVnb3J5L2Rlc2lnbi8iPuiuvuiuoTwvYT4KPC9saT4KCQkJCQkJPC91bD4NCgkJCQkJCQkJCQk8L25hdj4NCg0KCQkJCQkNCgkJCQkJDQoJCQkJCTxkaXYgaWQ9ImV0X21vYmlsZV9uYXZfbWVudSI+DQoJCQk8ZGl2IGNsYXNzPSJtb2JpbGVfbmF2IGNsb3NlZCI+DQoJCQkJPHNwYW4gY2xhc3M9InNlbGVjdF9wYWdlIj7pgInmi6npobXpnaI8L3NwYW4+DQoJCQkJPHNwYW4gY2xhc3M9Im1vYmlsZV9tZW51X2JhciI+PC9zcGFuPg0KCQkJPC9kaXY+DQoJCTwvZGl2PgkJCQk8L2Rpdj4gPCEtLSAjZXQtdG9wLW5hdmlnYXRpb24gLS0+DQoJCQk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KCQkJPGRpdiBjbGFzcz0iZXRfc2VhcmNoX291dGVyIj4NCgkJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIgZXRfc2VhcmNoX2Zvcm1fY29udGFpbmVyIj4NCgkJCQkJPGZvcm0gcm9sZT0ic2VhcmNoIiBtZXRob2Q9ImdldCIgY2xhc3M9ImV0LXNlYXJjaC1mb3JtIiBhY3Rpb249Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS8iPg0KCQkJCQk8aW5wdXQgdHlwZT0ic2VhcmNoIiBjbGFzcz0iZXQtc2VhcmNoLWZpZWxkIiBwbGFjZWhvbGRlcj0i5pCc57SiICZoZWxsaXA7IiB2YWx1ZT0iIiBuYW1lPSJzIiB0aXRsZT0i5pCc57Si77yaIiAvPgkJCQkJPC9mb3JtPg0KCQkJCQk8c3BhbiBjbGFzcz0iZXRfY2xvc2Vfc2VhcmNoX2ZpZWxkIj48L3NwYW4+DQoJCQkJPC9kaXY+DQoJCQk8L2Rpdj4NCgkJPC9oZWFkZXI+IDwhLS0gI21haW4taGVhZGVyIC0tPg0KDQoJCTxkaXYgaWQ9ImV0LW1haW4tYXJlYSI+DQo8ZGl2IGlkPSJtYWluLWNvbnRlbnQiPg0KCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQoJCTxkaXYgaWQ9ImNvbnRlbnQtYXJlYSIgY2xhc3M9ImNsZWFyZml4Ij4NCgkJCTxkaXYgaWQ9ImxlZnQtYXJlYSI+DQoJCQkJPGFydGljbGUgaWQ9InBvc3QtMCIgY2xhc3M9ImV0X3BiX3Bvc3Qgbm90X2ZvdW5kIj4NCgkJCQkJPGRpdiBjbGFzcz0iZW50cnkiPg0KPCEtLUlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+DQoJPGgxPuacquaJvuWIsOe7k+aenDwvaDE+DQoJPHA+5oKo6K+35rGC55qE6aG16Z2i5peg5rOV5om+5Yiw44CC5bCd6K+V57K+56Gu5oKo55qE5pCc57Si77yM5oiW6ICF5L2/55So5LiK6Z2i55qE5a+86Iiq5a6a5L2N5paH56ug44CCPC9wPg0KPC9kaXY+DQo8IS0tRW5kIGlmIG5vIHJlc3VsdHMgYXJlIGZvdW5kLS0+CQkJCTwvYXJ0aWNsZT4gPCEtLSAuZXRfcGJfcG9zdCAtLT4NCgkJCTwvZGl2PiA8IS0tICNsZWZ0LWFyZWEgLS0+DQoNCgkJCQk8ZGl2IGlkPSJzaWRlYmFyIj4NCgkJPGRpdiBpZD0iYWJvdXRtZXdpZGdldC01IiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF9hYm91dG1ld2lkZ2V0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7lhbPkuo48L2g0PgkJPGRpdiBjbGFzcz0iY2xlYXJmaXgiPg0KCQkJPGltZyBzcmM9IiIgaWQ9ImFib3V0LWltYWdlIiBhbHQ9IiIgLz4NCgkJCeS8veiTneS5i+WgguKAlOKAlDxiciAvPuS4gOWPqumtlOazleW4iOeahOW3peWdigkJPC9kaXY+IDwhLS0gZW5kIGFib3V0IG1lIHNlY3Rpb24gLS0+DQoJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+PGRpdiBpZD0idGV4dC0yIiBjbGFzcz0iZXRfcGJfd2lkZ2V0IHdpZGdldF90ZXh0Ij48aDQgY2xhc3M9IndpZGdldHRpdGxlIj7nm7jlhbPpk77mjqU8L2g0PgkJCTxkaXYgY2xhc3M9InRleHR3aWRnZXQiPjx1bD4KPGxpPjxhIGhyZWY9Imh0dHA6Ly9naXRodWIuY29tL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5HaXRodWI8L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHA6Ly93ZWliby5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+V2VpYm88L2E+PC9saT4KPGxpPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20vaWJpcmVtZSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciI+VHdpdHRlcjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2liaXJlbWUvIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5MaW5rZWRJbjwvYT48L2xpPgo8bGk+PGEgaHJlZj0iaHR0cDovL2liaXJlbWUuZGV2aWFudGFydC5jb20vIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj5EZXZpYW50QVJUPC9hPjwvbGk+CjwvdWw+CjwvZGl2PgoJCTwvZGl2PiA8IS0tIGVuZCAuZXRfcGJfd2lkZ2V0IC0tPjxkaXYgaWQ9Im1ldGEtMiIgY2xhc3M9ImV0X3BiX3dpZGdldCB3aWRnZXRfbWV0YSI+PGg0IGNsYXNzPSJ3aWRnZXR0aXRsZSI+5Yqf6IO9PC9oND4JCQk8dWw+CgkJCQkJCTxsaT48YSBocmVmPSJodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtbG9naW4ucGhwIj7nmbvlvZU8L2E+PC9saT4KCQkJPGxpPjxhIGhyZWY9Imh0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS9mZWVkLyI+5p2h55uuZmVlZDwvYT48L2xpPgoJCQk8bGk+PGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL2NvbW1lbnRzL2ZlZWQvIj7or4TorrpmZWVkPC9hPjwvbGk+CgkJCTxsaT48YSBocmVmPSJodHRwczovL2NuLndvcmRwcmVzcy5vcmcvIj5Xb3JkUHJlc3Mub3JnPC9hPjwvbGk+CQkJPC91bD4KCQkJPC9kaXY+IDwhLS0gZW5kIC5ldF9wYl93aWRnZXQgLS0+CTwvZGl2PiA8IS0tIGVuZCAjc2lkZWJhciAtLT4NCgkJPC9kaXY+IDwhLS0gI2NvbnRlbnQtYXJlYSAtLT4NCgk8L2Rpdj4gPCEtLSAuY29udGFpbmVyIC0tPg0KPC9kaXY+IDwhLS0gI21haW4tY29udGVudCAtLT4NCg0KCgkJCTxmb290ZXIgaWQ9Im1haW4tZm9vdGVyIj4KCQkJCQoKCQkKCQkJCTxkaXYgaWQ9ImZvb3Rlci1ib3R0b20iPgoJCQkJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciBjbGVhcmZpeCI+CgkJCQkKCQkJCQkJPHAgaWQ9ImNvcHlyaWdodCI+CgkJCQkJCQlDb3B5cmlnaHQgMjAyMSBpYmlyZW1lCgkJCQkJCTwvcD4KCQkJCQk8L2Rpdj4JPCEtLSAuY29udGFpbmVyIC0tPgoJCQkJPC9kaXY+CgkJCTwvZm9vdGVyPiA8IS0tICNtYWluLWZvb3RlciAtLT4KCQk8L2Rpdj4gPCEtLSAjZXQtbWFpbi1hcmVhIC0tPgoKCgk8L2Rpdj4gPCEtLSAjcGFnZS1jb250YWluZXIgLS0+CgoJPCEtLSBCYWlkdSBBbmFseXRpY3MgLS0+DQo8c2NyaXB0Pg0KdmFyIF9obXQgPSBfaG10IHx8IFtdOw0KKGZ1bmN0aW9uKCkgew0KICB2YXIgaG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgaG0uc3JjID0gImh0dHBzOi8vaG0uYmFpZHUuY29tL2htLmpzPzZmMzAwN2QzZmUxNTI0NDk4MGVmZjU4OWY5ZDc4MDYzIjsNCiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07IA0KICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGhtLCBzKTsNCn0pKCk7DQo8L3NjcmlwdD4NCg0KPCEtLSBHb29nbGUgQW5hbHl0aWNzIC0tPg0KPHNjcmlwdCBhc3luYyBzcmM9Imh0dHBzOi8vd3d3Lmdvb2dsZXRhZ21hbmFnZXIuY29tL2d0YWcvanM/aWQ9VUEtNDMwMTc2NDctMSI+PC9zY3JpcHQ+DQo8c2NyaXB0Pg0KICB3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsNCiAgZnVuY3Rpb24gZ3RhZygpe2RhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7fQ0KICBndGFnKCdqcycsIG5ldyBEYXRlKCkpOw0KICBndGFnKCdjb25maWcnLCAnVUEtNDMwMTc2NDctMScpOw0KPC9zY3JpcHQ+CjwhLS0gV1AgQXVkaW8gcGxheWVyIHBsdWdpbiB2MS45LjYgLSBodHRwczovL3d3dy50aXBzYW5kdHJpY2tzLWhxLmNvbS93b3JkcHJlc3MtYXVkaW8tbXVzaWMtcGxheWVyLXBsdWdpbi00NTU2LyAtLT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICAgICAgc291bmRNYW5hZ2VyLnVzZUZsYXNoQmxvY2sgPSB0cnVlOyAvLyBvcHRpb25hbCAtIGlmIHVzZWQsIHJlcXVpcmVkIGZsYXNoYmxvY2suY3NzDQogICAgICAgIHNvdW5kTWFuYWdlci51cmwgPSAnaHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvcGx1Z2lucy9jb21wYWN0LXdwLWF1ZGlvLXBsYXllci9zd2Yvc291bmRtYW5hZ2VyMi5zd2YnOw0KICAgICAgICBmdW5jdGlvbiBwbGF5X21wMyhmbGcsIGlkcywgbXAzdXJsLCB2b2x1bWUsIGxvb3BzKQ0KICAgICAgICB7DQogICAgICAgICAgICAvL0NoZWNrIHRoZSBmaWxlIFVSTCBwYXJhbWV0ZXIgdmFsdWUNCiAgICAgICAgICAgIHZhciBwaWVjZXMgPSBtcDN1cmwuc3BsaXQoInwiKTsNCiAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMSkgey8vV2UgaGF2ZSBnb3QgYW4gLm9nZyBmaWxlIHRvbw0KICAgICAgICAgICAgICAgIG1wM2ZpbGUgPSBwaWVjZXNbMF07DQogICAgICAgICAgICAgICAgb2dnZmlsZSA9IHBpZWNlc1sxXTsNCiAgICAgICAgICAgICAgICAvL3NldCB0aGUgZmlsZSBVUkwgdG8gYmUgYW4gYXJyYXkgd2l0aCB0aGUgbXAzIGFuZCBvZ2cgZmlsZQ0KICAgICAgICAgICAgICAgIG1wM3VybCA9IG5ldyBBcnJheShtcDNmaWxlLCBvZ2dmaWxlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLmNyZWF0ZVNvdW5kKHsNCiAgICAgICAgICAgICAgICBpZDogJ2J0bnBsYXlfJyArIGlkcywNCiAgICAgICAgICAgICAgICB2b2x1bWU6IHZvbHVtZSwNCiAgICAgICAgICAgICAgICB1cmw6IG1wM3VybA0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGlmIChmbGcgPT0gJ3BsYXknKSB7DQogICAgICAgICAgICAgICAgICAgIHNvdW5kTWFuYWdlci5wbGF5KCdidG5wbGF5XycgKyBpZHMsIHsNCiAgICAgICAgICAgICAgICAgICAgb25maW5pc2g6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvb3BzID09ICd0cnVlJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZCgnYnRucGxheV8nICsgaWRzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuc3RvcF8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChmbGcgPT0gJ3N0b3AnKSB7DQogICAgLy9zb3VuZE1hbmFnZXIuc3RvcCgnYnRucGxheV8nK2lkcyk7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBhdXNlKCdidG5wbGF5XycgKyBpZHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIHNob3dfaGlkZShmbGFnLCBpZHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChmbGFnID09ICdwbGF5Jykgew0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5wbGF5XycgKyBpZHMpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoZmxhZyA9PSAnc3RvcCcpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRucGxheV8nICsgaWRzKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bnN0b3BfJyArIGlkcykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmdW5jdGlvbiBsb29wU291bmQoc291bmRJRCkNCiAgICAgICAgew0KICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc291bmRNYW5hZ2VyLnBsYXkoc291bmRJRCwge29uZmluaXNoOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3BTb3VuZChzb3VuZElEKTsNCiAgICAgICAgICAgICAgICAgICAgfX0pOw0KICAgICAgICAgICAgfSwgMSk7DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gc3RvcF9hbGxfdHJhY2tzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc291bmRNYW5hZ2VyLnN0b3BBbGwoKTsNCiAgICAgICAgICAgIHZhciBpbnB1dHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5wbGF5XyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsvL1RvZ2dsZSB0aGUgcGxheSBidXR0b24NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGlucHV0c1tpXS5pZC5pbmRleE9mKCJidG5zdG9wXyIpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Ly9IaWRlIHRoZSBzdG9wIGJ1dHRvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9mcm9udGVuZC1idWlsZGVyLWdsb2JhbC1mdW5jdGlvbnMuanM/dmVyPTIuNS4zJz48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cHM6Ly9ibG9nLmliaXJlbWUuY29tL3dwLWNvbnRlbnQvdGhlbWVzL0RpdmkvanMvY3VzdG9tLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1jb250ZW50L3RoZW1lcy9EaXZpL2luY2x1ZGVzL2J1aWxkZXIvc2NyaXB0cy9qcXVlcnkuZml0dmlkcy5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvd2F5cG9pbnRzLm1pbi5qcz92ZXI9Mi41LjMnPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvanF1ZXJ5Lm1hZ25pZmljLXBvcHVwLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz4KLyogPCFbQ0RBVEFbICovCnZhciBldF9jdXN0b20gPSB7ImFqYXh1cmwiOiJodHRwczpcL1wvYmxvZy5pYmlyZW1lLmNvbVwvd3AtYWRtaW5cL2FkbWluLWFqYXgucGhwIiwiaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2ltYWdlcyIsImJ1aWxkZXJfaW1hZ2VzX3VyaSI6Imh0dHBzOlwvXC9ibG9nLmliaXJlbWUuY29tXC93cC1jb250ZW50XC90aGVtZXNcL0RpdmlcL2luY2x1ZGVzXC9idWlsZGVyXC9pbWFnZXMiLCJldF9sb2FkX25vbmNlIjoiZGM4NmFmOTNlMiIsInN1YnNjcmlwdGlvbl9mYWlsZWQiOiJQbGVhc2UsIGNoZWNrIHRoZSBmaWVsZHMgYmVsb3cgdG8gbWFrZSBzdXJlIHlvdSBlbnRlcmVkIHRoZSBjb3JyZWN0IGluZm9ybWF0aW9uLiIsImZpbGwiOiJGaWxsIiwiZmllbGQiOiJmaWVsZCIsImludmFsaWQiOiJJbnZhbGlkIGVtYWlsIiwiY2FwdGNoYSI6IkNhcHRjaGEiLCJwcmV2IjoiUHJldiIsInByZXZpb3VzIjoiXHU0ZTBhXHU0ZTAwXHU5ODc1IiwibmV4dCI6Ilx1NGUwYlx1NGUwMFx1OTg3NSIsImlzX2J1aWxkZXJfcGx1Z2luX3VzZWQiOiIifTsKLyogXV0+ICovCjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9J3RleHQvamF2YXNjcmlwdCcgc3JjPSdodHRwczovL2Jsb2cuaWJpcmVtZS5jb20vd3AtY29udGVudC90aGVtZXMvRGl2aS9pbmNsdWRlcy9idWlsZGVyL3NjcmlwdHMvZnJvbnRlbmQtYnVpbGRlci1zY3JpcHRzLmpzP3Zlcj0yLjUuMyc+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9J2h0dHBzOi8vYmxvZy5pYmlyZW1lLmNvbS93cC1pbmNsdWRlcy9qcy93cC1lbWJlZC5taW4uanM/dmVyPTUuNC42Jz48L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==" srcset="/img/loading.gif" lazyload></p>
<p>NSURLConnectionLoader 中的 RunLoop 通过一些基于 mach port 的 Source 接收来自底层 CFSocket 的通知。当收到通知后，其会在合适的时机向 CFMultiplexerSource 等 Source0 发送通知，同时唤醒 Delegate 线程的 RunLoop 来让其处理这些通知。CFMultiplexerSource 会在 Delegate 线程的 RunLoop 对 Delegate 执行实际的回调。</p>
<h2 id="RunLoop-的实际应用举例"><a href="#RunLoop-的实际应用举例" class="headerlink" title="RunLoop 的实际应用举例"></a>RunLoop 的实际应用举例</h2><h3 id="AFNetworking"><a href="#AFNetworking" class="headerlink" title="AFNetworking"></a>AFNetworking</h3><p><a target="_blank" rel="noopener" href="https://github.com/AFNetworking/AFNetworking/blob/master/AFNetworking%2FAFURLConnectionOperation.m">AFURLConnectionOperation</a> 这个类是基于 NSURLConnection 构建的，其希望能在后台线程接收 Delegate 回调。为此 AFNetworking 单独创建了一个线程，并在这个线程中启动了一个 RunLoop：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">+ (<span class="hljs-keyword">void</span>)networkRequestThreadEntryPoint:(<span class="hljs-keyword">id</span>)__unused object &#123;<br>    <span class="hljs-keyword">@autoreleasepool</span> &#123;<br>        [[<span class="hljs-built_in">NSThread</span> currentThread] setName:<span class="hljs-string">@&quot;AFNetworking&quot;</span>];<br>        <span class="hljs-built_in">NSRunLoop</span> *runLoop = [<span class="hljs-built_in">NSRunLoop</span> currentRunLoop];<br>        [runLoop addPort:[<span class="hljs-built_in">NSMachPort</span> port] forMode:<span class="hljs-built_in">NSDefaultRunLoopMode</span>];<br>        [runLoop run];<br>    &#125;<br>&#125;<br> <br>+ (<span class="hljs-built_in">NSThread</span> *)networkRequestThread &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-built_in">NSThread</span> *_networkRequestThread = <span class="hljs-literal">nil</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> oncePredicate;<br>    <span class="hljs-built_in">dispatch_once</span>(&amp;oncePredicate, ^&#123;<br>        _networkRequestThread = [[<span class="hljs-built_in">NSThread</span> alloc] initWithTarget:<span class="hljs-keyword">self</span> selector:<span class="hljs-keyword">@selector</span>(networkRequestThreadEntryPoint:) object:<span class="hljs-literal">nil</span>];<br>        [_networkRequestThread start];<br>    &#125;);<br>    <span class="hljs-keyword">return</span> _networkRequestThread;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>RunLoop 启动前内部必须要有至少一个 Timer/Observer/Source，所以 AFNetworking 在 [runLoop run] 之前先创建了一个新的 NSMachPort 添加进去了。通常情况下，调用者需要持有这个 NSMachPort (mach_port) 并在外部线程通过这个 port 发送消息到 loop 内；但此处添加 port 只是为了让 RunLoop 不至于退出，并没有用于实际的发送消息。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-keyword">void</span>)start &#123;<br>    [<span class="hljs-keyword">self</span>.lock lock];<br>    <span class="hljs-keyword">if</span> ([<span class="hljs-keyword">self</span> isCancelled]) &#123;<br>        [<span class="hljs-keyword">self</span> performSelector:<span class="hljs-keyword">@selector</span>(cancelConnection) onThread:[[<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>] networkRequestThread] withObject:<span class="hljs-literal">nil</span> waitUntilDone:<span class="hljs-literal">NO</span> modes:[<span class="hljs-keyword">self</span>.runLoopModes allObjects]];<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-keyword">self</span> isReady]) &#123;<br>        <span class="hljs-keyword">self</span>.state = AFOperationExecutingState;<br>        [<span class="hljs-keyword">self</span> performSelector:<span class="hljs-keyword">@selector</span>(operationDidStart) onThread:[[<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>] networkRequestThread] withObject:<span class="hljs-literal">nil</span> waitUntilDone:<span class="hljs-literal">NO</span> modes:[<span class="hljs-keyword">self</span>.runLoopModes allObjects]];<br>    &#125;<br>    [<span class="hljs-keyword">self</span>.lock unlock];<br>&#125;<br></code></pre></td></tr></table></figure>


<p>当需要这个后台线程执行任务时，AFNetworking 通过调用 [NSObject performSelector:onThread:..] 将这个任务扔到了后台线程的 RunLoop 中。</p>
<h3 id="AsyncDisplayKit"><a href="#AsyncDisplayKit" class="headerlink" title="AsyncDisplayKit"></a>AsyncDisplayKit</h3><p><a target="_blank" rel="noopener" href="https://github.com/facebook/AsyncDisplayKit">AsyncDisplayKit</a> 是 Facebook 推出的用于保持界面流畅性的框架，其原理大致如下：</p>
<p>UI 线程中一旦出现繁重的任务就会导致界面卡顿，这类任务通常分为 3 类：排版，绘制，UI 对象操作。</p>
<p>排版通常包括计算视图大小、计算文本高度、重新计算子式图的排版等操作。<br>绘制一般有文本绘制 (例如 CoreText)、图片绘制 (例如预先解压)、元素绘制 (Quartz) 等操作。<br>UI 对象操作通常包括 UIView/CALayer 等 UI 对象的创建、设置属性和销毁。</p>
<p>其中前两类操作可以通过各种方法扔到后台线程执行，而最后一类操作只能在主线程完成，并且有时后面的操作需要依赖前面操作的结果 （例如 TextView 创建时可能需要提前计算出文本的大小）。ASDK 所做的，就是尽量将能放入后台的任务放入后台，不能的则尽量推迟 (例如视图的创建、属性的调整)。</p>
<p>为此，ASDK 创建了一个名为 ASDisplayNode 的对象，并在内部封装了 UIView/CALayer，它具有和 UIView/CALayer 相似的属性，例如 frame、backgroundColor 等。所有这些属性都可以在后台线程更改，开发者可以只通过 Node 来操作其内部的 UIView/CALayer，这样就可以将排版和绘制放入了后台线程。但是无论怎么操作，这些属性总需要在某个时刻同步到主线程的 UIView/CALayer 去。</p>
<p>ASDK 仿照 QuartzCore/UIKit 框架的模式，实现了一套类似的界面更新的机制：即在主线程的 RunLoop 中添加一个 Observer，监听了 kCFRunLoopBeforeWaiting 和 kCFRunLoopExit 事件，在收到回调时，遍历所有之前放入队列的待处理的任务，然后一一执行。  </p>
<p><a target="_blank" rel="noopener" href="http://blog.ibireme.com/2015/05/18/runloop/%20">原文</a>地址</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/iOS%E5%BC%80%E5%8F%91/">iOS开发</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/iOS/">iOS</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2016/05/22/2016/iOS%20-%20%E9%92%A5%E5%8C%99%E4%B8%B2%E4%B8%AD%E8%AF%81%E4%B9%A6%E5%85%A8%E9%83%A8%E5%A4%B1%E6%95%88%EF%BC%88%E8%AF%81%E4%B9%A6%E7%9A%84%E7%AD%BE%E5%8F%91%E8%80%85%E6%97%A0%E6%95%88%EF%BC%89%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">钥匙串中证书全部失效（证书的签发者无效）的解决办法</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2015/09/03/2015/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%20Linked%20List/">
                        <span class="hidden-mobile">数据结构 Linked List</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
